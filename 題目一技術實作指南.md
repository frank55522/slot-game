# é¡Œç›®ä¸€æŠ€è¡“å¯¦ä½œæŒ‡å—ï¼šä¸­çé€£ç·šé¡¯ç¤ºåŠŸèƒ½

## å¯¦ä½œç›®æ¨™
åœ¨è€è™æ©ŸéŠæˆ²ä¸­å¯¦ç¾ä¸­çé€£ç·šé¡¯ç¤ºåŠŸèƒ½ï¼Œç•¶ç©å®¶ä¸­çæ™‚è‡ªå‹•é¡¯ç¤ºé€£ç·šçµæœï¼ˆå¦‚ã€ŒM1 Ã— 5ã€ï¼‰ã€‚

## æ•´é«”æ¶æ§‹æ€è·¯

### 1. æ ¸å¿ƒæµç¨‹è¨­è¨ˆ
```
éŠæˆ²è½‰å‹• â†’ ä¼ºæœå™¨å›å‚³çµæœ â†’ è§£æä¸­çæ•¸æ“š â†’ é¡¯ç¤ºä¸­çä¿¡æ¯
     â†“              â†“              â†“              â†“
   ç©å®¶æ“ä½œ    GAME_ParseState    PureMVCé€šçŸ¥    HTMLè¦†è“‹å±¤
              WinResultCommand    æ©Ÿåˆ¶          é¡¯ç¤º
```

### 2. MVCæ¶æ§‹æ‡‰ç”¨
- **Model**ï¼šä¸­çæ•¸æ“š (WAY_WinInfo)
- **View**ï¼šHTMLè¦†è“‹å±¤é¡¯ç¤º
- **Controller**ï¼šWinLineDisplayMediator

## è©³ç´°å¯¦ä½œæ­¥é©Ÿ

### æ­¥é©Ÿ1ï¼šæ‰¾åˆ°æ•¸æ“šè™•ç†å…¥å£é»

**ç›®æ¨™**ï¼šæ‰¾åˆ°éŠæˆ²è™•ç†ä¸­ççµæœçš„åœ°æ–¹

**æ–¹æ³•**ï¼š
1. æœå°‹å°ˆæ¡ˆä¸­èˆ‡ã€ŒWinã€ã€ã€ŒResultã€ç›¸é—œçš„æ–‡ä»¶
2. æ‰¾åˆ° `GAME_ParseStateWinResultCommand.ts`
3. é€™å€‹æ–‡ä»¶è² è²¬è§£æä¼ºæœå™¨å›å‚³çš„éŠæˆ²çµæœ

**é—œéµä»£ç¢¼ä½ç½®**ï¼š
```typescript
// GAME_ParseStateWinResultCommand.ts ç¬¬52-53è¡Œ
this.triggerWinLineDisplay(); // æˆ‘å€‘è¦ä¿®æ”¹çš„åœ°æ–¹
```

### æ­¥é©Ÿ2ï¼šç†è§£æ•¸æ“šçµæ§‹

**ä¸­çæ•¸æ“šæ ¼å¼ (WAY_WinInfo)**ï¼š
```typescript
{
    symbolId: number,     // ç¬¦è™ŸID (0=WILD, 2=M1, 6=Q, 7=Kç­‰)
    hitCount: number,     // é€£ç·šæ•¸é‡
    symbolWin: number,    // ä¸­çé‡‘é¡
    hitOdds: number,      // è³ ç‡
    hitNumber: number     // é€£ç·šç·¨è™Ÿ
}
```

**å¯¦éš›æ•¸æ“šç¯„ä¾‹**ï¼š
```typescript
[
    { symbolId: 3, hitCount: 4, symbolWin: 3.00 },  // M2 Ã— 4 = 3.00
    { symbolId: 6, hitCount: 3, symbolWin: 1.50 }   // Q Ã— 3 = 1.50
]
```

### æ­¥é©Ÿ3ï¼šå¯¦ç¾æ•¸æ“šæ””æˆªå’ŒConsoleè¼¸å‡º

**åœ¨ `GAME_ParseStateWinResultCommand.ts` ä¸­ä¿®æ”¹**ï¼š

```typescript
private triggerWinLineDisplay() {
    if (this.gameDataProxy.stateWinData.wayInfos.length > 0) {
        // éæ¿¾æœ‰æ•ˆä¸­ç (symbolWin > 0)
        const validWinInfos = this.gameDataProxy.stateWinData.wayInfos
            .filter(info => info.symbolWin > 0);
        
        if (validWinInfos.length > 0) {
            // === Consoleè¼¸å‡ºå¯¦ç¾ ===
            console.log('=== æœ¬å±€ä¸­çé€£ç·šçµæœ ===');
            validWinInfos.forEach((winInfo) => {
                const symbolName = this.getSymbolNameById(winInfo.symbolId);
                console.log(`${symbolName} Ã— ${winInfo.hitCount} = ${winInfo.symbolWin.toFixed(2)}`);
            });
            console.log(`ç¸½å…± ${validWinInfos.length} æ¢ä¸­çé€£ç·š`);
            
            // ç™¼é€PureMVCé€šçŸ¥è§¸ç™¼UIé¡¯ç¤º
            this.sendNotification('SHOW_WIN_LINES', validWinInfos);
        }
    }
}

// ç¬¦è™ŸIDè½‰æ›å‡½æ•¸
private getSymbolNameById(symbolId: number): string {
    const symbolMap = {
        0: 'WILD', 1: 'C1', 2: 'M1', 3: 'M2', 4: 'M3',
        5: 'J', 6: 'Q', 7: 'K', 8: 'A', 9: '10', 10: '9'
    };
    return symbolMap[symbolId] || `Symbol_${symbolId}`;
}
```

**é—œéµé»è§£æ**ï¼š
- `filter(info => info.symbolWin > 0)`ï¼šåªé¡¯ç¤ºçœŸæ­£ä¸­ççš„é€£ç·š
- `getSymbolNameById()`ï¼šå°‡æ•¸å­—IDè½‰ç‚ºå¯è®€çš„ç¬¦è™Ÿåç¨±
- `sendNotification()`ï¼šç™¼é€PureMVCäº‹ä»¶è§¸ç™¼UIé¡¯ç¤º

### æ­¥é©Ÿ4ï¼šå¯¦ç¾UIé¡¯ç¤ºé‚è¼¯

**å‰µå»º `WinLineDisplayMediator.ts`**ï¼š

```typescript
import { _decorator } from 'cc';
import BaseMediator from '../../base/BaseMediator';

@ccclass('WinLineDisplayMediator')
export class WinLineDisplayMediator extends BaseMediator<any> {
    public static NAME: string = 'WinLineDisplayMediator';
    private htmlOverlay: HTMLElement | null = null;

    // ç›£è½çš„PureMVCäº‹ä»¶
    public listNotificationInterests(): Array<any> {
        return ['SHOW_WIN_LINES', 'HIDE_WIN_LINES'];
    }

    // è™•ç†äº‹ä»¶é€šçŸ¥
    public handleNotification(notification: puremvc.INotification): void {
        switch (notification.getName()) {
            case 'SHOW_WIN_LINES':
                this.showHTMLWinText(notification.getBody());
                break;
            case 'HIDE_WIN_LINES':
                this.hideHTMLWinText();
                break;
        }
    }

    // HTMLè¦†è“‹å±¤å¯¦ç¾
    private showHTMLWinText(winData: any[]) {
        // çµ„åˆé¡¯ç¤ºæ–‡å­—
        const winTexts = winData.map((win) => {
            const symbolName = this.getSymbolNameById(win.symbolId);
            return `${symbolName} Ã— ${win.hitCount} = ${win.symbolWin.toFixed(2)}`;
        });
        
        // å‰µå»ºHTMLå…ƒç´ 
        this.htmlOverlay = document.createElement('div');
        this.htmlOverlay.style.cssText = `
            position: fixed;           /* å›ºå®šä½ç½®ï¼Œä¸å—é é¢æ»¾å‹•å½±éŸ¿ */
            top: 50%; left: 50%;      /* è¢å¹•ä¸­å¤® */
            transform: translate(-50%, -50%);  /* ç²¾ç¢ºç½®ä¸­ */
            background: rgba(0, 0, 0, 0.8);   /* åŠé€æ˜é»‘åº• */
            color: #FFD700;           /* é‡‘è‰²æ–‡å­— */
            font-size: 32px;          /* å¤§å­—é«” */
            font-weight: bold;        /* ç²—é«” */
            text-align: center;       /* æ–‡å­—ç½®ä¸­ */
            padding: 30px;            /* å…§é‚Šè· */
            border-radius: 15px;      /* åœ“è§’ */
            border: 3px solid #FFD700; /* é‡‘è‰²é‚Šæ¡† */
            z-index: 10000;           /* æœ€é«˜å±¤ç´šï¼Œç¢ºä¿é¡¯ç¤ºåœ¨æœ€ä¸Šæ–¹ */
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);  /* æ–‡å­—é™°å½± */
            box-shadow: 0 0 20px rgba(255,215,0,0.6);  /* ç™¼å…‰æ•ˆæœ */
        `;
        
        // è¨­ç½®é¡¯ç¤ºå…§å®¹
        this.htmlOverlay.innerHTML = `ğŸ‰ ä¸­çé€£ç·š ğŸ‰<br>${winTexts.join('<br>')}`;
        
        // æ·»åŠ åˆ°é é¢
        document.body.appendChild(this.htmlOverlay);
        
        // 3ç§’å¾Œè‡ªå‹•éš±è—
        setTimeout(() => this.hideHTMLWinText(), 3000);
    }
}
```

### æ­¥é©Ÿ5ï¼šç³»çµ±æ•´åˆ

**å‰µå»º `WinLineTestTrigger.ts`**ï¼š

```typescript
@ccclass('WinLineTestTrigger')
export class WinLineTestTrigger extends Component {
    onLoad() {
        // å»¶é²2ç§’ç­‰å¾…éŠæˆ²ç³»çµ±åˆå§‹åŒ–
        setTimeout(() => this.initialize(), 2000);
    }

    private initialize() {
        // è¨»å†ŠMediatoråˆ°PureMVCç³»çµ±
        this.registerWinLineMediator();
        
        // æä¾›æ¸¬è©¦å‡½æ•¸
        this.exposeTestFunctions();
    }

    private registerWinLineMediator() {
        const facade = puremvc.Facade.getInstance();
        const mediator = new WinLineDisplayMediator();
        facade.registerMediator(mediator);
    }
}
```

## æŠ€è¡“é›£é»èˆ‡è§£æ±ºæ–¹æ¡ˆ

### é›£é»1ï¼šCocos Creator UIæ¸²æŸ“å•é¡Œ

**å•é¡Œ**ï¼šç´”ç¨‹å¼ç¢¼å‰µå»ºçš„UIçµ„ä»¶ç„¡æ³•é¡¯ç¤º

**åŸå› åˆ†æ**ï¼š
- Cocos Creatoré€šå¸¸ä½¿ç”¨Prefabç®¡ç†UI
- æ¸²æŸ“å±¤ç´šè¤‡é›œï¼Œç¨‹å¼ç¢¼å‰µå»ºçš„çµ„ä»¶å¯èƒ½è¢«é®è“‹
- Canvasè¨­ç½®å’Œç›¸æ©Ÿå±¤ç´šå½±éŸ¿é¡¯ç¤º

**è§£æ±ºæ–¹æ¡ˆ**ï¼šHTMLè¦†è“‹å±¤
```typescript
// é—œéµCSSå±¬æ€§
position: fixed;     // è„«é›¢æ–‡æª”æµï¼Œå›ºå®šä½ç½®
z-index: 10000;     // æœ€é«˜å±¤ç´š
transform: translate(-50%, -50%);  // ç²¾ç¢ºç½®ä¸­
```

### é›£é»2ï¼šPureMVCæ¶æ§‹æ•´åˆ

**ç†è§£è¦é»**ï¼š
- **Command**ï¼šè™•ç†æ¥­å‹™é‚è¼¯ (ParseStateWinResultCommand)
- **Mediator**ï¼šç®¡ç†UIé¡¯ç¤º (WinLineDisplayMediator)  
- **Notification**ï¼šçµ„ä»¶é–“é€šè¨Šæ©Ÿåˆ¶

**é€šè¨Šæµç¨‹**ï¼š
```
Command.sendNotification() â†’ Facade â†’ Mediator.handleNotification()
```

### é›£é»3ï¼šæ•¸æ“šæ ¼å¼è½‰æ›

**æŒ‘æˆ°**ï¼šå°‡éŠæˆ²å…§éƒ¨çš„æ•¸å­—IDè½‰ç‚ºç©å®¶å¯è®€çš„ç¬¦è™Ÿ

**å¯¦ç¾**ï¼šæ˜ å°„è¡¨ + å‡½æ•¸å°è£
```typescript
const symbolMap = {
    0: 'WILD', 2: 'M1', 6: 'Q', 7: 'K'
    // ...æ›´å¤šæ˜ å°„
};
```

## æ¸¬è©¦èˆ‡é©—è­‰

### è‡ªå‹•æ¸¬è©¦
1. å•Ÿå‹•éŠæˆ²
2. é€²è¡Œè½‰å‹•æ“ä½œ
3. ä¸­çæ™‚è§€å¯ŸConsoleå’Œç•«é¢é¡¯ç¤º

### æ‰‹å‹•æ¸¬è©¦
```javascript
// ç€è¦½å™¨ConsoleåŸ·è¡Œ
testWinLineDisplay()  // æ¨¡æ“¬ä¸­çé¡¯ç¤º
```

## æ“´å±•æ€è·¯

### å¯èƒ½çš„æ”¹é€²æ–¹å‘
1. **å‹•ç•«æ•ˆæœ**ï¼šæ·»åŠ æ·¡å…¥æ·¡å‡ºã€ç¸®æ”¾å‹•ç•«
2. **éŸ³æ•ˆæ•´åˆ**ï¼šä¸­çæ™‚æ’­æ”¾éŸ³æ•ˆ
3. **å¤šèªè¨€æ”¯æŒ**ï¼šæ ¹æ“šéŠæˆ²èªè¨€é¡¯ç¤ºä¸åŒæ–‡å­—
4. **è‡ªå®šç¾©æ¨£å¼**ï¼šå…è¨±ç©å®¶è‡ªå®šç¾©é¡¯ç¤ºæ¨£å¼

### æ¶æ§‹å„ªåŒ–
1. **é…ç½®æ–‡ä»¶**ï¼šå°‡ç¬¦è™Ÿæ˜ å°„è¡¨ç§»åˆ°é…ç½®æ–‡ä»¶
2. **äº‹ä»¶è§£è€¦**ï¼šä½¿ç”¨æ›´ç´°ç²’åº¦çš„äº‹ä»¶ç³»çµ±
3. **éŒ¯èª¤è™•ç†**ï¼šæ·»åŠ å®¹éŒ¯æ©Ÿåˆ¶

## ç¸½çµ

é€™å€‹å¯¦ä½œå±•ç¤ºäº†å¹¾å€‹é‡è¦çš„é–‹ç™¼æ€è·¯ï¼š

1. **ç”±ç°¡åˆ°ç¹**ï¼šå…ˆå¯¦ç¾Consoleè¼¸å‡ºï¼Œå†è™•ç†UIé¡¯ç¤º
2. **æ¶æ§‹ç†è§£**ï¼šæ·±å…¥ç†è§£ç¾æœ‰ç³»çµ±çš„è¨­è¨ˆæ¨¡å¼
3. **å‰µæ–°è§£æ±º**ï¼šç•¶å‚³çµ±æ–¹æ³•é‡åˆ°å›°é›£æ™‚ï¼Œæ¡ç”¨å‰µæ–°æ–¹æ¡ˆ
4. **ä»£ç¢¼å“è³ª**ï¼šæœ€çµ‚æ¸…ç†å†—é¤˜ï¼Œä¿æŒçµæ§‹æ¸…æ½”

é€šéé€™å€‹å°ˆæ¡ˆï¼Œä¸åƒ…å®Œæˆäº†åŠŸèƒ½éœ€æ±‚ï¼Œæ›´é‡è¦çš„æ˜¯å­¸ç¿’äº†éŠæˆ²é–‹ç™¼ä¸­çš„æ¶æ§‹è¨­è¨ˆå’Œå•é¡Œè§£æ±ºæ€ç¶­ã€‚