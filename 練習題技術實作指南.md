# ç·´ç¿’é¡ŒæŠ€è¡“å¯¦ä½œæŒ‡å—ï¼šè€è™æ©ŸéŠæˆ²å¢å¼·åŠŸèƒ½

## å¯¦ä½œç›®æ¨™

### é¡Œç›®ä¸€ï¼šä¸­çé€£ç·šé¡¯ç¤ºåŠŸèƒ½
åœ¨è€è™æ©ŸéŠæˆ²ä¸­å¯¦ç¾ä¸­çé€£ç·šé¡¯ç¤ºåŠŸèƒ½ï¼Œç•¶ç©å®¶ä¸­çæ™‚è‡ªå‹•é¡¯ç¤ºé€£ç·šçµæœï¼ˆå¦‚ã€ŒM1 Ã— 5ã€ï¼‰ã€‚

### é¡Œç›®äºŒï¼šShow Win å‹•ç•«æ•ˆæœ
åœ¨ show win æ™‚é€é TimelineTool æ’­æ”¾å‹•ç•«ï¼Œç‚ºä¸­çé€£ç·šé¡¯ç¤ºå¢åŠ è¦–è¦ºæ•ˆæœã€‚

### é¡Œç›®ä¸‰ï¼šBaseGame è´åˆ†é¾ç é¡¯ç¤º
å®šç¾©ä¸€å€‹äº‹ä»¶åœ¨ BaseGame æ»¾åœå¾Œç™¼å‡ºï¼Œäº‹ä»¶å¸¶æœ‰è´åˆ†åƒæ•¸ï¼Œè®“ä¸Šæ–¹å¤§é¾ç é¡¯ç¤ºç•¶å±€è´åˆ†ã€‚

### é¡Œç›®å››ï¼šå€’æ•¸äº”ç§’ç‹€æ…‹
åœ¨game1 spinå’Œroll completeä¹‹é–“æ–°å¢ä¸€å€‹å€’æ•¸äº”ç§’çš„ç‹€æ…‹ï¼Œæœƒåœ¨ç•«é¢ä¸Šå€’æ•¸5ç§’å†ç¹¼çºŒå¾ŒçºŒæµç¨‹ã€‚

---

## æ•´é«”æ¶æ§‹æ€è·¯

### 1. æ ¸å¿ƒæµç¨‹è¨­è¨ˆ
```
éŠæˆ²è½‰å‹• â†’ ä¼ºæœå™¨å›å‚³çµæœ â†’ è§£æä¸­çæ•¸æ“š â†’ é¡¯ç¤ºä¸­çä¿¡æ¯ + æ’­æ”¾å‹•ç•« + é¾ç é¡¯ç¤ºè´åˆ†
     â†“              â†“              â†“              â†“              â†“
   ç©å®¶æ“ä½œ    GAME_ParseState    PureMVCé€šçŸ¥    HTMLè¦†è“‹å±¤    ä¸Šæ–¹å¤§é¾ç 
              WinResultCommand    æ©Ÿåˆ¶          + CSSå‹•ç•«     + è‡ªå‹•æ¸…é™¤
```

### 2. MVCæ¶æ§‹æ‡‰ç”¨
- **Model**ï¼šä¸­çæ•¸æ“š (WAY_WinInfo) + BaseGame è´åˆ†æ•¸æ“š
- **View**ï¼šHTMLè¦†è“‹å±¤é¡¯ç¤º + å‹•ç•«æ•ˆæœ + å¤§é¾ç é¡¯ç¤º
- **Controller**ï¼šWinLineDisplayMediator + BallHitViewMediator

---

## é¡Œç›®ä¸€ï¼šä¸­çé€£ç·šé¡¯ç¤ºåŠŸèƒ½

### è©³ç´°å¯¦ä½œæ­¥é©Ÿ

#### æ­¥é©Ÿ1ï¼šæ‰¾åˆ°æ•¸æ“šè™•ç†å…¥å£é»

**ç›®æ¨™**ï¼šæ‰¾åˆ°éŠæˆ²è™•ç†ä¸­ççµæœçš„åœ°æ–¹

**æ–¹æ³•**ï¼š
1. æœå°‹å°ˆæ¡ˆä¸­èˆ‡ã€ŒWinã€ã€ã€ŒResultã€ç›¸é—œçš„æ–‡ä»¶
2. æ‰¾åˆ° `GAME_ParseStateWinResultCommand.ts`
3. é€™å€‹æ–‡ä»¶è² è²¬è§£æä¼ºæœå™¨å›å‚³çš„éŠæˆ²çµæœ

**é—œéµä»£ç¢¼ä½ç½®**ï¼š
```typescript
// GAME_ParseStateWinResultCommand.ts ç¬¬52-53è¡Œ
this.triggerWinLineDisplay(); // æˆ‘å€‘è¦ä¿®æ”¹çš„åœ°æ–¹
```

#### æ­¥é©Ÿ2ï¼šç†è§£æ•¸æ“šçµæ§‹

**ä¸­çæ•¸æ“šæ ¼å¼ (WAY_WinInfo)**ï¼š
```typescript
{
    symbolId: number,     // ç¬¦è™ŸID (0=WILD, 2=M1, 6=Q, 7=Kç­‰)
    hitCount: number,     // é€£ç·šæ•¸é‡
    symbolWin: number,    // ä¸­çé‡‘é¡
    hitOdds: number,      // è³ ç‡
    hitNumber: number     // é€£ç·šç·¨è™Ÿ
}
```

**å¯¦éš›æ•¸æ“šç¯„ä¾‹**ï¼š
```typescript
[
    { symbolId: 3, hitCount: 4, symbolWin: 3.00 },  // M2 Ã— 4 = 3.00
    { symbolId: 6, hitCount: 3, symbolWin: 1.50 }   // Q Ã— 3 = 1.50
]
```

#### æ­¥é©Ÿ3ï¼šå¯¦ç¾æ•¸æ“šæ””æˆªå’ŒConsoleè¼¸å‡º

**åœ¨ `GAME_ParseStateWinResultCommand.ts` ä¸­ä¿®æ”¹**ï¼š

```typescript
private triggerWinLineDisplay() {
    if (this.gameDataProxy.stateWinData.wayInfos.length > 0) {
        // éæ¿¾æœ‰æ•ˆä¸­ç (symbolWin > 0)
        const validWinInfos = this.gameDataProxy.stateWinData.wayInfos
            .filter(info => info.symbolWin > 0);
        
        if (validWinInfos.length > 0) {
            // === Consoleè¼¸å‡ºå¯¦ç¾ ===
            console.log('=== æœ¬å±€ä¸­çé€£ç·šçµæœ ===');
            validWinInfos.forEach((winInfo) => {
                const symbolName = this.getSymbolNameById(winInfo.symbolId);
                console.log(`${symbolName} Ã— ${winInfo.hitCount} = ${winInfo.symbolWin.toFixed(2)}`);
            });
            console.log(`ç¸½å…± ${validWinInfos.length} æ¢ä¸­çé€£ç·š`);
            
            // ç™¼é€PureMVCé€šçŸ¥è§¸ç™¼UIé¡¯ç¤º
            this.sendNotification('SHOW_WIN_LINES', validWinInfos);
        }
    }
}

// ç¬¦è™ŸIDè½‰æ›å‡½æ•¸
private getSymbolNameById(symbolId: number): string {
    const symbolMap = {
        0: 'WILD', 1: 'C1', 2: 'M1', 3: 'M2', 4: 'M3',
        5: 'J', 6: 'Q', 7: 'K', 8: 'A', 9: '10', 10: '9'
    };
    return symbolMap[symbolId] || `Symbol_${symbolId}`;
}
```

**é—œéµé»è§£æ**ï¼š
- `filter(info => info.symbolWin > 0)`ï¼šåªé¡¯ç¤ºçœŸæ­£ä¸­ççš„é€£ç·š
- `getSymbolNameById()`ï¼šå°‡æ•¸å­—IDè½‰ç‚ºå¯è®€çš„ç¬¦è™Ÿåç¨±
- `sendNotification()`ï¼šç™¼é€PureMVCäº‹ä»¶è§¸ç™¼UIé¡¯ç¤º

#### æ­¥é©Ÿ4ï¼šå¯¦ç¾UIé¡¯ç¤ºé‚è¼¯

**å‰µå»º `WinLineDisplayMediator.ts`**ï¼š

```typescript
import { _decorator } from 'cc';
import BaseMediator from '../../base/BaseMediator';

@ccclass('WinLineDisplayMediator')
export class WinLineDisplayMediator extends BaseMediator<any> {
    public static NAME: string = 'WinLineDisplayMediator';
    private htmlOverlay: HTMLElement | null = null;

    // ç›£è½çš„PureMVCäº‹ä»¶
    public listNotificationInterests(): Array<any> {
        return ['SHOW_WIN_LINES', 'HIDE_WIN_LINES'];
    }

    // è™•ç†äº‹ä»¶é€šçŸ¥
    public handleNotification(notification: puremvc.INotification): void {
        switch (notification.getName()) {
            case 'SHOW_WIN_LINES':
                this.showHTMLWinText(notification.getBody());
                break;
            case 'HIDE_WIN_LINES':
                this.hideHTMLWinText();
                break;
        }
    }

    // HTMLè¦†è“‹å±¤å¯¦ç¾
    private showHTMLWinText(winData: any[]) {
        // çµ„åˆé¡¯ç¤ºæ–‡å­—
        const winTexts = winData.map((win) => {
            const symbolName = this.getSymbolNameById(win.symbolId);
            return `${symbolName} Ã— ${win.hitCount} = ${win.symbolWin.toFixed(2)}`;
        });
        
        // å‰µå»ºHTMLå…ƒç´ 
        this.htmlOverlay = document.createElement('div');
        this.htmlOverlay.style.cssText = `
            position: fixed;           /* å›ºå®šä½ç½®ï¼Œä¸å—é é¢æ»¾å‹•å½±éŸ¿ */
            top: 50%; left: 50%;      /* è¢å¹•ä¸­å¤® */
            transform: translate(-50%, -50%);  /* ç²¾ç¢ºç½®ä¸­ */
            background: rgba(0, 0, 0, 0.8);   /* åŠé€æ˜é»‘åº• */
            color: #FFD700;           /* é‡‘è‰²æ–‡å­— */
            font-size: 32px;          /* å¤§å­—é«” */
            font-weight: bold;        /* ç²—é«” */
            text-align: center;       /* æ–‡å­—ç½®ä¸­ */
            padding: 30px;            /* å…§é‚Šè· */
            border-radius: 15px;      /* åœ“è§’ */
            border: 3px solid #FFD700; /* é‡‘è‰²é‚Šæ¡† */
            z-index: 10000;           /* æœ€é«˜å±¤ç´šï¼Œç¢ºä¿é¡¯ç¤ºåœ¨æœ€ä¸Šæ–¹ */
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);  /* æ–‡å­—é™°å½± */
            box-shadow: 0 0 20px rgba(255,215,0,0.6);  /* ç™¼å…‰æ•ˆæœ */
        `;
        
        // è¨­ç½®é¡¯ç¤ºå…§å®¹
        this.htmlOverlay.innerHTML = `ğŸ‰ ä¸­çé€£ç·š ğŸ‰<br>${winTexts.join('<br>')}`;
        
        // æ·»åŠ åˆ°é é¢
        document.body.appendChild(this.htmlOverlay);
        
        // 3ç§’å¾Œè‡ªå‹•éš±è—
        setTimeout(() => this.hideHTMLWinText(), 3000);
    }
}
```

#### æ­¥é©Ÿ5ï¼šç³»çµ±æ•´åˆ

**å‰µå»º `WinLineTestTrigger.ts`**ï¼š

```typescript
@ccclass('WinLineTestTrigger')
export class WinLineTestTrigger extends Component {
    onLoad() {
        // å»¶é²2ç§’ç­‰å¾…éŠæˆ²ç³»çµ±åˆå§‹åŒ–
        setTimeout(() => this.initialize(), 2000);
    }

    private initialize() {
        // è¨»å†ŠMediatoråˆ°PureMVCç³»çµ±
        this.registerWinLineMediator();
        
        // æä¾›æ¸¬è©¦å‡½æ•¸
        this.exposeTestFunctions();
    }

    private registerWinLineMediator() {
        const facade = puremvc.Facade.getInstance();
        const mediator = new WinLineDisplayMediator();
        facade.registerMediator(mediator);
    }
}
```

---

## é¡Œç›®äºŒï¼šShow Win å‹•ç•«æ•ˆæœ

### å¯¦ä½œæ¦‚å¿µ

åŸºæ–¼é¡Œç›®ä¸€çš„ HTML è¦†è“‹å±¤ï¼Œé€é CSS å‹•ç•«å¯¦ç¾è¦–è¦ºæ•ˆæœï¼Œè®“ä¸­çé¡¯ç¤ºæ›´åŠ é¡¯çœ¼å’Œå¸å¼•äººã€‚

### å‹•ç•«è¨­è¨ˆæ€è·¯

#### 1. æŒçºŒå‹•ç•«ç³»çµ±
- **æ–æ“ºå½ˆè·³**ï¼šæ¨¡æ“¬æ…¶ç¥çš„èˆˆå¥®æ„Ÿ
- **å…‰æšˆè„ˆè¡**ï¼šç‡Ÿé€ ç™¼å…‰æ•ˆæœ
- **æ•´å€‹é¡¯ç¤ºæœŸé–“æŒçºŒæ’­æ”¾**ï¼šç¢ºä¿è¦–è¦ºå¸å¼•åŠ›

#### 2. å‹•ç•«æ™‚é–“è»¸
```
å‡ºç¾(0.01s) â†’ æŒçºŒå‹•ç•«(3s) â†’ æ¶ˆå¤±å‹•ç•«(0.5s)
     â†“            â†“              â†“
   ç«‹å³é¡¯ç¤º   æ–æ“º+ç™¼å…‰       ç¸®å°æ·¡å‡º
```

### å¯¦ä½œæ­¥é©Ÿ

#### æ­¥é©Ÿ1ï¼šCSS å‹•ç•«å®šç¾©

**åœ¨ `WinLineDisplayMediator.ts` ä¸­æ–°å¢å‹•ç•«æ¨£å¼**ï¼š

```typescript
// å…ˆæ·»åŠ CSSå‹•ç•«å®šç¾©åˆ°é é¢
if (!document.getElementById('win-bounce-animation')) {
    const style = document.createElement('style');
    style.id = 'win-bounce-animation';
    style.textContent = `
        @keyframes winShake {
            0%, 100% { transform: translate(-50%, -50%) rotate(0deg) scale(1); }
            10% { transform: translate(-50%, -50%) rotate(-1deg) scale(1.05); }
            20% { transform: translate(-50%, -50%) rotate(1deg) scale(1.1); }
            30% { transform: translate(-50%, -50%) rotate(-1deg) scale(1.05); }
            40% { transform: translate(-50%, -50%) rotate(1deg) scale(1.1); }
            50% { transform: translate(-50%, -50%) rotate(0deg) scale(1.15); }
            60% { transform: translate(-50%, -50%) rotate(1deg) scale(1.1); }
            70% { transform: translate(-50%, -50%) rotate(-1deg) scale(1.05); }
            80% { transform: translate(-50%, -50%) rotate(1deg) scale(1.1); }
            90% { transform: translate(-50%, -50%) rotate(-1deg) scale(1.05); }
        }
        @keyframes winGlow {
            0%, 100% { box-shadow: 0 0 20px rgba(255,215,0,0.6); }
            50% { box-shadow: 0 0 40px rgba(255,215,0,1), 0 0 60px rgba(255,215,0,0.8); }
        }
    `;
    document.head.appendChild(style);
}
```

#### æ­¥é©Ÿ2ï¼šå‹•ç•«è§¸ç™¼é‚è¼¯

**ä¿®æ”¹é¡¯ç¤ºå‡½æ•¸æ‡‰ç”¨å‹•ç•«**ï¼š

```typescript
// ç«‹å³é¡¯ç¤ºä¸¦é–‹å§‹æŒçºŒå‹•ç•«
setTimeout(() => {
    if (this.htmlOverlay) {
        // å…ˆé¡¯ç¤ºå…ƒç´ 
        this.htmlOverlay.style.opacity = '1';
        this.htmlOverlay.style.transform = 'translate(-50%, -50%) scale(1)';
        
        // é–‹å§‹æŒçºŒçš„çµ„åˆå‹•ç•«
        this.htmlOverlay.style.animation = `
            winShake 0.8s ease-in-out infinite,
            winGlow 1.5s ease-in-out infinite
        `;
    }
}, 10);
```

#### æ­¥é©Ÿ3ï¼šè¦–è¦ºæ•ˆæœå¢å¼·

**å¢å¼·é¡¯ç¤ºæ•ˆæœ**ï¼š

```typescript
this.htmlOverlay.style.cssText = `
    position: fixed;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%) scale(0);
    background: rgba(0, 0, 0, 0.9);        /* æ›´æ·±çš„èƒŒæ™¯ */
    color: #FFD700;
    font-family: Arial, sans-serif;
    font-size: 36px;                       /* æ›´å¤§çš„å­—é«” */
    font-weight: bold;
    text-align: center;
    padding: 40px;                         /* æ›´å¤§çš„å…§é‚Šè· */
    border-radius: 20px;                   /* æ›´å¤§çš„åœ“è§’ */
    border: 4px solid #FFD700;             /* æ›´ç²—çš„é‚Šæ¡† */
    z-index: 10000;
    text-shadow: 3px 3px 6px rgba(0,0,0,0.9), 0 0 10px rgba(255,215,0,0.8); /* é›™é‡é™°å½± */
    box-shadow: 0 0 20px rgba(255,215,0,0.6);
    white-space: pre-line;
    max-width: 700px;
    word-wrap: break-word;
    opacity: 0;
    transition: opacity 0.3s ease-in-out;
`;
```

#### æ­¥é©Ÿ4ï¼šæ¶ˆå¤±å‹•ç•«è™•ç†

**å„ªé›…çš„é€€å ´æ•ˆæœ**ï¼š

```typescript
private hideHTMLWinTextWithAnimation() {
    if (this.htmlOverlay && this.htmlOverlay.parentNode) {
        console.log('[WinLineDisplayMediator] éš±è—HTMLè¦†è“‹å±¤ï¼ˆå¸¶å‹•ç•«ï¼‰');
        
        // åœæ­¢æŒçºŒå‹•ç•«ï¼Œé–‹å§‹æ·¡å‡º
        this.htmlOverlay.style.animation = 'none';
        this.htmlOverlay.style.transition = 'all 0.5s ease-out';
        this.htmlOverlay.style.transform = 'translate(-50%, -50%) scale(0.5)';
        this.htmlOverlay.style.opacity = '0';
        
        // å‹•ç•«å®Œæˆå¾Œç§»é™¤å…ƒç´ 
        setTimeout(() => {
            if (this.htmlOverlay && this.htmlOverlay.parentNode) {
                this.htmlOverlay.parentNode.removeChild(this.htmlOverlay);
                this.htmlOverlay = null;
            }
        }, 500);
    }
}
```

### å‹•ç•«æ•ˆæœèªªæ˜

#### 1. **winShake å‹•ç•«**
- **æ•ˆæœ**ï¼šè¼•å¾®çš„æ—‹è½‰æ–æ“º + ç¸®æ”¾è®ŠåŒ–
- **é€±æœŸ**ï¼š0.8ç§’ä¸€å€‹å¾ªç’°
- **è®ŠåŒ–ç¯„åœ**ï¼šæ—‹è½‰ Â±1åº¦ï¼Œç¸®æ”¾ 1.0-1.15å€
- **ç›®çš„**ï¼šæ¨¡æ“¬èˆˆå¥®æ…¶ç¥çš„æ„Ÿè¦º

#### 2. **winGlow å‹•ç•«**
- **æ•ˆæœ**ï¼šå…‰æšˆå¼·å¼±è®ŠåŒ–
- **é€±æœŸ**ï¼š1.5ç§’ä¸€å€‹å¾ªç’°
- **è®ŠåŒ–ç¯„åœ**ï¼šé™°å½±å¾ 20px åˆ° 60px
- **ç›®çš„**ï¼šç‡Ÿé€ ç™¼å…‰è„ˆè¡æ•ˆæœ

#### 3. **çµ„åˆæ•ˆæœ**
- **åŒæ™‚æ’­æ”¾**ï¼šå…©å€‹å‹•ç•«ç–ŠåŠ é‹è¡Œ
- **æŒçºŒæ™‚é–“**ï¼šæ•´å€‹3ç§’é¡¯ç¤ºæœŸé–“
- **è¦–è¦ºé«”é©—**ï¼šæŒçºŒçš„å‹•æ…‹æ•ˆæœï¼Œæ¥µé›£å¿½è¦–

---

## æŠ€è¡“é›£é»èˆ‡è§£æ±ºæ–¹æ¡ˆ

### é›£é»1ï¼šCocos Creator UIæ¸²æŸ“å•é¡Œ

**å•é¡Œ**ï¼šç´”ç¨‹å¼ç¢¼å‰µå»ºçš„UIçµ„ä»¶ç„¡æ³•é¡¯ç¤º

**åŸå› åˆ†æ**ï¼š
- Cocos Creatoré€šå¸¸ä½¿ç”¨Prefabç®¡ç†UI
- æ¸²æŸ“å±¤ç´šè¤‡é›œï¼Œç¨‹å¼ç¢¼å‰µå»ºçš„çµ„ä»¶å¯èƒ½è¢«é®è“‹
- Canvasè¨­ç½®å’Œç›¸æ©Ÿå±¤ç´šå½±éŸ¿é¡¯ç¤º

**è§£æ±ºæ–¹æ¡ˆ**ï¼šHTMLè¦†è“‹å±¤
```typescript
// é—œéµCSSå±¬æ€§
position: fixed;     // è„«é›¢æ–‡æª”æµï¼Œå›ºå®šä½ç½®
z-index: 10000;     // æœ€é«˜å±¤ç´š
transform: translate(-50%, -50%);  // ç²¾ç¢ºç½®ä¸­
```

### é›£é»2ï¼šPureMVCæ¶æ§‹æ•´åˆ

**ç†è§£è¦é»**ï¼š
- **Command**ï¼šè™•ç†æ¥­å‹™é‚è¼¯ (ParseStateWinResultCommand)
- **Mediator**ï¼šç®¡ç†UIé¡¯ç¤º (WinLineDisplayMediator)  
- **Notification**ï¼šçµ„ä»¶é–“é€šè¨Šæ©Ÿåˆ¶

**é€šè¨Šæµç¨‹**ï¼š
```
Command.sendNotification() â†’ Facade â†’ Mediator.handleNotification()
```

### é›£é»3ï¼šå‹•ç•«æ€§èƒ½å„ªåŒ–

**æŒ‘æˆ°**ï¼šCSSå‹•ç•«å¯èƒ½å½±éŸ¿éŠæˆ²æ€§èƒ½

**è§£æ±ºç­–ç•¥**ï¼š
- **æœ‰é™æ™‚é–“**ï¼šå‹•ç•«åªæ’­æ”¾3ç§’
- **ç¡¬ä»¶åŠ é€Ÿ**ï¼šä½¿ç”¨transformå±¬æ€§è§¸ç™¼GPUåŠ é€Ÿ
- **å‹•ç•«æ¸…ç†**ï¼šåŠæ™‚åœæ­¢å’Œç§»é™¤å‹•ç•«å…ƒç´ 
- **è¼•é‡ç´šå‹•ç•«**ï¼šé¿å…éæ–¼è¤‡é›œçš„å‹•ç•«æ•ˆæœ

### é›£é»4ï¼šæ•¸æ“šæ ¼å¼è½‰æ›

**æŒ‘æˆ°**ï¼šå°‡éŠæˆ²å…§éƒ¨çš„æ•¸å­—IDè½‰ç‚ºç©å®¶å¯è®€çš„ç¬¦è™Ÿ

**å¯¦ç¾**ï¼šæ˜ å°„è¡¨ + å‡½æ•¸å°è£
```typescript
const symbolMap = {
    0: 'WILD', 2: 'M1', 6: 'Q', 7: 'K'
    // ...æ›´å¤šæ˜ å°„
};
```

---

## æ¸¬è©¦èˆ‡é©—è­‰

### è‡ªå‹•æ¸¬è©¦ï¼ˆæ¨è–¦ï¼‰
1. å•Ÿå‹•éŠæˆ²
2. é€²è¡Œè½‰å‹•æ“ä½œ
3. ä¸­çæ™‚è§€å¯Ÿï¼š
   - Consoleè¼¸å‡ºæ˜¯å¦æ­£ç¢º
   - ç•«é¢é¡¯ç¤ºæ˜¯å¦å‡ºç¾
   - å‹•ç•«æ•ˆæœæ˜¯å¦æ’­æ”¾
   - 3ç§’å¾Œæ˜¯å¦è‡ªå‹•æ¶ˆå¤±

### æ‰‹å‹•æ¸¬è©¦
```javascript
// ç€è¦½å™¨ConsoleåŸ·è¡Œ
testWinLineDisplay()  // æ¨¡æ“¬ä¸­çé¡¯ç¤º
hideWinLineDisplay()  // æ‰‹å‹•éš±è—æ¸¬è©¦
```

---

## æ“´å±•æ€è·¯

### å¯èƒ½çš„æ”¹é€²æ–¹å‘

#### åŠŸèƒ½å¢å¼·
1. **å¤šç¨®å‹•ç•«æ¨¡å¼**ï¼šæ ¹æ“šä¸­çé‡‘é¡ä½¿ç”¨ä¸åŒå‹•ç•«
2. **éŸ³æ•ˆæ•´åˆ**ï¼šä¸­çæ™‚æ’­æ”¾å°æ‡‰éŸ³æ•ˆ
3. **å¤šèªè¨€æ”¯æŒ**ï¼šæ ¹æ“šéŠæˆ²èªè¨€é¡¯ç¤ºä¸åŒæ–‡å­—
4. **è‡ªå®šç¾©æ¨£å¼**ï¼šå…è¨±ç©å®¶è‡ªå®šç¾©é¡¯ç¤ºæ¨£å¼

#### æŠ€è¡“å„ªåŒ–
1. **é…ç½®æ–‡ä»¶**ï¼šå°‡ç¬¦è™Ÿæ˜ å°„è¡¨ç§»åˆ°é…ç½®æ–‡ä»¶
2. **äº‹ä»¶è§£è€¦**ï¼šä½¿ç”¨æ›´ç´°ç²’åº¦çš„äº‹ä»¶ç³»çµ±
3. **éŒ¯èª¤è™•ç†**ï¼šæ·»åŠ å®¹éŒ¯æ©Ÿåˆ¶
4. **å‹•ç•«åº«**ï¼šå»ºç«‹å¯é‡ç”¨çš„å‹•ç•«çµ„ä»¶åº«

### æ¶æ§‹å„ªåŒ–

#### 1. çµ„ä»¶åŒ–è¨­è¨ˆ
```typescript
// å‹•ç•«æ§åˆ¶å™¨
class WinAnimationController {
    static playBounceAnimation(element: HTMLElement): void
    static playGlowAnimation(element: HTMLElement): void
    static stopAllAnimations(element: HTMLElement): void
}
```

#### 2. é…ç½®é©…å‹•
```typescript
// å‹•ç•«é…ç½®
interface AnimationConfig {
    duration: number;
    easing: string;
    effects: AnimationEffect[];
}
```

---

## é¡Œç›®ä¸‰ï¼šBaseGame è´åˆ†é¾ç é¡¯ç¤º

### å¯¦ä½œæ¦‚å¿µ

é€ééŠæˆ²çš„ PureMVC äº‹ä»¶ç³»çµ±ï¼Œåœ¨ BaseGame æ»¾åœå¾Œç™¼é€è´åˆ†äº‹ä»¶ï¼Œè®“ç•«é¢ä¸Šæ–¹çš„å¤§é¾ç é¡¯ç¤ºç•¶å±€è´åˆ†ï¼Œä¸¦åœ¨ä¸‹æ¬¡ spin æ™‚è‡ªå‹•æ¸…é™¤ã€‚

### æ ¸å¿ƒè¨­è¨ˆæ€è·¯

#### 1. äº‹ä»¶é©…å‹•æ¶æ§‹
```
BaseGameæ»¾åœ â†’ è¨ˆç®—è´åˆ† â†’ ç™¼é€äº‹ä»¶ â†’ é¾ç é¡¯ç¤º â†’ ä¸‹æ¬¡spinæ¸…é™¤
     â†“           â†“         â†“         â†“         â†“
  æ»¾è»¸åœæ­¢   è´åˆ†>0åˆ¤æ–·  PureMVCé€šçŸ¥  setBallCredit  hideBallCredit
```

#### 2. çµ„ä»¶åˆ†å·¥
- **Command**ï¼š`GAME_Game1RollCompleteCommand` - è² è²¬äº‹ä»¶è§¸ç™¼
- **Event**ï¼š`DragonUpEvent.ON_BASEGAME_WIN_DISPLAY` - äº‹ä»¶å¸¸æ•¸
- **Mediator**ï¼š`BallHitViewMediator` - è² è²¬UIæ§åˆ¶
- **View**ï¼š`BallHitView` - é¾ç é¡¯ç¤ºçµ„ä»¶

### è©³ç´°å¯¦ä½œæ­¥é©Ÿ

#### æ­¥é©Ÿ1ï¼šå®šç¾©äº‹ä»¶å¸¸æ•¸

**åœ¨ `Constant.ts` ä¸­æ–°å¢äº‹ä»¶**ï¼š

```typescript
export class DragonUpEvent {
    // ç¾æœ‰äº‹ä»¶...
    
    /** BaseGame æ»¾åœå¾Œé¡¯ç¤ºè´åˆ†åœ¨é¾ç ä¸Š */
    public static ON_BASEGAME_WIN_DISPLAY: string = 'onBaseGameWinDisplay';
}
```

**é—œéµè¦é»**ï¼š
- ä½¿ç”¨ç¾æœ‰çš„ `DragonUpEvent` é¡åˆ¥ï¼Œä¿æŒäº‹ä»¶åˆ†é¡ä¸€è‡´
- äº‹ä»¶åç¨±æ¸…æ¥šè¡¨é”åŠŸèƒ½ç›®çš„

#### æ­¥é©Ÿ2ï¼šå¯¦ä½œäº‹ä»¶è§¸ç™¼é‚è¼¯

**åœ¨ `GAME_Game1RollCompleteCommand.ts` ä¸­ä¿®æ”¹**ï¼š

```typescript
import { ViewMediatorEvent, DragonUpEvent } from 'src/sgv3/util/Constant';

export class GAME_Game1RollCompleteCommand extends Game1RollCompleteCommand {
    public execute(notification: puremvc.INotification): void {
        // ç¾æœ‰é‚è¼¯...
        
        // é¡Œç›®ä¸‰ï¼šç™¼é€ BaseGame æ»¾åœå¾Œçš„è´åˆ†äº‹ä»¶
        this.triggerBaseGameWinDisplay();
        
        // å…¶ä»–ç¾æœ‰é‚è¼¯...
    }

    private triggerBaseGameWinDisplay(): void {
        const spinResult = this.gameDataProxy.spinEventData;
        const baseGameWin = spinResult.baseGameResult.baseGameTotalWin;
        
        // åªæœ‰åœ¨æœ‰è´åˆ†æ™‚æ‰ç™¼é€äº‹ä»¶
        if (baseGameWin > 0) {
            // ç™¼é€é¾ç é¡¯ç¤ºè´åˆ†äº‹ä»¶ï¼Œå¸¶ä¸Šè´åˆ†åƒæ•¸
            this.sendNotification(DragonUpEvent.ON_BASEGAME_WIN_DISPLAY, {
                winAmount: baseGameWin,
                formattedWin: this._gameDataProxy.convertCredit2Cash(baseGameWin)
            });
        }
    }
}
```

**é—œéµå¯¦ä½œé»**ï¼š
- åœ¨ `execute()` æ–¹æ³•ä¸­é©ç•¶ä½ç½®èª¿ç”¨è§¸ç™¼å‡½æ•¸
- æª¢æŸ¥ `baseGameWin > 0` ç¢ºä¿åªæœ‰çœŸæ­£æœ‰è´åˆ†æ‰é¡¯ç¤º
- åŒæ™‚æä¾›åŸå§‹æ•¸å€¼å’Œæ ¼å¼åŒ–å­—ä¸²ï¼Œå¢åŠ ä½¿ç”¨å½ˆæ€§
- ä½¿ç”¨ `convertCredit2Cash()` ç¢ºä¿é¡¯ç¤ºæ ¼å¼ä¸€è‡´

#### æ­¥é©Ÿ3ï¼šå¯¦ä½œäº‹ä»¶æ¥æ”¶å’Œè™•ç†

**åœ¨ `BallHitViewMediator.ts` ä¸­ä¿®æ”¹**ï¼š

```typescript
public listNotificationInterests(): Array<any> {
    return [
        // ç¾æœ‰äº‹ä»¶åˆ—è¡¨...
        DragonUpEvent.ON_BASEGAME_WIN_DISPLAY,
    ];
}

public handleNotification(notification: puremvc.INotification): void {
    let name = notification.getName();
    switch (name) {
        // ç¾æœ‰caseè™•ç†...
        
        case DragonUpEvent.ON_BASEGAME_WIN_DISPLAY:
            this.displayBaseGameWinOnBall(notification.getBody());
            break;
    }
}

private displayBaseGameWinOnBall(data: { winAmount: number; formattedWin: string }): void {
    // æª¢æŸ¥ç›®å‰å ´æ™¯æ˜¯å¦ç‚º Game_1 (BaseGame)
    if (this.gameDataProxy.curScene !== GameScene.Game_1) {
        return;
    }

    // åœ¨ä¸Šæ–¹å¤§é¾ç é¡¯ç¤ºç•¶å±€ BaseGame è´åˆ†
    // playType 0 è¡¨ç¤º BaseGame çš„é¡¯ç¤ºæ¨¡å¼
    this.view.setBallCredit(data.formattedWin, 0);
}
```

**è¨­è¨ˆè€ƒé‡**ï¼š
- å ´æ™¯æª¢æŸ¥ç¢ºä¿åªåœ¨ BaseGame ä¸­è§¸ç™¼
- `playType 0` å°æ‡‰ BaseGame çš„é¡¯ç¤ºæ¨¡å¼
- ä½¿ç”¨ç¾æœ‰çš„ `setBallCredit()` æ–¹æ³•ï¼Œç¢ºä¿é¡¯ç¤ºä¸€è‡´æ€§

#### æ­¥é©Ÿ4ï¼šå¯¦ä½œè‡ªå‹•æ¸…é™¤é‚è¼¯

**åœ¨ `BallHitViewMediator.ts` ä¸­ä¿®æ”¹ spin è™•ç†**ï¼š

```typescript
private onSpinDown() {
    // åœ¨ BaseGame ä¸­ï¼Œspin é–‹å§‹æ™‚æ¸…é™¤é¾ç ä¸Šçš„è´åˆ†é¡¯ç¤º
    if (this.gameDataProxy.curScene === GameScene.Game_1) {
        this.hideBallCredit();
    }
    
    // ç¾æœ‰çš„å…¶ä»–è™•ç†é‚è¼¯...
    if (this.gameDataProxy.gameState == StateMachineProxy.GAME4_END) {
        if (this.bCanUseSkip == false) return;
        this.bCanUseSkip = false;
        this.tempFunc();
    }
}
```

**è‡ªå‹•æ¸…é™¤æ©Ÿåˆ¶**ï¼š
- åˆ©ç”¨ç¾æœ‰çš„ `ScreenEvent.ON_SPIN_DOWN` äº‹ä»¶
- åœ¨ç©å®¶é»æ“Š spin æŒ‰éˆ•æ™‚ç«‹å³æ¸…é™¤é¡¯ç¤º
- ä½¿ç”¨ç¾æœ‰çš„ `hideBallCredit()` æ–¹æ³•ç¢ºä¿æ¸…é™¤å¾¹åº•

### æ ¸å¿ƒæŠ€è¡“ç´°ç¯€

#### 1. é¾ç é¡¯ç¤ºæ©Ÿåˆ¶

**ç¾æœ‰ç³»çµ±æ¶æ§‹**ï¼š
```typescript
BallHitView.setBallCredit(score, playType) 
    â†“
JackPotPerformControl.OnScoreCollect(score, playType)
    â†“
å¯¦éš›çš„é¾ç UIæ›´æ–°
```

**playType åƒæ•¸èªªæ˜**ï¼š
- `0`ï¼šBaseGame æ¨¡å¼ï¼ˆæˆ‘å€‘ä½¿ç”¨çš„ï¼‰
- `1`ï¼šFree Game æ¨¡å¼
- `2`ï¼šDragon Up æ¨¡å¼
- `3`ï¼šéš±è—æ¨¡å¼

#### 2. äº‹ä»¶æ™‚åºæ§åˆ¶

**åŸ·è¡Œé †åº**ï¼š
```
1. ç©å®¶é»æ“Š spin
2. ä¼ºæœå™¨å›å‚³çµæœ
3. æ»¾è»¸åœæ­¢ â†’ GAME_Game1RollCompleteCommand.execute()
4. è¨ˆç®—ä¸¦é¡¯ç¤ºå„ç¨®çµæœï¼ˆé€£ç·šã€ç‰¹æ®Šçç­‰ï¼‰
5. è§¸ç™¼é¾ç è´åˆ†é¡¯ç¤º â† æˆ‘å€‘çš„å¯¦ä½œé»
6. ç©å®¶çœ‹åˆ°å®Œæ•´çµæœ
```

#### 3. å ´æ™¯ç”Ÿå‘½é€±æœŸç®¡ç†

**å ´æ™¯æª¢æŸ¥çš„é‡è¦æ€§**ï¼š
- ç¢ºä¿åªåœ¨ BaseGame å ´æ™¯è§¸ç™¼
- é¿å…åœ¨ Free Game æˆ–å…¶ä»–ç‰¹æ®Šå ´æ™¯ä¸­èª¤è§¸ç™¼
- ä¿æŒå„å ´æ™¯åŠŸèƒ½çš„ç¨ç«‹æ€§

### æ¸¬è©¦èˆ‡é©—è­‰

#### è‡ªå‹•æ¸¬è©¦æµç¨‹
1. å•Ÿå‹•éŠæˆ²é€²å…¥ BaseGame
2. é€²è¡Œ spin æ“ä½œ
3. è§€å¯Ÿä¸­çå±€ï¼š
   - æ»¾åœå¾Œä¸Šæ–¹å¤§é¾ç æ˜¯å¦é¡¯ç¤ºè´åˆ†
   - é¡¯ç¤ºçš„é‡‘é¡æ˜¯å¦æ­£ç¢º
   - æ ¼å¼æ˜¯å¦èˆ‡éŠæˆ²ä¸€è‡´
4. ä¸‹ä¸€æ¬¡ spinï¼š
   - é»æ“Š spin æŒ‰éˆ•æ™‚é¾ç é¡¯ç¤ºæ˜¯å¦ç«‹å³æ¸…é™¤
   - æ–°å±€çµæœæ˜¯å¦æ­£ç¢ºæ›´æ–°

#### é‚Šç•Œæƒ…æ³æ¸¬è©¦
1. **ç„¡è´åˆ†å±€**ï¼šç¢ºèªä¸æœƒé¡¯ç¤ºä»»ä½•å…§å®¹
2. **å ´æ™¯åˆ‡æ›**ï¼šç¢ºèªåœ¨å…¶ä»–å ´æ™¯ä¸æœƒè§¸ç™¼
3. **é€£çºŒä¸­ç**ï¼šç¢ºèªæ¯å±€éƒ½æ­£ç¢ºæ›´æ–°é¡¯ç¤º
4. **å¤§é¡è´åˆ†**ï¼šç¢ºèªæ ¼å¼åŒ–é¡¯ç¤ºæ­£ç¢º

### æŠ€è¡“äº®é»

#### 1. ç„¡ä¾µå…¥æ€§è¨­è¨ˆ
- å®Œå…¨åˆ©ç”¨ç¾æœ‰çš„ç³»çµ±çµ„ä»¶
- ä¸éœ€è¦ä¿®æ”¹ UI Prefab æˆ–å‰µå»ºæ–°çµ„ä»¶
- èˆ‡ç¾æœ‰ Free Game é¾ç åŠŸèƒ½å®Œç¾å…±å­˜

#### 2. äº‹ä»¶é©…å‹•æ¶æ§‹
- éµå¾ª PureMVC è¨­è¨ˆæ¨¡å¼
- ä½è€¦åˆï¼Œæ˜“æ–¼ç¶­è­·å’Œæ“´å±•
- ç¬¦åˆç¾æœ‰ä»£ç¢¼é¢¨æ ¼å’Œæ¶æ§‹

#### 3. ç”¨æˆ¶é«”é©—è€ƒé‡
- å³æ™‚åé¥‹ï¼šæ»¾åœå¾Œç«‹å³é¡¯ç¤º
- è‡ªå‹•æ¸…ç†ï¼šä¸‹æ¬¡ spin è‡ªå‹•æ¸…é™¤ï¼Œé¿å…è¦–è¦ºæ··äº‚
- ä¸€è‡´æ€§ï¼šä½¿ç”¨èˆ‡ Free Game ç›¸åŒçš„é¡¯ç¤ºé‚è¼¯

---

## ç¸½çµ

### æŠ€è¡“æˆæœ

#### é¡Œç›®ä¸€æˆæœ
- âœ… **Consoleè¼¸å‡º**ï¼šæ ¼å¼åŒ–é¡¯ç¤ºä¸­çä¿¡æ¯
- âœ… **ç•«é¢é¡¯ç¤º**ï¼šHTMLè¦†è“‹å±¤åœ¨è¢å¹•ä¸­å¤®é¡¯ç¤º
- âœ… **è‡ªå‹•è§¸ç™¼**ï¼šçœŸå¯¦éŠæˆ²ä¸­çæ™‚è‡ªå‹•é¡¯ç¤º
- âœ… **PureMVCæ•´åˆ**ï¼šå®Œç¾èå…¥ç¾æœ‰æ¶æ§‹

#### é¡Œç›®äºŒæˆæœ
- âœ… **æŒçºŒå‹•ç•«**ï¼šæ•´å€‹é¡¯ç¤ºæœŸé–“éƒ½æœ‰å‹•æ…‹æ•ˆæœ
- âœ… **è¦–è¦ºå¢å¼·**ï¼šæ–æ“ºã€ç™¼å…‰ã€ç¸®æ”¾å¤šé‡æ•ˆæœ
- âœ… **æ€§èƒ½å„ªåŒ–**ï¼šè¼•é‡ç´šCSSå‹•ç•«ï¼Œä¸å½±éŸ¿éŠæˆ²æ€§èƒ½
- âœ… **å®Œç¾æ•´åˆ**ï¼šèˆ‡é¡Œç›®ä¸€ç„¡ç¸«é…åˆ

#### é¡Œç›®ä¸‰æˆæœ
- âœ… **äº‹ä»¶é©…å‹•**ï¼šå®Œç¾æ•´åˆPureMVCäº‹ä»¶ç³»çµ±
- âœ… **å³æ™‚é¡¯ç¤º**ï¼šBaseGameæ»¾åœå¾Œç«‹å³é¡¯ç¤ºè´åˆ†
- âœ… **è‡ªå‹•æ¸…é™¤**ï¼šä¸‹æ¬¡spinè‡ªå‹•æ¸…é™¤ï¼Œç”¨æˆ¶é«”é©—ä½³
- âœ… **ç„¡ä¾µå…¥æ€§**ï¼šåˆ©ç”¨ç¾æœ‰çµ„ä»¶ï¼Œä¸ç ´å£åŸæ¶æ§‹

### é–‹ç™¼æ€è·¯ç¸½çµ

é€™å€‹å¯¦ä½œå±•ç¤ºäº†å¹¾å€‹é‡è¦çš„é–‹ç™¼æ€è·¯ï¼š

1. **ç”±ç°¡åˆ°ç¹**ï¼šå…ˆå¯¦ç¾Consoleè¼¸å‡ºï¼Œå†è™•ç†UIé¡¯ç¤ºï¼Œæœ€å¾Œæ·»åŠ å‹•ç•«å’Œé¾ç é¡¯ç¤º
2. **æ¶æ§‹ç†è§£**ï¼šæ·±å…¥ç†è§£ç¾æœ‰ç³»çµ±çš„è¨­è¨ˆæ¨¡å¼ï¼ˆPureMVCã€äº‹ä»¶ç³»çµ±ï¼‰
3. **å‰µæ–°è§£æ±º**ï¼šç•¶å‚³çµ±æ–¹æ³•é‡åˆ°å›°é›£æ™‚ï¼Œæ¡ç”¨HTMLè¦†è“‹å±¤å‰µæ–°æ–¹æ¡ˆ
4. **ä»£ç¢¼å“è³ª**ï¼šæœ€çµ‚æ¸…ç†å†—é¤˜ï¼Œä¿æŒçµæ§‹æ¸…æ½”
5. **ç”¨æˆ¶é«”é©—**ï¼šé‡è¦–è¦–è¦ºæ•ˆæœå’Œäº¤äº’åé¥‹
6. **ç³»çµ±æ•´åˆ**ï¼šå……åˆ†åˆ©ç”¨ç¾æœ‰çµ„ä»¶ï¼Œæ¸›å°‘é‡è¤‡é–‹ç™¼

### å­¸ç¿’åƒ¹å€¼

é€šéé€™å€‹å°ˆæ¡ˆï¼Œæˆ‘å€‘å­¸ç¿’äº†ï¼š

- **PureMVCæ¶æ§‹æ¨¡å¼**ï¼šCommand-Mediator-Proxyçš„åˆ†å·¥å”ä½œ
- **Cocos Creatorèˆ‡WebæŠ€è¡“æ•´åˆ**ï¼šHTMLè¦†è“‹å±¤æŠ€è¡“çš„æ‡‰ç”¨
- **CSSå‹•ç•«æŠ€è¡“**ï¼škeyframesã€transformã€animationçš„ä½¿ç”¨
- **TypeScriptåœ¨éŠæˆ²é–‹ç™¼ä¸­çš„æ‡‰ç”¨**
- **äº‹ä»¶é©…å‹•è¨­è¨ˆ**ï¼šè§£è€¦åˆçš„ç³»çµ±é€šè¨Šæ©Ÿåˆ¶
- **ç¾æœ‰ç³»çµ±æ•´åˆ**ï¼šå¦‚ä½•åœ¨ä¸ç ´å£åŸæ¶æ§‹ä¸‹æ–°å¢åŠŸèƒ½
- **å•é¡Œåˆ†æèˆ‡å‰µæ–°è§£æ±ºèƒ½åŠ›**

---

## é¡Œç›®å››ï¼šå€’æ•¸äº”ç§’ç‹€æ…‹

### å¯¦ä½œæ¦‚å¿µ

åœ¨game1çš„spinå’ŒrollCompleteä¹‹é–“æ’å…¥ä¸€å€‹æ–°çš„ç‹€æ…‹ï¼Œé¡¯ç¤º5ç§’å€’æ•¸ï¼Œä½¿ç”¨HTMLè¦†è“‹å±¤å…¨ç¨‹å¼å¯¦ä½œã€‚

### æ ¸å¿ƒè¨­è¨ˆæ€è·¯

#### 1. ç‹€æ…‹æ©Ÿä¿®æ”¹
```
åŸæµç¨‹ï¼šGAME1_SPIN â†’ GAME1_ROLLCOMPLETE
æ–°æµç¨‹ï¼šGAME1_SPIN â†’ GAME1_COUNTDOWN â†’ GAME1_ROLLCOMPLETE
```

#### 2. çµ„ä»¶åˆ†å·¥
- **StateMachineProxy**ï¼šæ–°å¢å€’æ•¸ç‹€æ…‹å®šç¾©å’Œè½‰æ›é‚è¼¯
- **Command**ï¼š`Game1CountdownCommand` - è² è²¬å€’æ•¸é‚è¼¯æ§åˆ¶
- **Mediator**ï¼š`CountdownDisplayMediator` - è² è²¬HTMLè¦†è“‹å±¤é¡¯ç¤º
- **BaseReelViewMediator**ï¼šä¿®æ”¹è§¸ç™¼é»å¾ROLLCOMPLETEæ”¹ç‚ºCOUNTDOWN

### è©³ç´°å¯¦ä½œæ­¥é©Ÿ

#### æ­¥é©Ÿ1ï¼šå‰µå»ºåŸºç¤å€’æ•¸Command

**`assets/src/sgv3/command/state/Game1CountdownCommand.ts`**
```typescript
export class Game1CountdownCommand extends StateCommand {
    public static readonly NAME = StateMachineProxy.GAME1_EV_COUNTDOWN;

    public execute(notification: puremvc.INotification): void {
        this.notifyWebControl();
        // åŸºç¤5ç§’å€’æ•¸é‚è¼¯
        GlobalTimer.getInstance().registerTimer('game1Countdown', 5, () => {
            this.changeState(StateMachineProxy.GAME1_ROLLCOMPLETE);
        }, this).start();
    }
}
```

#### æ­¥é©Ÿ2ï¼šå‰µå»ºéŠæˆ²å°ˆæ¡ˆå€’æ•¸Command

**`assets/src/game/command/state/GAME_Game1CountdownCommand.ts`**
```typescript
export class GAME_Game1CountdownCommand extends Game1CountdownCommand {
    public execute(notification: puremvc.INotification): void {
        this.notifyWebControl();
        
        // è§¸ç™¼HTMLè¦†è“‹å±¤é¡¯ç¤º
        this.sendNotification('SHOW_COUNTDOWN_DISPLAY');
        
        // é–‹å§‹å€’æ•¸é‚è¼¯ï¼šæ¯ç§’æ›´æ–°é¡¯ç¤ºï¼Œ5ç§’å¾Œå®Œæˆ
        this.startCountdownProcess();
    }
    
    private startCountdownProcess(): void {
        // å¯¦ç¾æ¯ç§’æ›´æ–°çš„å€’æ•¸é‚è¼¯
        // 5â†’4â†’3â†’2â†’1â†’å®Œæˆé€²å…¥ROLLCOMPLETE
    }
}
```

#### æ­¥é©Ÿ3ï¼šå‰µå»ºHTMLè¦†è“‹å±¤æ§åˆ¶å™¨

**`assets/src/game/mediator/CountdownDisplayMediator.ts`**
```typescript
export class CountdownDisplayMediator extends BaseMediator<any> {
    public listNotificationInterests(): Array<any> {
        return [
            'SHOW_COUNTDOWN_DISPLAY',
            'UPDATE_COUNTDOWN_DISPLAY', 
            'HIDE_COUNTDOWN_DISPLAY'
        ];
    }

    private showCountdownDisplay(): void {
        // å‰µå»ºHTMLè¦†è“‹å±¤ï¼Œæ¨£å¼é¡ä¼¼é¡Œç›®ä¸€
        this.htmlOverlay = document.createElement('div');
        this.htmlOverlay.style.cssText = `
            position: fixed; top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            color: #FFD700; font-size: 120px;
            // åŠ å…¥è„ˆè¡å‹•ç•«æ•ˆæœ
        `;
    }
}
```

#### æ­¥é©Ÿ4ï¼šä¿®æ”¹ç‹€æ…‹æ©Ÿ

**`assets/src/sgv3/proxy/StateMachineProxy.ts`**
```typescript
// æ–°å¢ç‹€æ…‹å¸¸æ•¸
public static readonly GAME1_COUNTDOWN: string = 'game1Countdown';
public static readonly GAME1_EV_COUNTDOWN: string = 'game1EvCountdown';

// ä¿®æ”¹ç‹€æ…‹è½‰æ›æ˜ å°„
this.stateMachineMap[StateMachineProxy.GAME1_SPIN] = [StateMachineProxy.GAME1_COUNTDOWN];
this.stateMachineMap[StateMachineProxy.GAME1_COUNTDOWN] = [StateMachineProxy.GAME1_ROLLCOMPLETE];

// æ–°å¢äº‹ä»¶æ˜ å°„
this.stateEventMap[StateMachineProxy.GAME1_COUNTDOWN] = StateMachineProxy.GAME1_EV_COUNTDOWN;
```

#### æ­¥é©Ÿ5ï¼šä¿®æ”¹æ»¾è»¸è§¸ç™¼é»

**`assets/src/sgv3/mediator/base/BaseReelViewMediator.ts`**
```typescript
protected onReelsRollComplete(): void {
    switch (this.gameDataProxy.curScene) {
        case GameScene.Game_1:
            // æ”¹ç‚ºè§¸ç™¼å€’æ•¸ç‹€æ…‹è€Œä¸æ˜¯ç›´æ¥é€²å…¥ROLLCOMPLETE
            this.sendNotification(
                StateMachineCommand.NAME,
                new StateMachineObject(StateMachineProxy.GAME1_COUNTDOWN)
            );
            break;
    }
}
```

#### æ­¥é©Ÿ6ï¼šè¨»å†Šæ–°çµ„ä»¶

**`assets/src/game/command/GAME_RegisterPuremvcCommand.ts`**
```typescript
protected registerMediator(notification: puremvc.INotification): void {
    super.registerMediator(notification);
    
    // è¨»å†Šå€’æ•¸é¡¯ç¤º Mediator
    this.facade.registerMediator(new CountdownDisplayMediator());
}
```

### è¦–è¦ºæ•ˆæœè¨­è¨ˆ

#### å€’æ•¸é¡¯ç¤ºç‰¹æ•ˆ
- **å±…ä¸­é¡¯ç¤º**ï¼šè¢å¹•æ­£ä¸­å¤®çš„å¤§å‹å€’æ•¸æ•¸å­—
- **è¦–è¦ºå¢å¼·**ï¼šé‡‘è‰²æ–‡å­—ã€ç™¼å…‰è„ˆè¡ã€æ™‚é˜åœ–ç¤ºâ°
- **å‹•æ…‹æ›´æ–°**ï¼šæ¯ç§’æ›´æ–°æ•¸å­—ï¼Œæ­é…å½ˆè·³å‹•ç•«
- **é¡è‰²è®ŠåŒ–**ï¼šæœ€å¾Œ1-2ç§’æ•¸å­—è®Šç´…è‰²å¢åŠ ç·Šè¿«æ„Ÿ
- **è‡ªå‹•æ¸…é™¤**ï¼šå€’æ•¸å®Œæˆå¾Œå¹³æ»‘æ·¡å‡º

#### CSSå‹•ç•«æ•ˆæœ
```css
@keyframes countdownPulse {
    0%, 100% { transform: translate(-50%, -50%) scale(1); }
    50% { transform: translate(-50%, -50%) scale(1.05); }
}

@keyframes numberBounce {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.1); }
}
```

### å¯¦ä½œé—œéµè¦é»

#### 1. ç‹€æ…‹æ©Ÿå®‰å…¨ä¿®æ”¹
- **æ¼¸é€²å¼ä¿®æ”¹**ï¼šå…ˆå‰µå»ºæ–‡ä»¶å†ä¿®æ”¹ç‹€æ…‹æ©Ÿ
- **å®Œæ•´è¨»å†Š**ï¼šç¢ºä¿æ‰€æœ‰Commandéƒ½æ­£ç¢ºè¨»å†Š
- **ç‹€æ…‹æµç¨‹**ï¼šä¿æŒåŸæœ‰éŠæˆ²é‚è¼¯å®Œæ•´æ€§

#### 2. è¨ˆæ™‚å™¨ç®¡ç†
```typescript
// é¿å…GlobalTimer IDè¡çª
private scheduleCountdownTimer(): void {
    GlobalTimer.getInstance().removeTimer(this.TIMER_KEY); // å…ˆæ¸…é™¤
    GlobalTimer.getInstance().registerTimer(this.TIMER_KEY, 1, () => {
        this.onCountdownTick();
    }, this).start();
}
```

#### 3. HTMLè¦†è“‹å±¤æŠ€è¡“
- ä½¿ç”¨èˆ‡é¡Œç›®ä¸€ç›¸åŒçš„æŠ€è¡“æ–¹æ¡ˆ
- `position: fixed` + `z-index: 10000` ç¢ºä¿æœ€é ‚å±¤é¡¯ç¤º
- å®Œå…¨ç¹éCocos Creatoræ¸²æŸ“ç³»çµ±

### æŠ€è¡“æŒ‘æˆ°èˆ‡è§£æ±ºæ–¹æ¡ˆ

#### æŒ‘æˆ°1ï¼šç‹€æ…‹æ©Ÿä¿®æ”¹é¢¨éšª
**è§£æ±ºæ–¹æ¡ˆ**ï¼šæ¡ç”¨æ¼¸é€²å¼å¯¦ä½œé †åºï¼Œé¿å…ä¸­é–“ç‹€æ…‹çš„ç·¨è­¯éŒ¯èª¤

#### æŒ‘æˆ°2ï¼šè¨ˆæ™‚å™¨IDè¡çª
**è§£æ±ºæ–¹æ¡ˆ**ï¼šæ¯æ¬¡è¨»å†Šå‰å…ˆæ¸…é™¤èˆŠè¨ˆæ™‚å™¨ï¼Œç¢ºä¿IDå”¯ä¸€æ€§

#### æŒ‘æˆ°3ï¼šèˆ‡ç¾æœ‰æµç¨‹æ•´åˆ
**è§£æ±ºæ–¹æ¡ˆ**ï¼šä¿®æ”¹BaseReelViewMediatorè§¸ç™¼é»ï¼Œä¿æŒå…¶ä»–é‚è¼¯ä¸è®Š

### æ¸¬è©¦é©—è­‰

#### è‡ªå‹•æ¸¬è©¦æµç¨‹
1. å•Ÿå‹•éŠæˆ²é€²å…¥Game1å ´æ™¯
2. é»æ“ŠSPINæŒ‰éˆ•
3. è§€å¯Ÿï¼šæ»¾è»¸åœæ­¢å¾Œæ˜¯å¦å‡ºç¾å€’æ•¸5ç§’ç•«é¢
4. ç¢ºèªï¼šå€’æ•¸å®Œæˆå¾Œæ˜¯å¦æ­£å¸¸é€²å…¥ROLLCOMPLETEæµç¨‹

#### æ‰‹å‹•æ¸¬è©¦
```javascript
// ç€è¦½å™¨Consoleæ¸¬è©¦
testCountdownDisplay()  // æ¸¬è©¦å€’æ•¸é¡¯ç¤º
hideCountdownDisplay()  // æ‰‹å‹•éš±è—
```

---

## ç¸½çµ

### å››é¡Œæ•´é«”æŠ€è¡“æˆæœ

é€™å››å€‹ç·´ç¿’é¡Œå±•ç¤ºäº†å®Œæ•´çš„éŠæˆ²é–‹ç™¼æŠ€è¡“æ£§ï¼š

#### é¡Œç›®ä¸€ï¼šæ•¸æ“šè™•ç†èˆ‡UIé¡¯ç¤º
- âœ… å­¸ç¿’éŠæˆ²æ•¸æ“šè§£æå’Œè™•ç†
- âœ… æŒæ¡HTMLè¦†è“‹å±¤æŠ€è¡“
- âœ… ç†è§£PureMVCäº‹ä»¶é€šè¨Šæ©Ÿåˆ¶

#### é¡Œç›®äºŒï¼šå‹•ç•«èˆ‡è¦–è¦ºæ•ˆæœ  
- âœ… CSSå‹•ç•«æŠ€è¡“æ‡‰ç”¨
- âœ… è¦–è¦ºæ•ˆæœè¨­è¨ˆæ€ç¶­
- âœ… æ€§èƒ½å„ªåŒ–è€ƒé‡

#### é¡Œç›®ä¸‰ï¼šç³»çµ±æ•´åˆèˆ‡äº‹ä»¶é©…å‹•
- âœ… äº‹ä»¶é©…å‹•æ¶æ§‹è¨­è¨ˆ
- âœ… ç¾æœ‰çµ„ä»¶çš„æ·±åº¦åˆ©ç”¨
- âœ… ç”¨æˆ¶é«”é©—è¨­è¨ˆ

#### é¡Œç›®å››ï¼šç‹€æ…‹æ©Ÿèˆ‡æ¶æ§‹ä¿®æ”¹
- âœ… æ ¸å¿ƒç³»çµ±ç‹€æ…‹æ©Ÿç†è§£å’Œä¿®æ”¹
- âœ… è¤‡é›œç³»çµ±çš„å®‰å…¨æ”¹å‹•ç­–ç•¥
- âœ… è¨ˆæ™‚å™¨å’Œç”Ÿå‘½é€±æœŸç®¡ç†

### å­¸ç¿’åƒ¹å€¼ç¸½çµ

é€šéé€™å€‹å°ˆæ¡ˆï¼Œæˆ‘å€‘å­¸ç¿’äº†ï¼š

- **PureMVCæ¶æ§‹æ¨¡å¼**ï¼šCommand-Mediator-Proxyçš„åˆ†å·¥å”ä½œ
- **Cocos Creatorèˆ‡WebæŠ€è¡“æ•´åˆ**ï¼šHTMLè¦†è“‹å±¤æŠ€è¡“çš„æ‡‰ç”¨
- **CSSå‹•ç•«æŠ€è¡“**ï¼škeyframesã€transformã€animationçš„ä½¿ç”¨
- **TypeScriptåœ¨éŠæˆ²é–‹ç™¼ä¸­çš„æ‡‰ç”¨**
- **äº‹ä»¶é©…å‹•è¨­è¨ˆ**ï¼šè§£è€¦åˆçš„ç³»çµ±é€šè¨Šæ©Ÿåˆ¶
- **ç¾æœ‰ç³»çµ±æ•´åˆ**ï¼šå¦‚ä½•åœ¨ä¸ç ´å£åŸæ¶æ§‹ä¸‹æ–°å¢åŠŸèƒ½
- **ç‹€æ…‹æ©Ÿè¨­è¨ˆèˆ‡ä¿®æ”¹**ï¼šéŠæˆ²æ ¸å¿ƒé‚è¼¯çš„ç†è§£å’Œå®‰å…¨ä¿®æ”¹
- **å•é¡Œåˆ†æèˆ‡å‰µæ–°è§£æ±ºèƒ½åŠ›**

é€™ä¸åƒ…å®Œæˆäº†åŠŸèƒ½éœ€æ±‚ï¼Œæ›´é‡è¦çš„æ˜¯æŒæ¡äº†éŠæˆ²é–‹ç™¼ä¸­çš„æ¶æ§‹è¨­è¨ˆå’Œå•é¡Œè§£æ±ºæ€ç¶­ï¼Œå­¸æœƒäº†å¦‚ä½•åœ¨è¤‡é›œç³»çµ±ä¸­æ‰¾åˆ°æœ€ä½³çš„æ•´åˆé»ã€‚