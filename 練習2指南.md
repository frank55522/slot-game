# ç·´ç¿’2 ç¬¬ä¸€é¡Œå¯¦ä½œæŒ‡å—

## é¡Œç›®æè¿°
èª¿æ•´feature gameçµç®—æµç¨‹ï¼šç•¶free gamesæˆ–dragon bonus gamesçµæŸæ™‚ï¼Œå¦‚æœç¸½è´åˆ†ä½æ–¼Big Winé–€æª»ï¼Œå‰‡è·³éçµç®—é¢æ¿ç›´æ¥è¿”å›BaseGameã€‚

## 1. å¯¦ä½œå‰çš„æ€è·¯æ§‹ç¯‰

### 1.1 å•é¡Œåˆ†æ
- **æ ¸å¿ƒéœ€æ±‚**ï¼šæ¢ä»¶æ€§è·³éçµç®—é¢æ¿é¡¯ç¤º
- **è§¸ç™¼æ¢ä»¶**ï¼šç¸½è´åˆ† < Big Winé–€æª»
- **å½±éŸ¿ç¯„åœ**ï¼šFree Gameçµç®—ã€Dragon Bonusçµç®—
- **é æœŸè¡Œç‚º**ï¼šä½æ–¼é–€æª»æ™‚ç›´æ¥å›åˆ°BaseGameï¼Œé”åˆ°é–€æª»æ™‚æ­£å¸¸é¡¯ç¤ºçµç®—é¢æ¿

### 1.2 æŠ€è¡“æ€è€ƒé»
1. éœ€è¦æ‰¾åˆ°Big Winé–€æª»çš„å®šç¾©ä½ç½®
2. éœ€è¦æ‰¾åˆ°çµç®—é¢æ¿é¡¯ç¤ºçš„æ§åˆ¶é‚è¼¯
3. éœ€è¦äº†è§£PureMVCçš„Commandæ¨¡å¼
4. éœ€è¦ç†è§£éŠæˆ²ç‹€æ…‹æµè½‰æ©Ÿåˆ¶

## 2. å°ˆæ¡ˆæ¶æ§‹ç†è§£

### 2.1 éœ€è¦äº†è§£çš„å°ˆæ¡ˆæ ¸å¿ƒéƒ¨åˆ†

#### PureMVCæ¶æ§‹æ¨¡å¼
- **Command**ï¼šè™•ç†æ¥­å‹™é‚è¼¯çš„æŒ‡ä»¤
- **Proxy**ï¼šæ•¸æ“šç®¡ç†ä»£ç†
- **Mediator**ï¼šè¦–åœ–ä¸­ä»‹è€…
- éŠæˆ²ä¸»è¦ä½¿ç”¨Commandä¾†æ§åˆ¶éŠæˆ²æµç¨‹

#### é—œéµç›®éŒ„çµæ§‹
```
assets/src/
â”œâ”€â”€ sgv3/                    # æ¡†æ¶æ ¸å¿ƒ
â”‚   â”œâ”€â”€ command/            # é€šç”¨æŒ‡ä»¤
â”‚   â”œâ”€â”€ proxy/              # æ•¸æ“šä»£ç†
â”‚   â””â”€â”€ vo/                 # å€¼å°è±¡
â”œâ”€â”€ game/                   # éŠæˆ²ç‰¹å®šå¯¦ä½œ
â”‚   â”œâ”€â”€ command/            # éŠæˆ²æŒ‡ä»¤
â”‚   â””â”€â”€ proxy/              # éŠæˆ²ä»£ç†
```

### 2.2 Big Winé–€æª»å®šç¾©ä½ç½®
**æª”æ¡ˆä½ç½®**ï¼š`assets/src/sgv3/command/byGame/MultipleCalculateCommand.ts`

```typescript
// ä¸€èˆ¬æ¸ é“çš„é–€æª»å®šç¾©
const winTypeRangesNormal = [
    { min: 15, max: 35, type: WinType.bigWin, duration: BaseScoringDuration.Scoring_Win01 },
    { min: 35, max: 100, type: WinType.megaWin, duration: BaseScoringDuration.Scoring_Win02 },
    { min: 100, max: Number.MAX_VALUE, type: WinType.epicWin, duration: BaseScoringDuration.Scoring_Win03 }
];

// å…¨æ¸ é“çš„é–€æª»å®šç¾©ï¼ˆè¼ƒé«˜ï¼‰
const winTypeRangesOmni = [
    { min: 17, max: 35, type: WinType.bigWin, duration: BaseScoringDuration.Scoring_Win01 },
    // ...
];
```

**é‡é»**ï¼šå°ˆæ¡ˆä¸»è¦ä½¿ç”¨ä¸€èˆ¬æ¸ é“çš„15å€ä½œç‚ºBig Winé–€æª»

## 3. å¯¦ä½œæ–¹æ³•

### 3.1 å®šä½çµç®—æ§åˆ¶æŒ‡ä»¤

#### Free Gameçµç®—æŒ‡ä»¤
**æª”æ¡ˆä½ç½®**ï¼š`assets/src/game/command/state/GAME_Game2EndCommand.ts`
**æ ¸å¿ƒæ–¹æ³•**ï¼š`showCreditBoard()` - æ§åˆ¶çµç®—é¢æ¿é¡¯ç¤º

#### Dragon Bonusçµç®—æŒ‡ä»¤
**æª”æ¡ˆä½ç½®**ï¼š`assets/src/game/command/dragon-up/GAME_4_CreditCollectResultCommand.ts`
**æ ¸å¿ƒæ–¹æ³•**ï¼š`showCreditBoard()` - æ§åˆ¶çµç®—é¢æ¿é¡¯ç¤º

### 3.2 å¯¦ä½œè·³éé‚è¼¯

åœ¨å…©å€‹çµç®—æŒ‡ä»¤ä¸­éƒ½æ·»åŠ ç›¸åŒçš„åˆ¤æ–·é‚è¼¯ï¼š

```typescript
protected showCreditBoard() {
    // ... åŸæœ‰é‚è¼¯ ...
    
    let totalWin: number = this.gameDataProxy.convertCredit2Cash(
        this.gameDataProxy.spinEventData.playerTotalWin  // æˆ–å°æ‡‰çš„è´åˆ†ä¾†æº
    );

    // æª¢æŸ¥æ˜¯å¦é”åˆ°Big Winæ¨™æº–ï¼Œæœªé”åˆ°å‰‡è·³éçµç®—é¢æ¿
    if (!this.isBigWinOrAbove(totalWin)) {
        // è´åˆ†å°æ–¼Big Winï¼Œç›´æ¥è·³éçµç®—é¢æ¿å›åˆ°BaseGame
        this.delayCloseBoard();
        return;
    }

    // é”åˆ°Big Winä»¥ä¸Šï¼Œæ­£å¸¸é¡¯ç¤ºçµç®—é¢æ¿
    this.sendNotification(StateWinEvent.SHOW_LAST_CREDIT_BOARD, totalWin);
    // ... å¾ŒçºŒé‚è¼¯ ...
}

/**
 * åˆ¤å®šè´åˆ†æ˜¯å¦é”åˆ°Big Winæ¨™æº–
 * @param totalWin ç¸½è´åˆ†é‡‘é¡
 * @returns true: é”åˆ°Big Winä»¥ä¸Š, false: æœªé”åˆ°Big Win
 */
private isBigWinOrAbove(totalWin: number): boolean {
    const curTotalBet = this.gameDataProxy.curTotalBet;
    const winMultiple = MathUtil.div(totalWin, curTotalBet);
    
    // Big Winé–€æª»ï¼šä½¿ç”¨è‡¨æ™‚è¨­å®šæˆ–é è¨­15å€
    const bigWinThreshold = this.gameDataProxy.tempBigWinThreshold;
    
    return winMultiple >= bigWinThreshold;
}
```

### 3.3 æ·»åŠ æ¸¬è©¦åŠŸèƒ½

#### æ•¸æ“šå±¤æ·»åŠ æ¸¬è©¦å±¬æ€§
**æª”æ¡ˆä½ç½®**ï¼š`assets/src/sgv3/vo/config/GameData.ts`
```typescript
/** è‡¨æ™‚Big Winé–€æª»æ¸¬è©¦ */
public tempBigWinThreshold: number = 15;
```

#### ä»£ç†å±¤æ·»åŠ å­˜å–æ–¹æ³•
**æª”æ¡ˆä½ç½®**ï¼š`assets/src/sgv3/proxy/GameDataProxy.ts`
```typescript
/** è‡¨æ™‚Big Winé–€æª»æ¸¬è©¦ */
public get tempBigWinThreshold(): number {
    return this._gameData.tempBigWinThreshold;
}
public set tempBigWinThreshold(_val: number) {
    this._gameData.tempBigWinThreshold = _val;
}
```

#### Webæ©‹æ¥å±¤æ·»åŠ ConsoleæŒ‡ä»¤
**æª”æ¡ˆä½ç½®**ï¼š`assets/src/sgv3/proxy/WebBridgeProxy.ts`

åœ¨ `initAPI()` æ–¹æ³•ä¸­è¨»å†ŠæŒ‡ä»¤ï¼š
```typescript
// ConsoleæŒ‡ä»¤
window['setBigWinThreshold'] = (_threshold: number) => this.setBigWinThreshold(_threshold);
```

å¯¦ä½œæŒ‡ä»¤æ–¹æ³•ï¼š
```typescript
/**
 * è¨­å®šBig Winé–€æª»æ¸¬è©¦
 * ä½¿ç”¨æ–¹å¼ï¼šsetBigWinThreshold(20) - è¨­å®šç‚º20å€
 */
public setBigWinThreshold(threshold: number): void {
    if (threshold && threshold > 0) {
        this.gameDataProxy.tempBigWinThreshold = threshold;
        console.log(`ğŸ¯ Big Winé–€æª»å·²è¨­å®šç‚º ${threshold}x`);
        console.log('ğŸ’¡ æç¤ºï¼šæ­¤è¨­å®šæœƒåœ¨ä¸‹æ¬¡feature gameçµç®—æ™‚ç”Ÿæ•ˆ');
    } else {
        console.log('âŒ è«‹è¼¸å…¥å¤§æ–¼0çš„æ•¸å€¼');
    }
}
```

## 4. é—œéµæŠ€è¡“é»èªªæ˜

### 4.1 PureMVC Commandæ¨¡å¼
- Commandè² è²¬è™•ç†å…·é«”çš„æ¥­å‹™é‚è¼¯
- é€é `sendNotification()` ç™¼é€äº‹ä»¶é€šçŸ¥
- é€é `facade.retrieveProxy()` ç²å–æ•¸æ“šä»£ç†

### 4.2 æ•¸å­¸è¨ˆç®—
ä½¿ç”¨ `MathUtil.div()` é€²è¡Œæµ®é»æ•¸é™¤æ³•ï¼Œé¿å…JavaScriptæµ®é»æ•¸ç²¾åº¦å•é¡Œ

### 4.3 ç‹€æ…‹æµè½‰
- `delayCloseBoard()` æ–¹æ³•è² è²¬æ¸…ç†ä¸¦è½‰æ›åˆ°ä¸‹ä¸€å€‹éŠæˆ²ç‹€æ…‹
- ä½¿ç”¨ `GlobalTimer` é€²è¡Œæ™‚é–“æ§åˆ¶

### 4.4 é€šçŸ¥æ©Ÿåˆ¶
- `StateWinEvent.SHOW_LAST_CREDIT_BOARD` ç”¨æ–¼é¡¯ç¤ºçµç®—é¢æ¿
- `WinEvent.FORCE_WIN_DISPOSE` ç”¨æ–¼å¼·åˆ¶æ¸…ç†è´åˆ†é¡¯ç¤º
- `CheckGameFlowCommand.NAME` ç”¨æ–¼æª¢æŸ¥éŠæˆ²æµç¨‹

## 5. æ¸¬è©¦é©—è­‰

### 5.1 æ¸¬è©¦æ–¹æ³•
1. é–‹å•ŸéŠæˆ²å¾Œåœ¨ConsoleåŸ·è¡Œï¼š`setBigWinThreshold(20)`
2. è§¸ç™¼Free Gameæˆ–Dragon Bonus
3. è§€å¯Ÿçµç®—æ™‚çš„è¡Œç‚º

### 5.2 é æœŸçµæœ
- ç•¶å¯¦éš›å€æ•¸(15.4x) < è¨­å®šé–€æª»(20x)æ™‚ï¼šè·³éçµç®—é¢æ¿
- ç•¶å¯¦éš›å€æ•¸ >= è¨­å®šé–€æª»æ™‚ï¼šæ­£å¸¸é¡¯ç¤ºçµç®—é¢æ¿
- Big Winå‹•ç•«ä¸å—å½±éŸ¿ï¼ˆç”±å…¶ä»–é‚è¼¯æ§åˆ¶ï¼‰

## 6. å­¸ç¿’é‡é»ç¸½çµ

### 6.1 å°ˆæ¡ˆæ¶æ§‹ç†è§£
- æŒæ¡PureMVCçš„MVCä¸‰å±¤æ¶æ§‹
- ç†è§£Command-Proxy-Mediatorçš„è·è²¬åˆ†å·¥
- äº†è§£éŠæˆ²ç‹€æ…‹æ©Ÿçš„é‹ä½œæ–¹å¼

### 6.2 ç¨‹å¼è¨­è¨ˆæ¨¡å¼
- ç­–ç•¥æ¨¡å¼ï¼šæ¢ä»¶æ€§åŸ·è¡Œä¸åŒé‚è¼¯
- ä»£ç†æ¨¡å¼ï¼šé€éProxyç®¡ç†æ•¸æ“šè¨ªå•
- è§€å¯Ÿè€…æ¨¡å¼ï¼šé€éé€šçŸ¥æ©Ÿåˆ¶è§£è€¦çµ„ä»¶

### 6.3 éŠæˆ²é–‹ç™¼å¯¦å‹™
- äº†è§£éŠæˆ²çµç®—æµç¨‹çš„è¨­è¨ˆ
- å­¸ç¿’å¦‚ä½•æ·»åŠ æ¸¬è©¦åŠŸèƒ½è€Œä¸å½±éŸ¿æ­£å¼é‚è¼¯
- æŒæ¡ConsoleæŒ‡ä»¤çš„å¯¦ä½œæ–¹å¼

### 6.4 TypeScripté–‹ç™¼æŠ€å·§
- ä»‹é¢è¨­è¨ˆèˆ‡å¯¦ä½œ
- é¡å‹å®‰å…¨çš„æ•¸æ“šè¨ªå•
- æ¨¡çµ„åŒ–ç¨‹å¼çµ„ç¹”

## 7. å¯èƒ½çš„å»¶ä¼¸æ€è€ƒ

1. **æ•ˆèƒ½è€ƒé‡**ï¼šæ˜¯å¦éœ€è¦å¿«å–é–€æª»å€¼é¿å…é‡è¤‡è¨ˆç®—ï¼Ÿ
2. **æ“´å±•æ€§**ï¼šå¦‚ä½•æ”¯æ´ä¸åŒéŠæˆ²æ¨¡å¼çš„ä¸åŒé–€æª»ï¼Ÿ
3. **æ¸¬è©¦å®Œæ•´æ€§**ï¼šå¦‚ä½•ç·¨å¯«è‡ªå‹•åŒ–æ¸¬è©¦é©—è­‰æ­¤åŠŸèƒ½ï¼Ÿ
4. **ç”¨æˆ¶é«”é©—**ï¼šè·³éçµç®—é¢æ¿æ˜¯å¦éœ€è¦å…¶ä»–è¦–è¦ºå›é¥‹ï¼Ÿ

é€™äº›æ€è€ƒé»å¯ä»¥å¹«åŠ©æ›´æ·±å…¥ç†è§£éŠæˆ²ç³»çµ±è¨­è¨ˆçš„è¤‡é›œæ€§å’Œè€ƒé‡å› ç´ ã€‚

---

# ç·´ç¿’2 ç¬¬äºŒé¡Œå¯¦ä½œæŒ‡å—

## é¡Œç›®æè¿°
åœ¨BaseGameæ»¾åœå¾Œè‹¥æœ‰è§¸ç™¼ç‰¹è‰²éŠæˆ²ï¼ˆç›¤é¢ä¸Šæœ‰6é¡†æˆ–ä»¥ä¸Šçš„åˆ†æ•¸çƒï¼‰ï¼Œå‰‡åœ¨æ”¶é›†çƒåˆ†ä¹‹å‰å¡ä½æµç¨‹ï¼Œè®“ç›¤é¢ä¸Šçš„åˆ†æ•¸çƒåšä»»æ„è¡¨æ¼”ï¼ˆç°¡å–®çš„ç¸®æ”¾å‹•ç•«æˆ–æ’­æ”¾ä»»æ„ç²’å­ç‰¹æ•ˆéƒ½å¯ä»¥ï¼‰ï¼Œè¡¨æ¼”å®Œå¾Œå†ç¹¼çºŒå¾ŒçºŒæ”¶é›†çƒåˆ†çš„æµç¨‹ï¼Œä¸¦è«‹èªªæ˜å¡ä½æµç¨‹åŠåˆ†æ•¸çƒè¡¨æ¼”çš„ä½œæ³•ã€‚

## 1. å¯¦ä½œå‰çš„æ€è·¯æ§‹ç¯‰

### 1.1 å•é¡Œæ‹†è§£
- **æ ¸å¿ƒéœ€æ±‚**ï¼šåœ¨æ”¶é›†çƒåˆ†å‰æ’å…¥è¡¨æ¼”å‹•ç•«
- **è§¸ç™¼æ¢ä»¶**ï¼šBaseGameæ»¾åœ + ballCount >= 6
- **æŠ€è¡“æŒ‘æˆ°**ï¼šå¦‚ä½•å¡ä½ç¾æœ‰æµç¨‹ä¸¦æ’å…¥è‡ªå®šç¾©è¡¨æ¼”
- **è¨­è¨ˆè€ƒé‡**ï¼šä¸ç ´å£ç¾æœ‰æ¶æ§‹ï¼Œåˆ©ç”¨æ—¢æœ‰ç³»çµ±

### 1.2 åˆ†æç¾æœ‰æµç¨‹
1. BaseGameæ»¾åœ â†’ `GAME_Game1RollCompleteCommand`
2. é€²å…¥Feature Selection â†’ `GAME_Game1FeatureSelectionCommand`
3. ç™¼é€æ”¶é›†æº–å‚™ â†’ `ViewMediatorEvent.PREPARE_COLLECT_BALL`
4. é–‹å§‹æ”¶é›†çƒåˆ† â†’ Ballæ”¶é›†å‹•ç•«

**æ’å…¥é»è­˜åˆ¥**ï¼šåœ¨æ­¥é©Ÿ3ä¹‹å‰æ’å…¥è¡¨æ¼”ï¼Œå»¶é²æ­¥é©Ÿ3çš„åŸ·è¡Œ

### 1.3 æŠ€è¡“æ–¹æ¡ˆé¸æ“‡
åƒè€ƒå…¶ä»–é–‹ç™¼è€…çš„å¯¦ä½œæ–¹æ³•ï¼Œæ¡ç”¨Symbolç‰¹æ•ˆç³»çµ±ï¼š
- åˆ©ç”¨ç¾æœ‰çš„SymbolFXç‰¹æ•ˆæ± 
- æ·»åŠ æ–°çš„SymbolPerformTypeç‹€æ…‹
- ä½¿ç”¨äº‹ä»¶æ©Ÿåˆ¶è§¸ç™¼è¡¨æ¼”
- é€šéå»¶é²æ©Ÿåˆ¶æ§åˆ¶æµç¨‹

## 2. éœ€è¦äº†è§£çš„å°ˆæ¡ˆæ ¸å¿ƒå…§å®¹

### 2.1 ç¬¦è™Ÿç‰¹æ•ˆç³»çµ± (SymbolFX System)

#### 2.1.1 SymbolPerformTypeæšèˆ‰
**æª”æ¡ˆä½ç½®**ï¼š`assets/src/sgv3/vo/enum/Reel.ts:21-34`

```typescript
export enum SymbolPerformType {
    SHOW = 0,
    HIDE = 1,
    SHOW_ALL_WIN = 3,
    SHOW_LOOP_WIN = 4,
    // ...ç¾æœ‰ç‹€æ…‹
    SHOW_TARGERT_CREDIT_RESULT = 14
}
```

**ç”¨é€”**ï¼šå®šç¾©ç¬¦è™Ÿå¯åŸ·è¡Œçš„å„ç¨®è¡¨æ¼”é¡å‹ï¼Œæ¯å€‹é¡å‹å°æ‡‰ä¸åŒçš„å‹•ç•«æ•ˆæœã€‚

#### 2.1.2 SymbolFXç‰¹æ•ˆé¡åˆ¥
**æª”æ¡ˆä½ç½®**ï¼š`assets/src/game/view/symbol/SymbolFXStateRegister.ts`

é€™æ˜¯ç¬¦è™Ÿç‰¹æ•ˆçš„æ ¸å¿ƒå¯¦ä½œï¼ŒåŒ…å«ï¼š
- ç‹€æ…‹è¨»å†Šæ©Ÿåˆ¶ï¼šæ ¹æ“šSymbolIdè¨»å†Šå°æ‡‰çš„ç‰¹æ•ˆç‹€æ…‹
- UIViewStateBaseåŸºé¡ï¼šæ‰€æœ‰ç‰¹æ•ˆç‹€æ…‹çš„åŸºç¤é¡åˆ¥
- å…·é«”ç‰¹æ•ˆå¯¦ä½œï¼šå¦‚`SymbolFXShowState`ã€`SymbolFXBaseCreditUpdateState`ç­‰

**é—œéµæ¦‚å¿µ**ï¼š
```typescript
// ç‰¹æ•ˆç‹€æ…‹åŸºæœ¬çµæ§‹
export class SymbolFXShowState extends UIViewStateBase {
    public effectId: number = SymbolPerformType.SHOW; // å°æ‡‰çš„è¡¨æ¼”é¡å‹
    
    onPlay() {
        // æ’­æ”¾é‚è¼¯
    }
    
    onSkip() {
        // è·³éé‚è¼¯
    }
}
```

### 2.2 ReelViewèˆ‡Poolç®¡ç†

#### 2.2.1 SymbolFXå°è±¡æ± 
ReelViewç¶­è­·ä¸€å€‹SymbolFXå°è±¡æ± ï¼Œç”¨æ–¼å¾©ç”¨ç‰¹æ•ˆå°è±¡ï¼š
- æ ¹æ“šä½ç½®ç´¢å¼• `poolKey = y * 5 + x` ç²å–å°è±¡
- é¿å…é‡è¤‡å‰µå»ºï¼Œæå‡æ€§èƒ½
- æ”¯æ´å‹•æ…‹ä½ç½®è¨­å®šå’Œç‰¹æ•ˆæ’­æ”¾

#### 2.2.2 ReelViewMediatoräº‹ä»¶è™•ç†
**æª”æ¡ˆä½ç½®**ï¼š`assets/src/game/mediator/ReelViewMediator.ts`

è² è²¬ï¼š
- ç›£è½å„ç¨®éŠæˆ²äº‹ä»¶
- èª¿ç”¨ReelViewçš„æ–¹æ³•åŸ·è¡Œå…·é«”è¡¨æ¼”
- ç®¡ç†ç¬¦è™Ÿç‰¹æ•ˆçš„ç”Ÿå‘½é€±æœŸ

### 2.3 äº‹ä»¶ç³»çµ±èˆ‡æµç¨‹æ§åˆ¶

#### 2.3.1 ViewMediatorEventäº‹ä»¶å¸¸æ•¸
**æª”æ¡ˆä½ç½®**ï¼š`assets/src/sgv3/util/Constant.ts`

```typescript
export class ViewMediatorEvent {
    public static readonly PREPARE_COLLECT_BALL: string = 'prepareCollectBall';
    // å…¶ä»–äº‹ä»¶...
}
```

**ä½œç”¨**ï¼šçµ±ä¸€ç®¡ç†éŠæˆ²ä¸­çš„å„ç¨®äº‹ä»¶å¸¸æ•¸ï¼Œç¢ºä¿äº‹ä»¶åç¨±çš„ä¸€è‡´æ€§ã€‚

#### 2.3.2 CommandæŒ‡ä»¤æ¨¡å¼
- æ¯å€‹éŠæˆ²ç‹€æ…‹å°æ‡‰ä¸€å€‹Commandé¡åˆ¥
- Commandè² è²¬è©²ç‹€æ…‹çš„æ¥­å‹™é‚è¼¯è™•ç†
- é€šé`sendNotification()`ç™¼é€äº‹ä»¶åˆ°å…¶ä»–çµ„ä»¶

## 3. å°ˆæ¡ˆä¸­é¡ä¼¼çš„è£½ä½œæ–¹å¼ç¯„ä¾‹

### 3.1 ç¾æœ‰çš„åˆ†æ•¸çƒæ”¶é›†ç‰¹æ•ˆ
**æª”æ¡ˆä½ç½®**ï¼š`assets/src/game/view/symbol/SymbolFXStateRegister.ts:141-166`

```typescript
export class SymbolFXBaseCreditUpdateState extends UIViewStateBase {
    public effectId: number = SymbolPerformType.SHOW_BASE_CREDIT_COLLECT;

    onPlay() {
        if (this.content.animation) {
            this.content.animation.play('BeginEffect', () => this.playWin());
        }
    }

    playWin() {
        this.content.animation.play('PlayWin');
        this.onEffectFinished(); // é€šçŸ¥è¡¨æ¼”å®Œæˆ
    }
}
```

**å­¸ç¿’é‡é»**ï¼š
- ä½¿ç”¨å›èª¿å‡½æ•¸æ§åˆ¶å‹•ç•«åºåˆ—
- é€šé`onEffectFinished()`é€šçŸ¥ç³»çµ±è¡¨æ¼”å®Œæˆ
- å¯æ’­æ”¾é€£çºŒçš„å‹•ç•«æ•ˆæœ

### 3.2 ç¬¦è™Ÿè´åˆ†è¡¨æ¼”
**æª”æ¡ˆä½ç½®**ï¼š`assets/src/game/view/symbol/SymbolFXStateRegister.ts:40-116`

```typescript
export class SymbolFXShowState extends UIViewStateBase {
    private tempTween: Tween<Node> | null = null;

    onPlay() {
        // è¨­å®šæ¨™ç±¤æ–‡å­—å’Œå­—é«”
        if (this.content.labelText) {
            this.content.labelText.string = String(this.content.credit);
        }
        
        // æ’­æ”¾å‹•ç•«ä¸¦è¨­å®šå®Œæˆå›èª¿
        this.tempTween = tween(this.content.node)
            .delay(2)
            .call(() => {
                this.onEffectFinished();
            })
            .start();
    }

    onSkip() {
        this.tempTween.stop();
        this.onEffectFinished();
    }
}
```

**å­¸ç¿’é‡é»**ï¼š
- ä½¿ç”¨Cocos Creatorçš„Tweenç³»çµ±è£½ä½œå‹•ç•«
- æ”¯æ´è·³éåŠŸèƒ½ï¼ˆonSkipï¼‰
- å¦¥å–„ç®¡ç†Tweenå°è±¡é¿å…è¨˜æ†¶é«”æ´©æ¼

### 3.3 å»¶é²åŸ·è¡Œæ©Ÿåˆ¶ç¯„ä¾‹
**æª”æ¡ˆä½ç½®**ï¼š`assets/src/game/command/state/GAME_Game1RollCompleteCommand.ts:35-43`

```typescript
// å»¶é²æ”¶é›†çƒçš„è¡¨æ¼”
let delayTime: number = 0;
let ballCount = curRoundResult.extendInfoForbaseGameResult.ballCount;
if (ballCount >= 6 && this.isHitGrand == false) {
    delayTime = 2;
} else if (ballCount > 0) {
    delayTime = 0.1;
}
GlobalTimer.getInstance().registerTimer(this.timerKey, delayTime, this.endGame1RollComplete, this).start();
```

**å­¸ç¿’é‡é»**ï¼š
- ä½¿ç”¨GlobalTimeré€²è¡Œå»¶é²æ§åˆ¶
- æ ¹æ“šæ¢ä»¶è¨­å®šä¸åŒçš„å»¶é²æ™‚é–“
- Timerå®Œæˆå¾ŒåŸ·è¡Œå›èª¿å‡½æ•¸

## 4. æˆ‘å€‘çš„å¯¦ä½œæ–¹æ³•

### 4.1 ç¬¬ä¸€æ­¥ï¼šæ–°å¢è¡¨æ¼”ç‹€æ…‹

**æª”æ¡ˆä½ç½®**ï¼š`assets/src/sgv3/vo/enum/Reel.ts:34`
```typescript
export enum SymbolPerformType {
    // ...ç¾æœ‰ç‹€æ…‹
    SHOW_TARGERT_CREDIT_RESULT = 14, //å‡é¾è³ C2 çƒ æœ€çµ‚çµæœ è¡¨æ¼”
    BEFORE_COLLECT = 15 //ç·´ç¿’2: æ”¶é›†åˆ†æ•¸çƒå‰çš„è¡¨æ¼”
}
```

**ç›®çš„**ï¼šç‚ºæ–°çš„è¡¨æ¼”é¡å‹å®šç¾©å”¯ä¸€æ¨™è­˜ç¬¦ã€‚

### 4.2 ç¬¬äºŒæ­¥ï¼šå¯¦ä½œè¡¨æ¼”ç‰¹æ•ˆé¡åˆ¥

**æª”æ¡ˆä½ç½®**ï¼š`assets/src/game/view/symbol/SymbolFXStateRegister.ts`

#### A. è¨»å†Šæ–°ç‹€æ…‹
åœ¨ç¬¬30è¡Œç‚ºC1ç¬¦è™Ÿè¨»å†Šæ–°çš„è¡¨æ¼”ç‹€æ…‹ï¼š
```typescript
case SymbolId.C1:
    this.registerState(new SymbolFXShowState(this.content));
    this.registerState(new SymbolFXBaseCreditUpdateState(this.content));
    this.registerState(new SymbolFXBeforeCollectState(this.content)); // æ–°å¢
    break;
```

#### B. å¯¦ä½œè¡¨æ¼”é¡åˆ¥ï¼ˆç¬¬232-280è¡Œï¼‰
```typescript
export class SymbolFXBeforeCollectState extends UIViewStateBase {
    private content: SymbolFXContent | null = null;
    private tempTween: Tween<Node> | null = null;

    public effectId: number = SymbolPerformType.BEFORE_COLLECT;

    constructor(content: SymbolFXContent) {
        super();
        this.content = content;
    }

    onPlay() {
        // è¨­å®šåˆ†æ•¸çƒæ¨™ç±¤æ–‡å­—
        if (this.content.labelText) {
            this.content.labelText.font = this.content.isSpecialFont
                ? this.content.specialFont
                : this.content.baseFont;
            this.content.labelText.string = this.content.isOmniChannel
                ? String(this.content.credit)
                : String(BalanceUtil.formatBalanceWithExpressingUnits(this.content.credit));
        }

        // æ’­æ”¾ç¸®æ”¾å‹•ç•«è¡¨æ¼” (ç°¡å–®çš„å¼·èª¿å‹•ç•«)
        const originalScale = this.content.node.scale.clone();
        const targetScale = new Vec3(originalScale.x * 1.2, originalScale.y * 1.2, originalScale.z);
        
        this.tempTween = tween(this.content.node)
            .to(0.3, { scale: targetScale })    // æ”¾å¤§
            .to(0.3, { scale: originalScale })  // ç¸®å°
            .to(0.3, { scale: targetScale })    // å†æ”¾å¤§
            .to(0.3, { scale: originalScale })  // æ¢å¾©åŸç‹€
            .call(() => {
                this.onEffectFinished();        // é€šçŸ¥å®Œæˆ
            })
            .start();
    }

    onSkip() {
        if (this.tempTween) {
            this.tempTween.stop();
        }
        this.onEffectFinished();
    }
}
```

**æŠ€è¡“è¦é»**ï¼š
- ç¹¼æ‰¿`UIViewStateBase`åŸºé¡
- ä½¿ç”¨`effectId`é—œè¯è¡¨æ¼”é¡å‹
- é€šé`onPlay()`å¯¦ä½œè¡¨æ¼”é‚è¼¯
- é€šé`onSkip()`æ”¯æ´è·³éåŠŸèƒ½
- ä½¿ç”¨`onEffectFinished()`é€šçŸ¥ç³»çµ±è¡¨æ¼”å®Œæˆ

### 4.3 ç¬¬ä¸‰æ­¥ï¼šæ–°å¢è§¸ç™¼äº‹ä»¶

**æª”æ¡ˆä½ç½®**ï¼š`assets/src/sgv3/util/Constant.ts:177`
```typescript
export class ViewMediatorEvent {
    // ...ç¾æœ‰äº‹ä»¶
    /** ç·´ç¿’2: æ”¶é›†åˆ†æ•¸çƒå‰çš„è¡¨æ¼” */
    public static readonly BEFORE_COLLECT_BALL: string = 'beforeCollectBall';
    public static readonly PREPARE_COLLECT_BALL: string = 'prepareCollectBall';
}
```

**ç›®çš„**ï¼šå®šç¾©æ–°çš„äº‹ä»¶å¸¸æ•¸ï¼Œç”¨æ–¼è§¸ç™¼åˆ†æ•¸çƒè¡¨æ¼”ã€‚

### 4.4 ç¬¬å››æ­¥ï¼šä¿®æ”¹æµç¨‹æ§åˆ¶é‚è¼¯

**æª”æ¡ˆä½ç½®**ï¼š`assets/src/game/command/state/GAME_Game1FeatureSelectionCommand.ts:15-29`

```typescript
public execute(notification: puremvc.INotification): void {
    this.gameDataProxy.hasSelectionResponse = false;
    
    // ç·´ç¿’2: æª¢æŸ¥æ˜¯å¦éœ€è¦æ’­æ”¾åˆ†æ•¸çƒè¡¨æ¼”
    let ballCount = this.gameDataProxy.spinEventData.baseGameResult.extendInfoForbaseGameResult.ballCount;
    if (ballCount >= 6) {
        // å…ˆè§¸ç™¼åˆ†æ•¸çƒè¡¨æ¼”
        this.sendNotification(ViewMediatorEvent.BEFORE_COLLECT_BALL);
        // å»¶é²ç™¼é€PREPARE_COLLECT_BALL (è¡¨æ¼”æ™‚é–“ç´„1.2ç§’)
        setTimeout(() => {
            this.sendNotification(ViewMediatorEvent.PREPARE_COLLECT_BALL);
            this.endGame1FeatureSelection();
        }, 1200);
    } else {
        // åŸæœ‰é‚è¼¯ï¼šç›´æ¥ç™¼é€PREPARE_COLLECT_BALL
        this.sendNotification(ViewMediatorEvent.PREPARE_COLLECT_BALL);
        this.endGame1FeatureSelection();
    }
}
```

**é—œéµæŠ€è¡“é»**ï¼š
- æ¢ä»¶åˆ¤æ–·ï¼šåªåœ¨`ballCount >= 6`æ™‚åŸ·è¡Œè¡¨æ¼”
- äº‹ä»¶é †åºï¼šå…ˆç™¼é€`BEFORE_COLLECT_BALL`ï¼Œå¾Œç™¼é€`PREPARE_COLLECT_BALL`
- æ™‚é–“æ§åˆ¶ï¼šä½¿ç”¨`setTimeout`å»¶é²1200æ¯«ç§’ï¼ˆé…åˆè¡¨æ¼”æ™‚é•·ï¼‰
- æµç¨‹åˆ†æ”¯ï¼šä¿æŒåŸæœ‰é‚è¼¯ä¸è®Šï¼Œåªåœ¨ç‰¹å®šæ¢ä»¶ä¸‹æ’å…¥æ–°é‚è¼¯

### 4.5 ç¬¬äº”æ­¥ï¼šReelViewMediatoräº‹ä»¶è™•ç†

**æª”æ¡ˆä½ç½®**ï¼š`assets/src/game/mediator/ReelViewMediator.ts`

#### A. æ·»åŠ äº‹ä»¶ç›£è½ï¼ˆç¬¬87è¡Œï¼‰
```typescript
public listNotificationInterests(): Array<string> {
    return Array.from(new Set([
        // ...ç¾æœ‰äº‹ä»¶
        AfterReconnectionCommand.NAME,
        ViewMediatorEvent.BEFORE_COLLECT_BALL  // æ–°å¢
    ].concat(super.baseListNotificationInterests())));
}
```

#### B. æ·»åŠ äº‹ä»¶è™•ç†ï¼ˆç¬¬168-170è¡Œï¼‰
```typescript
public handleNotification(notification: puremvc.INotification): void {
    super.baseHandleNotification(notification);
    let name = notification.getName();
    switch (name) {
        // ...ç¾æœ‰case
        case ViewMediatorEvent.BEFORE_COLLECT_BALL:
            this.playBeforeCollectBallAnimation();
            break;
    }
}
```

#### C. å¯¦ä½œè¡¨æ¼”é‚è¼¯ï¼ˆç¬¬707-727è¡Œï¼‰
```typescript
protected playBeforeCollectBallAnimation() {
    // ç²å–BaseGameçµæœå’Œåˆ†æ•¸çƒä½ç½®ä¿¡æ¯
    let ballHitInfo = this.gameDataProxy.spinEventData.baseGameResult.extendInfoForbaseGameResult;
    
    // æ‰¾å‡ºæ‰€æœ‰æœ‰åˆ†æ•¸çƒçš„ä½ç½®
    for (let x = 0; x < ballHitInfo.ballScreenLabel.length; x++) {
        for (let y = 0; y < ballHitInfo.ballScreenLabel[x].length; y++) {
            if (ballHitInfo.ballScreenLabel[x][y] > 0) {
                // å‰µå»ºSymbolInfoä¾†æ¨™è­˜åˆ†æ•¸çƒä½ç½®
                let symbolInfo: SymbolInfo = new SymbolInfo();
                symbolInfo.sid = SymbolId.C1; // åˆ†æ•¸çƒçš„Symbol ID
                symbolInfo.x = x;
                symbolInfo.y = y;
                
                // å¾poolä¸­å–å‡ºSymbolFXä¸¦æ’­æ”¾BEFORE_COLLECTå‹•ç•«
                this.reelView.createAnimSymbol(symbolInfo);
                this.reelView.showBeforeCollectBallAnimation(symbolInfo, this.reelDataProxy.symbolFeature[x][y]);
            }
        }
    }
}
```

**æŠ€è¡“è§£æ**ï¼š
- éæ­·ç›¤é¢æ‰¾å‡ºæ‰€æœ‰åˆ†æ•¸çƒä½ç½®
- ç‚ºæ¯å€‹åˆ†æ•¸çƒå‰µå»ºSymbolInfoå°è±¡
- èª¿ç”¨ReelViewçš„æ–¹æ³•æ’­æ”¾è¡¨æ¼”å‹•ç•«
- åˆ©ç”¨ç¾æœ‰çš„`symbolFeature`æ•¸æ“šè¨­å®šè¡¨æ¼”åƒæ•¸

### 4.6 ç¬¬å…­æ­¥ï¼šReelViewæ”¯æ´æ–¹æ³•

**æª”æ¡ˆä½ç½®**ï¼š`assets/src/game/view/GAME_ReelView.ts:335-347`

```typescript
public showBeforeCollectBallAnimation(symbolInfo: SymbolInfo, featureInfo: SymbolPosData) {
    const self = this;
    let poolKey: number = symbolInfo.y * self.reelsList.length + symbolInfo.x;
    let anim: SymbolFX = self.animManager.pool.get(poolKey);

    if (anim) {
        anim.node.setWorldPosition(self.getSymbolPosition(symbolInfo.x, symbolInfo.y));
        anim.setInfo(symbolInfo.sid, featureInfo);
        anim.node.active = true;
        // æ’­æ”¾BEFORE_COLLECTè¡¨æ¼”å‹•ç•«
        anim.play(SymbolPerformType.BEFORE_COLLECT);
    }
}
```

**æŠ€è¡“è¦é»**ï¼š
- è¨ˆç®—å°è±¡æ± ç´¢å¼•ï¼š`poolKey = y * reelLength + x`
- å¾å°è±¡æ± ç²å–SymbolFXå°è±¡
- è¨­å®šä¸–ç•Œåº§æ¨™ä½ç½®å’Œç¬¦è™Ÿä¿¡æ¯
- èª¿ç”¨`play()`æ–¹æ³•æ’­æ”¾æŒ‡å®šé¡å‹çš„è¡¨æ¼”

## 5. å¡ä½æµç¨‹çš„å¯¦ä½œåŸç†

### 5.1 åŸå§‹æµç¨‹åˆ†æ
```
BaseGameæ»¾åœ â†’ GAME_Game1RollCompleteCommand
    â†“
GAME_Game1FeatureSelectionCommand.execute()
    â†“
sendNotification(PREPARE_COLLECT_BALL)  â† åŸæœ¬ç«‹å³åŸ·è¡Œ
    â†“
BallHitViewMediatoræ”¶åˆ°é€šçŸ¥é–‹å§‹æ”¶é›†
```

### 5.2 ä¿®æ”¹å¾Œçš„æµç¨‹
```
BaseGameæ»¾åœ â†’ GAME_Game1RollCompleteCommand
    â†“
GAME_Game1FeatureSelectionCommand.execute()
    â†“
ballCount >= 6 ?
    â”œâ”€ YES â†’ sendNotification(BEFORE_COLLECT_BALL)  â† æ’å…¥è¡¨æ¼”
    â”‚          â†“
    â”‚        setTimeout(1200ms)  â† å¡ä½æµç¨‹
    â”‚          â†“
    â”‚        sendNotification(PREPARE_COLLECT_BALL)  â† å»¶é²åŸ·è¡Œ
    â”‚
    â””â”€ NO â†’ sendNotification(PREPARE_COLLECT_BALL)  â† åŸæœ‰æµç¨‹
```

### 5.3 å¡ä½æ©Ÿåˆ¶çš„æŠ€è¡“å¯¦ä½œ

#### é—œéµç¨‹å¼ç¢¼è§£æï¼š
```typescript
if (ballCount >= 6) {
    // ç¬¬ä¸€æ­¥ï¼šè§¸ç™¼è¡¨æ¼”
    this.sendNotification(ViewMediatorEvent.BEFORE_COLLECT_BALL);
    
    // ç¬¬äºŒæ­¥ï¼šå»¶é²åŸæœ‰æµç¨‹
    setTimeout(() => {
        this.sendNotification(ViewMediatorEvent.PREPARE_COLLECT_BALL);
        this.endGame1FeatureSelection();
    }, 1200);  // å¡ä½1.2ç§’
} else {
    // åŸæœ‰æµç¨‹ï¼šä¸å¡ä½ï¼Œç›´æ¥åŸ·è¡Œ
    this.sendNotification(ViewMediatorEvent.PREPARE_COLLECT_BALL);
    this.endGame1FeatureSelection();
}
```

#### è¨­è¨ˆå„ªé»ï¼š
1. **éå…¥ä¾µæ€§**ï¼šä¸ä¿®æ”¹ç¾æœ‰æµç¨‹ï¼Œåªæ˜¯å»¶é²åŸ·è¡Œ
2. **æ¢ä»¶æ€§**ï¼šåªåœ¨éœ€è¦æ™‚æ‰å¡ä½æµç¨‹
3. **æ™‚é–“ç²¾ç¢º**ï¼šå»¶é²æ™‚é–“èˆ‡è¡¨æ¼”æ™‚é•·åŒ¹é…
4. **å‘ä¸‹ç›¸å®¹**ï¼šä¸å½±éŸ¿ballCount < 6çš„æƒ…æ³

## 6. åˆ†æ•¸çƒè¡¨æ¼”çš„å¯¦ä½œåŸç†

### 6.1 ç¬¦è™Ÿè¦†è“‹æ©Ÿåˆ¶

#### é‡è¦æ¦‚å¿µï¼š
å°ˆæ¡ˆä½¿ç”¨ã€Œç¬¦è™Ÿè¦†è“‹ã€è€Œéã€Œç¬¦è™Ÿæ›¿æ›ã€ï¼š
- åŸæœ‰ç›¤é¢çš„symbolä¿æŒä¸è®Š
- SymbolFXå¾å°è±¡æ± ä¸­å–å‡ºï¼Œè¦†è“‹åœ¨åŸsymbolä¸Šæ–¹
- è¡¨æ¼”å®Œæˆå¾ŒSymbolFXå›æ”¶ï¼ŒåŸsymbolé‡æ–°é¡¯ç¤º

#### æŠ€è¡“å¯¦ä½œï¼š
```typescript
// å¾å°è±¡æ± ç²å–SymbolFXå°è±¡
let anim: SymbolFX = self.animManager.pool.get(poolKey);

// è¨­å®šä½ç½®ï¼ˆè¦†è“‹åœ¨åŸsymbolä¸Šæ–¹ï¼‰
anim.node.setWorldPosition(self.getSymbolPosition(symbolInfo.x, symbolInfo.y));

// è¨­å®šç¬¦è™Ÿä¿¡æ¯ï¼ˆåŒ…å«åˆ†æ•¸ç­‰è³‡æ–™ï¼‰
anim.setInfo(symbolInfo.sid, featureInfo);

// å•Ÿå‹•ä¸¦æ’­æ”¾è¡¨æ¼”
anim.node.active = true;
anim.play(SymbolPerformType.BEFORE_COLLECT);
```

### 6.2 å‹•ç•«è¨­è¨ˆæ€è·¯

#### ç¸®æ”¾å‹•ç•«å¯¦ä½œï¼š
```typescript
// å„²å­˜åŸå§‹ç¸®æ”¾æ¯”ä¾‹
const originalScale = this.content.node.scale.clone();
const targetScale = new Vec3(originalScale.x * 1.2, originalScale.y * 1.2, originalScale.z);

// æ’­æ”¾ç¸®æ”¾å‹•ç•«åºåˆ—
this.tempTween = tween(this.content.node)
    .to(0.3, { scale: targetScale })    // 300msæ”¾å¤§åˆ°1.2å€
    .to(0.3, { scale: originalScale })  // 300msç¸®å°å›åŸç‹€
    .to(0.3, { scale: targetScale })    // 300mså†æ¬¡æ”¾å¤§
    .to(0.3, { scale: originalScale })  // 300msæœ€çµ‚æ¢å¾©
    .call(() => {
        this.onEffectFinished();        // ç¸½è¨ˆ1200msï¼Œé€šçŸ¥å®Œæˆ
    })
    .start();
```

#### è¨­è¨ˆè€ƒé‡ï¼š
- **è¦–è¦ºæ•ˆæœ**ï¼šé›™æ¬¡ç¸®æ”¾å¢å¼·æ³¨æ„åŠ›å¸å¼•
- **æ™‚é–“æ§åˆ¶**ï¼šç¸½æ™‚é•·1200msé…åˆæµç¨‹å»¶é²
- **è³‡æºç®¡ç†**ï¼šå®Œæˆå¾Œæ­£ç¢ºå›æ”¶Tweenå°è±¡
- **è·³éæ”¯æ´**ï¼šæä¾›onSkip()æ–¹æ³•æ”¯æ´åŠ é€Ÿ

### 6.3 åˆ†æ•¸é¡¯ç¤ºè™•ç†

```typescript
if (this.content.labelText) {
    // æ ¹æ“šæ¸ é“é¡å‹é¸æ“‡å­—é«”
    this.content.labelText.font = this.content.isSpecialFont
        ? this.content.specialFont
        : this.content.baseFont;
    
    // æ ¹æ“šæ¸ é“é¡å‹æ ¼å¼åŒ–æ•¸å­—é¡¯ç¤º
    this.content.labelText.string = this.content.isOmniChannel
        ? String(this.content.credit)  // å…¨æ¸ é“ï¼šç›´æ¥é¡¯ç¤ºæ•¸å­—
        : String(BalanceUtil.formatBalanceWithExpressingUnits(this.content.credit)); // ä¸€èˆ¬æ¸ é“ï¼šæ ¼å¼åŒ–é¡¯ç¤º
}
```

**å­¸ç¿’é‡é»**ï¼š
- å°ˆæ¡ˆæ”¯æ´å¤šæ¸ é“é¡¯ç¤ºæ¨¡å¼
- ä¸åŒæ¸ é“æœ‰ä¸åŒçš„æ•¸å­—æ ¼å¼åŒ–éœ€æ±‚
- å­—é«”é¸æ“‡ä¹Ÿæœƒæ ¹æ“šç‰¹æ®Šæƒ…æ³èª¿æ•´

## 7. é—œéµæŠ€è¡“é»æ·±åº¦è§£æ

### 7.1 å°è±¡æ± (Pool)æ¨¡å¼çš„æ‡‰ç”¨

#### ç‚ºä»€éº¼ä½¿ç”¨å°è±¡æ± ï¼Ÿ
1. **æ€§èƒ½è€ƒé‡**ï¼šé¿å…é »ç¹å‰µå»º/éŠ·æ¯€SymbolFXå°è±¡
2. **è¨˜æ†¶é«”ç®¡ç†**ï¼šå¾©ç”¨å°è±¡ï¼Œæ¸›å°‘GCå£“åŠ›
3. **ä½ç½®ç®¡ç†**ï¼špoolKeyç¢ºä¿æ¯å€‹ç›¤é¢ä½ç½®æœ‰å°æ‡‰çš„ç‰¹æ•ˆå°è±¡

#### å°è±¡æ± ç´¢å¼•è¨ˆç®—ï¼š
```typescript
// 5x3ç›¤é¢çš„ç´¢å¼•è¨ˆç®—
let poolKey: number = symbolInfo.y * 5 + symbolInfo.x;

// ç¯„ä¾‹ï¼š
// ä½ç½®(0,0) â†’ poolKey = 0*5 + 0 = 0
// ä½ç½®(1,2) â†’ poolKey = 2*5 + 1 = 11
// ä½ç½®(4,2) â†’ poolKey = 2*5 + 4 = 14
```

### 7.2 äº‹ä»¶é©…å‹•æ¶æ§‹çš„å„ªå‹¢

#### è§£è€¦åˆè¨­è¨ˆï¼š
- Commandè² è²¬æ¥­å‹™é‚è¼¯åˆ¤æ–·
- Mediatorè² è²¬è¦–åœ–å±¤è¡¨æ¼”
- å…©è€…é€šéäº‹ä»¶é€šä¿¡ï¼Œç›¸äº’ç¨ç«‹

#### æ“´å±•æ€§è€ƒé‡ï¼š
- æ–°å¢äº‹ä»¶é¡å‹ä¸å½±éŸ¿ç¾æœ‰çµ„ä»¶
- å¯ä»¥æœ‰å¤šå€‹Mediatorç›£è½åŒä¸€äº‹ä»¶
- ä¾¿æ–¼æ·»åŠ èª¿è©¦å’Œæ—¥èªŒåŠŸèƒ½

### 7.3 ç‹€æ…‹æ©Ÿæ¨¡å¼çš„é‹ç”¨

#### UIViewStateBaseåŸºé¡è¨­è¨ˆï¼š
```typescript
export abstract class UIViewStateBase {
    public abstract effectId: number;  // ç‹€æ…‹æ¨™è­˜
    
    abstract onPlay(): void;    // æ’­æ”¾é‚è¼¯
    abstract onSkip(): void;    // è·³éé‚è¼¯
    
    protected onEffectFinished(): void {
        // é€šçŸ¥ç‹€æ…‹æ©Ÿè¡¨æ¼”å®Œæˆ
    }
}
```

#### ç‹€æ…‹è¨»å†Šèˆ‡ç®¡ç†ï¼š
```typescript
// æ ¹æ“šç¬¦è™Ÿé¡å‹è¨»å†Šä¸åŒçš„ç‹€æ…‹
switch (this.content.symbolType) {
    case SymbolId.C1:
        this.registerState(new SymbolFXShowState(this.content));
        this.registerState(new SymbolFXBaseCreditUpdateState(this.content));
        this.registerState(new SymbolFXBeforeCollectState(this.content)); // æ–°å¢
        break;
}
```

## 8. å­¸ç¿’é‡é»èˆ‡æŠ€è¡“æ”¶ç©«

### 8.1 å°ˆæ¡ˆæ¶æ§‹æ·±åº¦ç†è§£

#### å¤šå±¤æ¶æ§‹è¨­è¨ˆï¼š
- **Command Layer**ï¼šæ¥­å‹™é‚è¼¯æ§åˆ¶
- **Mediator Layer**ï¼šè¦–åœ–äº‹ä»¶è™•ç†  
- **View Layer**ï¼šå…·é«”çš„è¦–è¦ºè¡¨ç¾
- **Data Layer**ï¼šéŠæˆ²æ•¸æ“šç®¡ç†

#### çµ„ä»¶è·è²¬åˆ†å·¥ï¼š
- **SymbolPerformType**ï¼šç‹€æ…‹å®šç¾©
- **SymbolFXState**ï¼šè¡¨æ¼”å¯¦ä½œ
- **ReelViewMediator**ï¼šäº‹ä»¶å”èª¿
- **GAME_ReelView**ï¼šè¦–åœ–æ“ä½œ

### 8.2 è¨­è¨ˆæ¨¡å¼çš„å¯¦éš›æ‡‰ç”¨

#### ç‹€æ…‹æ¨¡å¼ (State Pattern)ï¼š
- æ¯å€‹SymbolFXç‹€æ…‹éƒ½æ˜¯ç¨ç«‹çš„é¡åˆ¥
- æ”¯æ´ç‹€æ…‹é–“çš„åˆ‡æ›å’Œç®¡ç†
- ä¾¿æ–¼æ·»åŠ æ–°çš„è¡¨æ¼”é¡å‹

#### å°è±¡æ± æ¨¡å¼ (Object Pool Pattern)ï¼š
- é å…ˆå‰µå»ºSymbolFXå°è±¡é¿å…é‹è¡Œæ™‚é–‹éŠ·
- é€šépoolKeyç´¢å¼•å¿«é€Ÿç²å–å°è±¡
- è‡ªå‹•ç®¡ç†å°è±¡çš„ç”Ÿå‘½é€±æœŸ

#### è§€å¯Ÿè€…æ¨¡å¼ (Observer Pattern)ï¼š
- äº‹ä»¶ç³»çµ±å¯¦ç¾çµ„ä»¶é–“çš„é¬†è€¦åˆé€šä¿¡
- Commandç™¼é€é€šçŸ¥ï¼ŒMediatoræ¥æ”¶è™•ç†
- æ”¯æ´ä¸€å°å¤šçš„äº‹ä»¶è¨‚é–±

### 8.3 Cocos Creatoré–‹ç™¼æŠ€å·§

#### Tweenå‹•ç•«ç³»çµ±ï¼š
```typescript
// éˆå¼èª¿ç”¨å‰µå»ºè¤‡é›œå‹•ç•«åºåˆ—
tween(node)
    .to(duration, properties)
    .delay(time)
    .call(callback)
    .start();
```

#### åº§æ¨™ç³»çµ±ç®¡ç†ï¼š
```typescript
// ä¸–ç•Œåº§æ¨™ vs æœ¬åœ°åº§æ¨™
anim.node.setWorldPosition(worldPos);  // è¨­å®šä¸–ç•Œåº§æ¨™
anim.node.setPosition(localPos);       // è¨­å®šæœ¬åœ°åº§æ¨™
```

#### ç¯€é»ç”Ÿå‘½é€±æœŸï¼š
```typescript
// æ­£ç¢ºçš„æ¿€æ´»/åœç”¨é †åº
anim.node.active = true;   // æ¿€æ´»ç¯€é»
anim.play(effectType);     // æ’­æ”¾å‹•ç•«
// ... å‹•ç•«å®Œæˆå¾Œè‡ªå‹•è™•ç†å›æ”¶
```

### 8.4 éŠæˆ²é–‹ç™¼æœ€ä½³å¯¦è¸

#### æ™‚é–“åŒæ­¥è¨­è¨ˆï¼š
- è¡¨æ¼”æ™‚é–“(1200ms) = å»¶é²æ™‚é–“(1200ms)
- ç¢ºä¿è¡¨æ¼”å®Œæˆèˆ‡æµç¨‹æ¢å¾©çš„ç²¾ç¢ºåŒæ­¥
- æä¾›è·³éåŠŸèƒ½æ‡‰å°å¿«é€Ÿæ“ä½œéœ€æ±‚

#### æ¢ä»¶åˆ¤æ–·ç­–ç•¥ï¼š
- åªåœ¨å¿…è¦æ™‚åŸ·è¡Œè¡¨æ¼”é‚è¼¯
- ä¿æŒåŸæœ‰æµç¨‹çš„ç©©å®šæ€§
- æ”¯æ´å¤šç¨®éŠæˆ²æ¨¡å¼çš„å…¼å®¹

#### è³‡æºç®¡ç†åŸå‰‡ï¼š
- åŠæ™‚æ¸…ç†Tweenå°è±¡é¿å…è¨˜æ†¶é«”æ´©æ¼
- åˆç†ä½¿ç”¨å°è±¡æ± æå‡æ€§èƒ½
- æ­£ç¢ºè™•ç†ç•°å¸¸æƒ…æ³å’Œé‚Šç•Œæ¢ä»¶

## 9. å¯èƒ½çš„æ“´å±•èˆ‡å„ªåŒ–æ–¹å‘

### 9.1 è¡¨æ¼”æ•ˆæœå¢å¼·

#### å¤šæ¨£åŒ–å‹•ç•«æ•ˆæœï¼š
- æ—‹è½‰å‹•ç•«ï¼š`tween().by(duration, { angle: 360 })`
- å½ˆè·³æ•ˆæœï¼šä½¿ç”¨ç·©å‹•å‡½æ•¸`easing.bounceOut()`
- ç²’å­ç‰¹æ•ˆï¼šæ•´åˆParticle System

#### éŸ³æ•ˆåŒæ­¥ï¼š
```typescript
onPlay() {
    // æ’­æ”¾éŸ³æ•ˆ
    AudioManager.Instance.play(AudioClipsEnum.Ball_Highlight);
    
    // å‹•ç•«èˆ‡éŸ³æ•ˆåŒæ­¥
    this.tempTween = tween(this.content.node)
        .to(0.3, { scale: targetScale })
        .call(() => {
            AudioManager.Instance.play(AudioClipsEnum.Ball_Scale);
        })
        .to(0.3, { scale: originalScale })
        .start();
}
```

### 9.2 æ€§èƒ½å„ªåŒ–ç­–ç•¥

#### æ‰¹é‡è™•ç†å„ªåŒ–ï¼š
```typescript
// å°‡æ‰€æœ‰åˆ†æ•¸çƒçš„è¡¨æ¼”åˆä½µç‚ºä¸€å€‹Timeline
protected playBeforeCollectBallAnimation() {
    let animPromises = [];
    
    for (let x = 0; x < ballHitInfo.ballScreenLabel.length; x++) {
        for (let y = 0; y < ballHitInfo.ballScreenLabel[x].length; y++) {
            if (ballHitInfo.ballScreenLabel[x][y] > 0) {
                animPromises.push(this.playBallAnimation(x, y));
            }
        }
    }
    
    // æ‰€æœ‰å‹•ç•«å®Œæˆå¾Œçµ±ä¸€é€šçŸ¥
    Promise.all(animPromises).then(() => {
        this.onAllAnimationsComplete();
    });
}
```

#### æ™‚é–“æ§åˆ¶ç²¾ç¢ºåŒ–ï¼š
```typescript
// ä½¿ç”¨GlobalTimeræ›¿ä»£setTimeoutç²å¾—æ›´ç²¾ç¢ºçš„æ§åˆ¶
GlobalTimer.getInstance().registerTimer('beforeCollectDelay', 1.2, () => {
    this.sendNotification(ViewMediatorEvent.PREPARE_COLLECT_BALL);
    this.endGame1FeatureSelection();
}, this).start();
```

### 9.3 ç”¨æˆ¶é«”é©—æ”¹å–„

#### åŠ é€Ÿè·³éåŠŸèƒ½ï¼š
```typescript
// ç›£è½ç”¨æˆ¶æ“ä½œè·³éè¡¨æ¼”
public onUserSkipRequested() {
    // ç«‹å³åœæ­¢æ‰€æœ‰è¡¨æ¼”
    this.skipAllBallAnimations();
    
    // ç«‹å³åŸ·è¡Œå¾ŒçºŒæµç¨‹
    this.sendNotification(ViewMediatorEvent.PREPARE_COLLECT_BALL);
    this.endGame1FeatureSelection();
}
```

#### è¦–è¦ºå›é¥‹å¢å¼·ï¼š
```typescript
// æ·»åŠ è¡¨æ¼”é€²åº¦æç¤º
onPlay() {
    // é¡¯ç¤ºé€²åº¦æ¢æˆ–è¨ˆæ•¸å™¨
    this.showProgressIndicator(1200); // é¡¯ç¤º1.2ç§’çš„é€²åº¦
    
    // åŸæœ‰å‹•ç•«é‚è¼¯...
}
```

## 10. æ¸¬è©¦èˆ‡é©—è­‰æ–¹æ¡ˆ

### 10.1 åŠŸèƒ½æ¸¬è©¦checklist

- [ ] ballCount < 6æ™‚æµç¨‹æ­£å¸¸ï¼ˆç„¡è¡¨æ¼”ï¼‰
- [ ] ballCount >= 6æ™‚æ­£ç¢ºè§¸ç™¼è¡¨æ¼”
- [ ] è¡¨æ¼”å‹•ç•«æ•ˆæœç¬¦åˆé æœŸ
- [ ] è¡¨æ¼”å®Œæˆå¾Œæ”¶é›†æµç¨‹æ­£å¸¸ç¹¼çºŒ
- [ ] è·³éåŠŸèƒ½æ­£å¸¸å·¥ä½œ
- [ ] ä¸åŒåˆ†æ•¸å€¼çš„é¡¯ç¤ºæ­£ç¢º

### 10.2 é‚Šç•Œæ¢ä»¶æ¸¬è©¦

- [ ] ballCount = 6çš„é‚Šç•Œæƒ…æ³
- [ ] æ¥µå¤§ballCountå€¼çš„è™•ç†
- [ ] å¿«é€Ÿé€£çºŒæ“ä½œçš„ç©©å®šæ€§
- [ ] è¨˜æ†¶é«”ä½¿ç”¨æƒ…æ³ç›£æ§

### 10.3 å…¼å®¹æ€§æ¸¬è©¦

- [ ] ä¸åŒè£ç½®å‹è™Ÿçš„è¡¨ç¾
- [ ] ä¸åŒè§£æåº¦ä¸‹çš„é¡¯ç¤ºæ•ˆæœ
- [ ] èˆ‡ç¾æœ‰åŠŸèƒ½çš„äº¤äº’æ­£å¸¸

## ç¸½çµ

é¡Œç›®äºŒçš„å¯¦ä½œé«”ç¾äº†ç¾ä»£éŠæˆ²é–‹ç™¼ä¸­çš„å¹¾å€‹é‡è¦æ¦‚å¿µï¼š

1. **æ¨¡çµ„åŒ–è¨­è¨ˆ**ï¼šæ¯å€‹çµ„ä»¶è·è²¬æ˜ç¢ºï¼Œç›¸äº’ç¨ç«‹
2. **äº‹ä»¶é©…å‹•**ï¼šé€šéäº‹ä»¶å¯¦ç¾é¬†è€¦åˆçš„çµ„ä»¶é€šä¿¡  
3. **ç‹€æ…‹ç®¡ç†**ï¼šä½¿ç”¨ç‹€æ…‹æ¨¡å¼ç®¡ç†è¤‡é›œçš„è¡¨æ¼”é‚è¼¯
4. **æ€§èƒ½å„ªåŒ–**ï¼šå°è±¡æ± ã€è³‡æºå¾©ç”¨ç­‰æŠ€è¡“çš„æ‡‰ç”¨
5. **ç”¨æˆ¶é«”é©—**ï¼šå¹³æ»‘çš„å‹•ç•«éæ¸¡å’Œè·³éåŠŸèƒ½

é€šéé€™å€‹ç·´ç¿’ï¼Œæ‚¨å¯ä»¥æ·±å…¥äº†è§£ä¸€å€‹æˆç†Ÿçš„éŠæˆ²å°ˆæ¡ˆæ˜¯å¦‚ä½•çµ„ç¹”ä»£ç¢¼ã€ç®¡ç†ç‹€æ…‹ã€è™•ç†ç”¨æˆ¶äº¤äº’çš„ã€‚é€™äº›çŸ¥è­˜ä¸åƒ…é©ç”¨æ–¼Cocos Creatoré–‹ç™¼ï¼Œä¹Ÿæ˜¯é€šç”¨çš„è»Ÿé«”å·¥ç¨‹æœ€ä½³å¯¦è¸ã€‚