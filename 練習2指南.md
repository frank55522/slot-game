# ç·´ç¿’2 ç¬¬ä¸€é¡Œå¯¦ä½œæŒ‡å—

## é¡Œç›®æè¿°
èª¿æ•´feature gameçµç®—æµç¨‹ï¼šç•¶free gamesæˆ–dragon bonus gamesçµæŸæ™‚ï¼Œå¦‚æœç¸½è´åˆ†ä½æ–¼Big Winé–€æª»ï¼Œå‰‡è·³éçµç®—é¢æ¿ç›´æ¥è¿”å›BaseGameã€‚

## 1. å¯¦ä½œå‰çš„æ€è·¯æ§‹ç¯‰

### 1.1 å•é¡Œåˆ†æ
- **æ ¸å¿ƒéœ€æ±‚**ï¼šæ¢ä»¶æ€§è·³éçµç®—é¢æ¿é¡¯ç¤º
- **è§¸ç™¼æ¢ä»¶**ï¼šç¸½è´åˆ† < Big Winé–€æª»
- **å½±éŸ¿ç¯„åœ**ï¼šFree Gameçµç®—ã€Dragon Bonusçµç®—
- **é æœŸè¡Œç‚º**ï¼šä½æ–¼é–€æª»æ™‚ç›´æ¥å›åˆ°BaseGameï¼Œé”åˆ°é–€æª»æ™‚æ­£å¸¸é¡¯ç¤ºçµç®—é¢æ¿

### 1.2 æŠ€è¡“æ€è€ƒé»
1. éœ€è¦æ‰¾åˆ°Big Winé–€æª»çš„å®šç¾©ä½ç½®å’Œåˆ¤æ–·é‚è¼¯
2. éœ€è¦æ‰¾åˆ°çµç®—é¢æ¿é¡¯ç¤ºçš„æ§åˆ¶é‚è¼¯
3. éœ€è¦äº†è§£PureMVCçš„Commandæ¨¡å¼
4. éœ€è¦ç†è§£éŠæˆ²ç‹€æ…‹æµè½‰æ©Ÿåˆ¶
5. **é‡è¦**ï¼šé¿å…ç¡¬ç·¨ç¢¼ï¼Œåˆ©ç”¨ç¾æœ‰çš„WinTypeåˆ¤æ–·ç³»çµ±

## 2. å°ˆæ¡ˆæ¶æ§‹ç†è§£

### 2.1 éœ€è¦äº†è§£çš„å°ˆæ¡ˆæ ¸å¿ƒéƒ¨åˆ†

#### PureMVCæ¶æ§‹æ¨¡å¼
- **Command**ï¼šè™•ç†æ¥­å‹™é‚è¼¯çš„æŒ‡ä»¤
- **Proxy**ï¼šæ•¸æ“šç®¡ç†ä»£ç†
- **Mediator**ï¼šè¦–åœ–ä¸­ä»‹è€…
- éŠæˆ²ä¸»è¦ä½¿ç”¨Commandä¾†æ§åˆ¶éŠæˆ²æµç¨‹

#### é—œéµç›®éŒ„çµæ§‹
```
assets/src/
â”œâ”€â”€ sgv3/                    # æ¡†æ¶æ ¸å¿ƒ
â”‚   â”œâ”€â”€ command/            # é€šç”¨æŒ‡ä»¤
â”‚   â”œâ”€â”€ proxy/              # æ•¸æ“šä»£ç†
â”‚   â””â”€â”€ vo/                 # å€¼å°è±¡
â”œâ”€â”€ game/                   # éŠæˆ²ç‰¹å®šå¯¦ä½œ
â”‚   â”œâ”€â”€ command/            # éŠæˆ²æŒ‡ä»¤
â”‚   â””â”€â”€ proxy/              # éŠæˆ²ä»£ç†
```

### 2.2 Big Winé–€æª»å®šç¾©å’Œåˆ¤æ–·ç³»çµ±
**æª”æ¡ˆä½ç½®**ï¼š`assets/src/sgv3/command/byGame/MultipleCalculateCommand.ts`

#### é–€æª»é…ç½®è¡¨
```typescript
// ä¸€èˆ¬æ¸ é“çš„é–€æª»å®šç¾©
const winTypeRangesNormal = [
    { min: 15, max: 35, type: WinType.bigWin, duration: BaseScoringDuration.Scoring_Win01 },
    { min: 35, max: 60, type: WinType.megaWin, duration: BaseScoringDuration.Scoring_Win02 },
    { min: 60, max: 100, type: WinType.superWin, duration: BaseScoringDuration.Scoring_Win03 },
    { min: 100, max: Infinity, type: WinType.jumboWin, duration: BaseScoringDuration.Scoring_Win04 }
];

// å…¨æ¸ é“çš„é–€æª»å®šç¾©ï¼ˆæ›´é«˜é–€æª»ï¼‰
const winTypeRangesOmniChannel = [
    { min: 17, max: 40, type: WinType.bigWin, duration: BaseScoringDuration.Scoring_Win01 },
    { min: 40, max: 60, type: WinType.megaWin, duration: BaseScoringDuration.Scoring_Win02 },
    { min: 60, max: 100, type: WinType.superWin, duration: BaseScoringDuration.Scoring_Win03 },
    { min: 100, max: Infinity, type: WinType.jumboWin, duration: BaseScoringDuration.Scoring_Win04 }
];
```

#### WinTypeè¨ˆç®—é‚è¼¯
```typescript
// MultipleCalculateCommand è² è²¬è¨ˆç®—ä¸¦è¨­å®š totalWinType
protected getWinType(winMultiple: number): WinType {
    const winTypeRanges = this.gameDataProxy.isOmniChannel() ? winTypeRangesOmniChannel : winTypeRangesNormal;
    for (const range of winTypeRanges) {
        if (winMultiple >= range.min && winMultiple < range.max) {
            return range.type;
        }
    }
    return WinType.none;
}

// çµæœæœƒå„²å­˜åœ¨ gameDataProxy.totalWinType
this.gameDataProxy.totalWinType = this.getWinType(totalMultiple);
```

**é‡é»**ï¼šç³»çµ±æœƒè‡ªå‹•è¨ˆç®—WinTypeä¸¦å„²å­˜åœ¨`gameDataProxy.totalWinType`ï¼Œæˆ‘å€‘ç›´æ¥ä½¿ç”¨é€™å€‹çµæœ

## 3. å¯¦ä½œæ–¹æ³•

### 3.1 å®šä½çµç®—æ§åˆ¶æŒ‡ä»¤

#### Free Gameçµç®—æŒ‡ä»¤
**æª”æ¡ˆä½ç½®**ï¼š`assets/src/game/command/state/GAME_Game2EndCommand.ts`
**æ ¸å¿ƒæ–¹æ³•**ï¼š`showCreditBoard()` - æ§åˆ¶çµç®—é¢æ¿é¡¯ç¤º

#### Dragon Bonusçµç®—æŒ‡ä»¤
**æª”æ¡ˆä½ç½®**ï¼š`assets/src/game/command/dragon-up/GAME_4_CreditCollectResultCommand.ts`
**æ ¸å¿ƒæ–¹æ³•**ï¼š`showCreditBoard()` - æ§åˆ¶çµç®—é¢æ¿é¡¯ç¤º

### 3.2 æœ€ä½³å¯¦ä½œæ–¹æ¡ˆï¼šä½¿ç”¨ç¾æœ‰çš„WinTypeåˆ¤æ–·

**æ ¸å¿ƒæ€è·¯**ï¼šç›´æ¥ä½¿ç”¨`MultipleCalculateCommand`å·²ç¶“è¨ˆç®—å¥½çš„`totalWinType`ï¼Œé¿å…é‡è¤‡å¯¦ä½œå’Œç¡¬ç·¨ç¢¼å•é¡Œã€‚

åœ¨å…©å€‹çµç®—æŒ‡ä»¤ä¸­éƒ½æ·»åŠ ç›¸åŒçš„åˆ¤æ–·é‚è¼¯ï¼š

```typescript
protected showCreditBoard() {
    // ... åŸæœ‰é‚è¼¯ ...
    
    let totalWin: number = this.gameDataProxy.convertCredit2Cash(
        this.gameDataProxy.spinEventData.playerTotalWin  // æˆ–å°æ‡‰çš„è´åˆ†ä¾†æº
    );

    // ç·´ç¿’2-1: æª¢æŸ¥æ˜¯å¦é”åˆ°Big Winæ¨™æº–ï¼Œæœªé”åˆ°å‰‡è·³éçµç®—é¢æ¿
    if (!this.isBigWinOrAbove(totalWin)) {
        // è´åˆ†å°æ–¼Big Winï¼Œç›´æ¥è·³éçµç®—é¢æ¿å›åˆ°BaseGame
        this.delayCloseBoard();
        return;
    }

    // é”åˆ°Big Winä»¥ä¸Šï¼Œæ­£å¸¸é¡¯ç¤ºçµç®—é¢æ¿
    this.sendNotification(StateWinEvent.SHOW_LAST_CREDIT_BOARD, totalWin);
    // ... å¾ŒçºŒé‚è¼¯ ...
}

/**
 * åˆ¤å®šè´åˆ†æ˜¯å¦é”åˆ°Big Winæ¨™æº–
 * ç›´æ¥ä½¿ç”¨ MultipleCalculateCommand å·²ç¶“è¨ˆç®—å¥½çš„ totalWinType
 * @param totalWin ç¸½è´åˆ†é‡‘é¡ (unused - ä½¿ç”¨å·²è¨ˆç®—çš„ totalWinType)
 * @returns true: é”åˆ°Big Winä»¥ä¸Š, false: æœªé”åˆ°Big Win
 */
private isBigWinOrAbove(totalWin: number): boolean {
    // ç›´æ¥ä½¿ç”¨ MultipleCalculateCommand å·²ç¶“è¨ˆç®—ä¸¦è¨­å®šçš„ totalWinType
    // é€™æ¨£å°±èƒ½ç¢ºä¿èˆ‡ MultipleCalculateCommand çš„é‚è¼¯å®Œå…¨åŒæ­¥
    const winType = this.gameDataProxy.totalWinType;
    
    // åˆ¤æ–·æ˜¯å¦ç‚º Big Win ä»¥ä¸Šç­‰ç´š
    return winType === WinType.bigWin || 
           winType === WinType.megaWin || 
           winType === WinType.superWin || 
           winType === WinType.jumboWin;
}
```

### 3.3 å¯¦ä½œå„ªå‹¢åˆ†æ

#### âœ… ä½¿ç”¨ totalWinType çš„å„ªé»
1. **å®Œå…¨åŒæ­¥**ï¼šç„¡è«–`MultipleCalculateCommand`å¦‚ä½•ä¿®æ”¹é–€æª»ï¼Œæˆ‘å€‘çš„é‚è¼¯éƒ½æœƒè‡ªå‹•è·Ÿéš¨
2. **é¿å…ç¡¬ç·¨ç¢¼**ï¼šä¸éœ€è¦é‡è¤‡å®šç¾©15å€ã€17å€ç­‰å›ºå®šæ•¸å€¼
3. **ä»£ç¢¼ç°¡æ½”**ï¼šç›´æ¥æ¯”è¼ƒWinTypeæšèˆ‰ï¼Œé‚è¼¯æ¸…æ™°
4. **å–®ä¸€æ•¸æ“šä¾†æº**ï¼šéµå¾ªSingle Source of TruthåŸå‰‡
5. **ç¶­è­·æ€§ä½³**ï¼šæœªä¾†ä¿®æ”¹åªéœ€è¦åœ¨ä¸€å€‹åœ°æ–¹é€²è¡Œ

#### âŒ é¿å…çš„å•é¡Œï¼ˆèˆŠæ–¹æ¡ˆï¼‰
```typescript
// é¿å…é€™ç¨®ç¡¬ç·¨ç¢¼æ–¹å¼ï¼š
const bigWinThreshold = 15; // å¦‚æœç³»çµ±æ”¹æˆ20å€ï¼Œé€™è£¡å°±éŒ¯äº†
return winMultiple >= bigWinThreshold;
```

### 3.4 æ¸¬è©¦åŠŸèƒ½ï¼ˆå¯é¸ï¼‰

ç‚ºäº†æ–¹ä¾¿æ¸¬è©¦ä¸åŒé–€æª»çš„æ•ˆæœï¼Œå¯ä»¥æ·»åŠ ConsoleæŒ‡ä»¤ä¾†è‡¨æ™‚èª¿æ•´é–€æª»ï¼š

#### æ•¸æ“šå±¤æ·»åŠ æ¸¬è©¦å±¬æ€§
**æª”æ¡ˆä½ç½®**ï¼š`assets/src/sgv3/vo/config/GameData.ts`
```typescript
/** è‡¨æ™‚Big Winé–€æª»æ¸¬è©¦ï¼ˆåƒ…ä¾›é–‹ç™¼æ¸¬è©¦ä½¿ç”¨ï¼‰ */
public tempBigWinThreshold: number = 15;
```

#### Consoleæ¸¬è©¦æŒ‡ä»¤
**æª”æ¡ˆä½ç½®**ï¼š`assets/src/sgv3/proxy/WebBridgeProxy.ts`
```typescript
/**
 * è¨­å®šBig Winé–€æª»æ¸¬è©¦ï¼ˆé–‹ç™¼ç”¨ï¼‰
 * ä½¿ç”¨æ–¹å¼ï¼šsetBigWinThreshold(20) - è¨­å®šç‚º20å€
 */
public setBigWinThreshold(threshold: number): void {
    if (threshold && threshold > 0) {
        // æ³¨æ„ï¼šé€™åªæœƒå½±éŸ¿tempBigWinThresholdï¼Œä¸æœƒå½±éŸ¿å¯¦éš›çš„WinTypeè¨ˆç®—
        this.gameDataProxy.tempBigWinThreshold = threshold;
        console.log(`ğŸ¯ æ¸¬è©¦é–€æª»å·²è¨­å®šç‚º ${threshold}x`);
        console.log('ğŸ’¡ æ³¨æ„ï¼šå¯¦éš›åˆ¤æ–·ä½¿ç”¨çš„æ˜¯MultipleCalculateCommandçš„WinTypeç³»çµ±');
    }
}
```

**æ³¨æ„**ï¼šæ¸¬è©¦åŠŸèƒ½ä¸æœƒå½±éŸ¿å¯¦éš›çš„WinTypeè¨ˆç®—ï¼Œåªæ˜¯ç‚ºäº†æ–¹ä¾¿ç†è§£é–€æª»æ¦‚å¿µ

## 4. é—œéµæŠ€è¡“é»èªªæ˜

### 4.1 PureMVC Commandæ¨¡å¼
- Commandè² è²¬è™•ç†å…·é«”çš„æ¥­å‹™é‚è¼¯
- é€é `sendNotification()` ç™¼é€äº‹ä»¶é€šçŸ¥
- é€é `facade.retrieveProxy()` ç²å–æ•¸æ“šä»£ç†

### 4.2 æ•¸å­¸è¨ˆç®—
ä½¿ç”¨ `MathUtil.div()` é€²è¡Œæµ®é»æ•¸é™¤æ³•ï¼Œé¿å…JavaScriptæµ®é»æ•¸ç²¾åº¦å•é¡Œ

### 4.3 ç‹€æ…‹æµè½‰
- `delayCloseBoard()` æ–¹æ³•è² è²¬æ¸…ç†ä¸¦è½‰æ›åˆ°ä¸‹ä¸€å€‹éŠæˆ²ç‹€æ…‹
- ä½¿ç”¨ `GlobalTimer` é€²è¡Œæ™‚é–“æ§åˆ¶

### 4.4 é€šçŸ¥æ©Ÿåˆ¶
- `StateWinEvent.SHOW_LAST_CREDIT_BOARD` ç”¨æ–¼é¡¯ç¤ºçµç®—é¢æ¿
- `WinEvent.FORCE_WIN_DISPOSE` ç”¨æ–¼å¼·åˆ¶æ¸…ç†è´åˆ†é¡¯ç¤º
- `CheckGameFlowCommand.NAME` ç”¨æ–¼æª¢æŸ¥éŠæˆ²æµç¨‹

## 5. æ¸¬è©¦é©—è­‰

### 5.1 å¯¦éš›æ¸¬è©¦æ–¹æ³•
1. **è§¸ç™¼Feature Game**ï¼šé€²è¡ŒéŠæˆ²ç›´åˆ°è§¸ç™¼Free Gameæˆ–Dragon Bonus
2. **è§€å¯Ÿçµç®—è¡Œç‚º**ï¼š
   - WinType < bigWinï¼šæ‡‰è©²è·³éçµç®—é¢æ¿ï¼Œç›´æ¥å›åˆ°BaseGame
   - WinType >= bigWinï¼šæ‡‰è©²æ­£å¸¸é¡¯ç¤ºçµç®—é¢æ¿
3. **æª¢æŸ¥åˆ¤æ–·é‚è¼¯**ï¼šå¯åœ¨ConsoleæŸ¥çœ‹ `gameDataProxy.totalWinType` çš„å€¼

### 5.2 æ¸¬è©¦æ¡ˆä¾‹ç¯„ä¾‹
```javascript
// åœ¨Consoleä¸­æª¢æŸ¥ç•¶å‰WinType
console.log('ç•¶å‰WinType:', gameDataProxy.totalWinType);

// å°æ‡‰çš„è¡Œç‚ºé æœŸï¼š
// WinType.section_1 ~ WinType.section_15 â†’ è·³éçµç®—é¢æ¿
// WinType.bigWin, megaWin, superWin, jumboWin â†’ é¡¯ç¤ºçµç®—é¢æ¿
```

### 5.3 é©—è­‰é»checklist
- [ ] Free Gameçµç®—ï¼šä½æ–¼Big Winæ™‚è·³éé¢æ¿
- [ ] Free Gameçµç®—ï¼šé”åˆ°Big Winæ™‚é¡¯ç¤ºé¢æ¿  
- [ ] Dragon Bonusçµç®—ï¼šä½æ–¼Big Winæ™‚è·³éé¢æ¿
- [ ] Dragon Bonusçµç®—ï¼šé”åˆ°Big Winæ™‚é¡¯ç¤ºé¢æ¿
- [ ] ä¸€èˆ¬æ¸ é“å’Œå…¨æ¸ é“é–€æª»å·®ç•°æ­£ç¢ºè™•ç†
- [ ] æµç¨‹è·³éå¾Œæ­£å¸¸å›åˆ°BaseGame

## 6. å­¸ç¿’é‡é»ç¸½çµ

### 6.1 å°ˆæ¡ˆæ¶æ§‹ç†è§£
- æŒæ¡PureMVCçš„MVCä¸‰å±¤æ¶æ§‹
- ç†è§£Command-Proxy-Mediatorçš„è·è²¬åˆ†å·¥
- äº†è§£éŠæˆ²ç‹€æ…‹æ©Ÿçš„é‹ä½œæ–¹å¼
- **å­¸æœƒåˆ©ç”¨ç¾æœ‰ç³»çµ±**ï¼šå–„ç”¨å·²æœ‰çš„è¨ˆç®—çµæœï¼Œé¿å…é‡è¤‡å¯¦ä½œ

### 6.2 ç¨‹å¼è¨­è¨ˆæœ€ä½³å¯¦è¸
- **é¿å…ç¡¬ç·¨ç¢¼**ï¼šä½¿ç”¨ç³»çµ±è¨ˆç®—çš„çµæœè€Œéå›ºå®šæ•¸å€¼
- **å–®ä¸€æ•¸æ“šä¾†æºåŸå‰‡**ï¼šé‡è¦é‚è¼¯é›†ä¸­ç®¡ç†ï¼Œç¢ºä¿ä¸€è‡´æ€§
- **ä»£ç¢¼å¾©ç”¨**ï¼šåˆ©ç”¨ç¾æœ‰çš„`MultipleCalculateCommand`é‚è¼¯
- **ç¶­è­·æ€§è€ƒé‡**ï¼šä¿®æ”¹é–€æª»åªéœ€è¦åœ¨ä¸€å€‹åœ°æ–¹é€²è¡Œ

### 6.3 è¨­è¨ˆæ¨¡å¼æ‡‰ç”¨
- ç­–ç•¥æ¨¡å¼ï¼šæ¢ä»¶æ€§åŸ·è¡Œä¸åŒé‚è¼¯
- ä»£ç†æ¨¡å¼ï¼šé€éProxyç®¡ç†æ•¸æ“šè¨ªå•
- è§€å¯Ÿè€…æ¨¡å¼ï¼šé€éé€šçŸ¥æ©Ÿåˆ¶è§£è€¦çµ„ä»¶
- **ä¾è³´å€’ç½®**ï¼šä¾è³´æ–¼æŠ½è±¡çš„WinTypeï¼Œè€Œéå…·é«”çš„æ•¸å€¼

### 6.4 éŠæˆ²é–‹ç™¼å¯¦å‹™
- äº†è§£éŠæˆ²çµç®—æµç¨‹çš„è¨­è¨ˆ
- å­¸ç¿’å¦‚ä½•åˆ©ç”¨ç¾æœ‰ç³»çµ±è€Œéé‡æ–°ç™¼æ˜è¼ªå­
- æŒæ¡ConsoleæŒ‡ä»¤çš„å¯¦ä½œæ–¹å¼ï¼ˆæ¸¬è©¦è¼”åŠ©ï¼‰

### 6.5 TypeScripté–‹ç™¼æŠ€å·§
- ä»‹é¢è¨­è¨ˆèˆ‡å¯¦ä½œ
- é¡å‹å®‰å…¨çš„æ•¸æ“šè¨ªå•
- æ¨¡çµ„åŒ–ç¨‹å¼çµ„ç¹”

### 6.6 å•é¡Œè§£æ±ºæ€ç¶­
- **è­˜åˆ¥ç¡¬ç·¨ç¢¼å•é¡Œ**ï¼šç™¼ç¾å›ºå®šæ•¸å€¼å¸¶ä¾†çš„ç¶­è­·å›°é›£
- **å°‹æ‰¾ç¾æœ‰è§£æ±ºæ–¹æ¡ˆ**ï¼šå–„ç”¨å°ˆæ¡ˆæ—¢æœ‰çš„ç³»çµ±å’Œè³‡æ–™
- **é‡æ§‹æ”¹é€²**ï¼šå¾ç¡¬ç·¨ç¢¼åˆ°å‹•æ…‹åˆ¤æ–·çš„æ¼”é€²éç¨‹
- **è€ƒæ…®ç¶­è­·æ€§**ï¼šè®“ä»£ç¢¼åœ¨éœ€æ±‚è®Šæ›´æ™‚æ›´å®¹æ˜“ä¿®æ”¹

## 7. é‡è¦å­¸ç¿’æˆæœ

### 7.1 å¾ç¡¬ç·¨ç¢¼åˆ°å‹•æ…‹åˆ¤æ–·çš„æ¼”é€²

**åŸå§‹å•é¡Œ**ï¼š
```typescript
// âŒ ç¡¬ç·¨ç¢¼é–€æª»å€¼
const bigWinThreshold = 15;
return winMultiple >= bigWinThreshold;
```

**æœ€çµ‚è§£æ±ºæ–¹æ¡ˆ**ï¼š
```typescript  
// âœ… ä½¿ç”¨ç³»çµ±è¨ˆç®—çš„WinType
const winType = this.gameDataProxy.totalWinType;
return winType === WinType.bigWin || winType === WinType.megaWin || ...;
```

### 7.2 é—œéµæ´å¯Ÿ
1. **ç™¼ç¾å•é¡Œçš„æ•éŠ³åº¦**ï¼šèƒ½å¤ æ„è­˜åˆ°ç¡¬ç·¨ç¢¼çš„ç¶­è­·å•é¡Œ
2. **ç³»çµ±æ€§æ€è€ƒ**ï¼šç†è§£ä¸åŒçµ„ä»¶é–“çš„é—œè¯æ€§
3. **å„ªé›…è§£æ±ºæ–¹æ¡ˆ**ï¼šåˆ©ç”¨ç¾æœ‰ç³»çµ±è€Œéé‡è¤‡å¯¦ä½œ
4. **å‰ç»æ€§è€ƒæ…®**ï¼šè€ƒæ…®æœªä¾†ä¿®æ”¹çš„ä¾¿åˆ©æ€§

## 8. å»¶ä¼¸æ€è€ƒ

1. **æ¶æ§‹è¨­è¨ˆ**ï¼šå¦‚ä½•åœ¨å¤§å‹å°ˆæ¡ˆä¸­é¿å…é¡ä¼¼çš„ç¡¬ç·¨ç¢¼å•é¡Œï¼Ÿ
2. **æ¸¬è©¦ç­–ç•¥**ï¼šå¦‚ä½•ç¢ºä¿é–€æª»è®Šæ›´ä¸æœƒç ´å£ç¾æœ‰åŠŸèƒ½ï¼Ÿ
3. **ä»£ç¢¼å¯©æŸ¥**ï¼šå¦‚ä½•åœ¨Reviewä¸­ç™¼ç¾ä¸¦é é˜²æ­¤é¡å•é¡Œï¼Ÿ
4. **æ–‡æª”ç¶­è­·**ï¼šå¦‚ä½•ç¢ºä¿å¯¦ä½œæŒ‡å—èˆ‡å¯¦éš›ä»£ç¢¼ä¿æŒåŒæ­¥ï¼Ÿ

é€™äº›æ€è€ƒé»é«”ç¾äº†å¾å–®ç´”çš„åŠŸèƒ½å¯¦ä½œåˆ°ç³»çµ±æ€§è»Ÿé«”å·¥ç¨‹æ€ç¶­çš„æå‡ã€‚

---

# ç·´ç¿’2 ç¬¬äºŒé¡Œå¯¦ä½œæŒ‡å—

## é¡Œç›®æè¿°
åœ¨BaseGameæ»¾åœå¾Œè‹¥æœ‰è§¸ç™¼ç‰¹è‰²éŠæˆ²ï¼ˆç›¤é¢ä¸Šæœ‰6é¡†æˆ–ä»¥ä¸Šçš„åˆ†æ•¸çƒï¼‰ï¼Œå‰‡åœ¨æ”¶é›†çƒåˆ†ä¹‹å‰å¡ä½æµç¨‹ï¼Œè®“ç›¤é¢ä¸Šçš„åˆ†æ•¸çƒåšä»»æ„è¡¨æ¼”ï¼ˆç°¡å–®çš„ç¸®æ”¾å‹•ç•«æˆ–æ’­æ”¾ä»»æ„ç²’å­ç‰¹æ•ˆéƒ½å¯ä»¥ï¼‰ï¼Œè¡¨æ¼”å®Œå¾Œå†ç¹¼çºŒå¾ŒçºŒæ”¶é›†çƒåˆ†çš„æµç¨‹ï¼Œä¸¦è«‹èªªæ˜å¡ä½æµç¨‹åŠåˆ†æ•¸çƒè¡¨æ¼”çš„ä½œæ³•ã€‚

## 1. å¯¦ä½œå‰çš„æ€è·¯æ§‹ç¯‰

### 1.1 å•é¡Œæ‹†è§£
- **æ ¸å¿ƒéœ€æ±‚**ï¼šåœ¨æ”¶é›†çƒåˆ†å‰æ’å…¥è¡¨æ¼”å‹•ç•«
- **è§¸ç™¼æ¢ä»¶**ï¼šBaseGameæ»¾åœ + ballCount >= 6
- **æŠ€è¡“æŒ‘æˆ°**ï¼šå¦‚ä½•å¡ä½ç¾æœ‰æµç¨‹ä¸¦æ’å…¥è‡ªå®šç¾©è¡¨æ¼”
- **è¨­è¨ˆè€ƒé‡**ï¼šä¸ç ´å£ç¾æœ‰æ¶æ§‹ï¼Œåˆ©ç”¨æ—¢æœ‰ç³»çµ±

### 1.2 åˆ†æç¾æœ‰æµç¨‹
1. BaseGameæ»¾åœ â†’ `GAME_Game1RollCompleteCommand`
2. é€²å…¥Feature Selection â†’ `GAME_Game1FeatureSelectionCommand`
3. ç™¼é€æ”¶é›†æº–å‚™ â†’ `ViewMediatorEvent.PREPARE_COLLECT_BALL`
4. é–‹å§‹æ”¶é›†çƒåˆ† â†’ Ballæ”¶é›†å‹•ç•«

**æ’å…¥é»è­˜åˆ¥**ï¼šåœ¨æ­¥é©Ÿ3ä¹‹å‰æ’å…¥è¡¨æ¼”ï¼Œå»¶é²æ­¥é©Ÿ3çš„åŸ·è¡Œ

### 1.3 æŠ€è¡“æ–¹æ¡ˆé¸æ“‡
åƒè€ƒå…¶ä»–é–‹ç™¼è€…çš„å¯¦ä½œæ–¹æ³•ï¼Œæ¡ç”¨Symbolç‰¹æ•ˆç³»çµ±ï¼š
- åˆ©ç”¨ç¾æœ‰çš„SymbolFXç‰¹æ•ˆæ± 
- æ·»åŠ æ–°çš„SymbolPerformTypeç‹€æ…‹
- ä½¿ç”¨äº‹ä»¶æ©Ÿåˆ¶è§¸ç™¼è¡¨æ¼”
- é€šéå»¶é²æ©Ÿåˆ¶æ§åˆ¶æµç¨‹

## 2. éœ€è¦äº†è§£çš„å°ˆæ¡ˆæ ¸å¿ƒå…§å®¹

### 2.1 ç¬¦è™Ÿç‰¹æ•ˆç³»çµ± (SymbolFX System)

#### 2.1.1 SymbolPerformTypeæšèˆ‰
**æª”æ¡ˆä½ç½®**ï¼š`assets/src/sgv3/vo/enum/Reel.ts:21-34`

```typescript
export enum SymbolPerformType {
    SHOW = 0,
    HIDE = 1,
    SHOW_ALL_WIN = 3,
    SHOW_LOOP_WIN = 4,
    // ...ç¾æœ‰ç‹€æ…‹
    SHOW_TARGERT_CREDIT_RESULT = 14
}
```

**ç”¨é€”**ï¼šå®šç¾©ç¬¦è™Ÿå¯åŸ·è¡Œçš„å„ç¨®è¡¨æ¼”é¡å‹ï¼Œæ¯å€‹é¡å‹å°æ‡‰ä¸åŒçš„å‹•ç•«æ•ˆæœã€‚

#### 2.1.2 SymbolFXç‰¹æ•ˆé¡åˆ¥
**æª”æ¡ˆä½ç½®**ï¼š`assets/src/game/view/symbol/SymbolFXStateRegister.ts`

é€™æ˜¯ç¬¦è™Ÿç‰¹æ•ˆçš„æ ¸å¿ƒå¯¦ä½œï¼ŒåŒ…å«ï¼š
- ç‹€æ…‹è¨»å†Šæ©Ÿåˆ¶ï¼šæ ¹æ“šSymbolIdè¨»å†Šå°æ‡‰çš„ç‰¹æ•ˆç‹€æ…‹
- UIViewStateBaseåŸºé¡ï¼šæ‰€æœ‰ç‰¹æ•ˆç‹€æ…‹çš„åŸºç¤é¡åˆ¥
- å…·é«”ç‰¹æ•ˆå¯¦ä½œï¼šå¦‚`SymbolFXShowState`ã€`SymbolFXBaseCreditUpdateState`ç­‰

**é—œéµæ¦‚å¿µ**ï¼š
```typescript
// ç‰¹æ•ˆç‹€æ…‹åŸºæœ¬çµæ§‹
export class SymbolFXShowState extends UIViewStateBase {
    public effectId: number = SymbolPerformType.SHOW; // å°æ‡‰çš„è¡¨æ¼”é¡å‹
    
    onPlay() {
        // æ’­æ”¾é‚è¼¯
    }
    
    onSkip() {
        // è·³éé‚è¼¯
    }
}
```

### 2.2 ReelViewèˆ‡Poolç®¡ç†

#### 2.2.1 SymbolFXå°è±¡æ± 
ReelViewç¶­è­·ä¸€å€‹SymbolFXå°è±¡æ± ï¼Œç”¨æ–¼å¾©ç”¨ç‰¹æ•ˆå°è±¡ï¼š
- æ ¹æ“šä½ç½®ç´¢å¼• `poolKey = y * 5 + x` ç²å–å°è±¡
- é¿å…é‡è¤‡å‰µå»ºï¼Œæå‡æ€§èƒ½
- æ”¯æ´å‹•æ…‹ä½ç½®è¨­å®šå’Œç‰¹æ•ˆæ’­æ”¾

#### 2.2.2 ReelViewMediatoräº‹ä»¶è™•ç†
**æª”æ¡ˆä½ç½®**ï¼š`assets/src/game/mediator/ReelViewMediator.ts`

è² è²¬ï¼š
- ç›£è½å„ç¨®éŠæˆ²äº‹ä»¶
- èª¿ç”¨ReelViewçš„æ–¹æ³•åŸ·è¡Œå…·é«”è¡¨æ¼”
- ç®¡ç†ç¬¦è™Ÿç‰¹æ•ˆçš„ç”Ÿå‘½é€±æœŸ

### 2.3 äº‹ä»¶ç³»çµ±èˆ‡æµç¨‹æ§åˆ¶

#### 2.3.1 ViewMediatorEventäº‹ä»¶å¸¸æ•¸
**æª”æ¡ˆä½ç½®**ï¼š`assets/src/sgv3/util/Constant.ts`

```typescript
export class ViewMediatorEvent {
    public static readonly PREPARE_COLLECT_BALL: string = 'prepareCollectBall';
    // å…¶ä»–äº‹ä»¶...
}
```

**ä½œç”¨**ï¼šçµ±ä¸€ç®¡ç†éŠæˆ²ä¸­çš„å„ç¨®äº‹ä»¶å¸¸æ•¸ï¼Œç¢ºä¿äº‹ä»¶åç¨±çš„ä¸€è‡´æ€§ã€‚

#### 2.3.2 CommandæŒ‡ä»¤æ¨¡å¼
- æ¯å€‹éŠæˆ²ç‹€æ…‹å°æ‡‰ä¸€å€‹Commandé¡åˆ¥
- Commandè² è²¬è©²ç‹€æ…‹çš„æ¥­å‹™é‚è¼¯è™•ç†
- é€šé`sendNotification()`ç™¼é€äº‹ä»¶åˆ°å…¶ä»–çµ„ä»¶

## 3. å°ˆæ¡ˆä¸­é¡ä¼¼çš„è£½ä½œæ–¹å¼ç¯„ä¾‹

### 3.1 ç¾æœ‰çš„åˆ†æ•¸çƒæ”¶é›†ç‰¹æ•ˆ
**æª”æ¡ˆä½ç½®**ï¼š`assets/src/game/view/symbol/SymbolFXStateRegister.ts:141-166`

```typescript
export class SymbolFXBaseCreditUpdateState extends UIViewStateBase {
    public effectId: number = SymbolPerformType.SHOW_BASE_CREDIT_COLLECT;

    onPlay() {
        if (this.content.animation) {
            this.content.animation.play('BeginEffect', () => this.playWin());
        }
    }

    playWin() {
        this.content.animation.play('PlayWin');
        this.onEffectFinished(); // é€šçŸ¥è¡¨æ¼”å®Œæˆ
    }
}
```

**å­¸ç¿’é‡é»**ï¼š
- ä½¿ç”¨å›èª¿å‡½æ•¸æ§åˆ¶å‹•ç•«åºåˆ—
- é€šé`onEffectFinished()`é€šçŸ¥ç³»çµ±è¡¨æ¼”å®Œæˆ
- å¯æ’­æ”¾é€£çºŒçš„å‹•ç•«æ•ˆæœ

### 3.2 ç¬¦è™Ÿè´åˆ†è¡¨æ¼”
**æª”æ¡ˆä½ç½®**ï¼š`assets/src/game/view/symbol/SymbolFXStateRegister.ts:40-116`

```typescript
export class SymbolFXShowState extends UIViewStateBase {
    private tempTween: Tween<Node> | null = null;

    onPlay() {
        // è¨­å®šæ¨™ç±¤æ–‡å­—å’Œå­—é«”
        if (this.content.labelText) {
            this.content.labelText.string = String(this.content.credit);
        }
        
        // æ’­æ”¾å‹•ç•«ä¸¦è¨­å®šå®Œæˆå›èª¿
        this.tempTween = tween(this.content.node)
            .delay(2)
            .call(() => {
                this.onEffectFinished();
            })
            .start();
    }

    onSkip() {
        this.tempTween.stop();
        this.onEffectFinished();
    }
}
```

**å­¸ç¿’é‡é»**ï¼š
- ä½¿ç”¨Cocos Creatorçš„Tweenç³»çµ±è£½ä½œå‹•ç•«
- æ”¯æ´è·³éåŠŸèƒ½ï¼ˆonSkipï¼‰
- å¦¥å–„ç®¡ç†Tweenå°è±¡é¿å…è¨˜æ†¶é«”æ´©æ¼

### 3.3 å»¶é²åŸ·è¡Œæ©Ÿåˆ¶ç¯„ä¾‹
**æª”æ¡ˆä½ç½®**ï¼š`assets/src/game/command/state/GAME_Game1RollCompleteCommand.ts:35-43`

```typescript
// å»¶é²æ”¶é›†çƒçš„è¡¨æ¼”
let delayTime: number = 0;
let ballCount = curRoundResult.extendInfoForbaseGameResult.ballCount;
if (ballCount >= 6 && this.isHitGrand == false) {
    delayTime = 2;
} else if (ballCount > 0) {
    delayTime = 0.1;
}
GlobalTimer.getInstance().registerTimer(this.timerKey, delayTime, this.endGame1RollComplete, this).start();
```

**å­¸ç¿’é‡é»**ï¼š
- ä½¿ç”¨GlobalTimeré€²è¡Œå»¶é²æ§åˆ¶
- æ ¹æ“šæ¢ä»¶è¨­å®šä¸åŒçš„å»¶é²æ™‚é–“
- Timerå®Œæˆå¾ŒåŸ·è¡Œå›èª¿å‡½æ•¸

## 4. æˆ‘å€‘çš„å¯¦ä½œæ–¹æ³•

### 4.1 ç¬¬ä¸€æ­¥ï¼šæ–°å¢è¡¨æ¼”ç‹€æ…‹

**æª”æ¡ˆä½ç½®**ï¼š`assets/src/sgv3/vo/enum/Reel.ts:34`
```typescript
export enum SymbolPerformType {
    // ...ç¾æœ‰ç‹€æ…‹
    SHOW_TARGERT_CREDIT_RESULT = 14, //å‡é¾è³ C2 çƒ æœ€çµ‚çµæœ è¡¨æ¼”
    BEFORE_COLLECT = 15 //ç·´ç¿’2: æ”¶é›†åˆ†æ•¸çƒå‰çš„è¡¨æ¼”
}
```

**ç›®çš„**ï¼šç‚ºæ–°çš„è¡¨æ¼”é¡å‹å®šç¾©å”¯ä¸€æ¨™è­˜ç¬¦ã€‚

### 4.2 ç¬¬äºŒæ­¥ï¼šå¯¦ä½œè¡¨æ¼”ç‰¹æ•ˆé¡åˆ¥

**æª”æ¡ˆä½ç½®**ï¼š`assets/src/game/view/symbol/SymbolFXStateRegister.ts`

#### A. è¨»å†Šæ–°ç‹€æ…‹
åœ¨ç¬¬30è¡Œç‚ºC1ç¬¦è™Ÿè¨»å†Šæ–°çš„è¡¨æ¼”ç‹€æ…‹ï¼š
```typescript
case SymbolId.C1:
    this.registerState(new SymbolFXShowState(this.content));
    this.registerState(new SymbolFXBaseCreditUpdateState(this.content));
    this.registerState(new SymbolFXBeforeCollectState(this.content)); // æ–°å¢
    break;
```

#### B. å¯¦ä½œè¡¨æ¼”é¡åˆ¥ï¼ˆç¬¬232-280è¡Œï¼‰
```typescript
export class SymbolFXBeforeCollectState extends UIViewStateBase {
    private content: SymbolFXContent | null = null;
    private tempTween: Tween<Node> | null = null;

    public effectId: number = SymbolPerformType.BEFORE_COLLECT;

    constructor(content: SymbolFXContent) {
        super();
        this.content = content;
    }

    onPlay() {
        // è¨­å®šåˆ†æ•¸çƒæ¨™ç±¤æ–‡å­—
        if (this.content.labelText) {
            this.content.labelText.font = this.content.isSpecialFont
                ? this.content.specialFont
                : this.content.baseFont;
            this.content.labelText.string = this.content.isOmniChannel
                ? String(this.content.credit)
                : String(BalanceUtil.formatBalanceWithExpressingUnits(this.content.credit));
        }

        // æ’­æ”¾ç¸®æ”¾å‹•ç•«è¡¨æ¼” (ç°¡å–®çš„å¼·èª¿å‹•ç•«)
        const originalScale = this.content.node.scale.clone();
        const targetScale = new Vec3(originalScale.x * 1.2, originalScale.y * 1.2, originalScale.z);
        
        this.tempTween = tween(this.content.node)
            .to(0.3, { scale: targetScale })    // æ”¾å¤§
            .to(0.3, { scale: originalScale })  // ç¸®å°
            .to(0.3, { scale: targetScale })    // å†æ”¾å¤§
            .to(0.3, { scale: originalScale })  // æ¢å¾©åŸç‹€
            .call(() => {
                this.onEffectFinished();        // é€šçŸ¥å®Œæˆ
            })
            .start();
    }

    onSkip() {
        if (this.tempTween) {
            this.tempTween.stop();
        }
        this.onEffectFinished();
    }
}
```

**æŠ€è¡“è¦é»**ï¼š
- ç¹¼æ‰¿`UIViewStateBase`åŸºé¡
- ä½¿ç”¨`effectId`é—œè¯è¡¨æ¼”é¡å‹
- é€šé`onPlay()`å¯¦ä½œè¡¨æ¼”é‚è¼¯
- é€šé`onSkip()`æ”¯æ´è·³éåŠŸèƒ½
- ä½¿ç”¨`onEffectFinished()`é€šçŸ¥ç³»çµ±è¡¨æ¼”å®Œæˆ

### 4.3 ç¬¬ä¸‰æ­¥ï¼šæ–°å¢è§¸ç™¼äº‹ä»¶

**æª”æ¡ˆä½ç½®**ï¼š`assets/src/sgv3/util/Constant.ts:177`
```typescript
export class ViewMediatorEvent {
    // ...ç¾æœ‰äº‹ä»¶
    /** ç·´ç¿’2: æ”¶é›†åˆ†æ•¸çƒå‰çš„è¡¨æ¼” */
    public static readonly BEFORE_COLLECT_BALL: string = 'beforeCollectBall';
    public static readonly PREPARE_COLLECT_BALL: string = 'prepareCollectBall';
}
```

**ç›®çš„**ï¼šå®šç¾©æ–°çš„äº‹ä»¶å¸¸æ•¸ï¼Œç”¨æ–¼è§¸ç™¼åˆ†æ•¸çƒè¡¨æ¼”ã€‚

### 4.4 ç¬¬å››æ­¥ï¼šä¿®æ”¹æµç¨‹æ§åˆ¶é‚è¼¯

**æª”æ¡ˆä½ç½®**ï¼š`assets/src/game/command/state/GAME_Game1FeatureSelectionCommand.ts:15-29`

```typescript
public execute(notification: puremvc.INotification): void {
    this.gameDataProxy.hasSelectionResponse = false;
    
    // ç·´ç¿’2: æª¢æŸ¥æ˜¯å¦éœ€è¦æ’­æ”¾åˆ†æ•¸çƒè¡¨æ¼”
    let ballCount = this.gameDataProxy.spinEventData.baseGameResult.extendInfoForbaseGameResult.ballCount;
    if (ballCount >= 6) {
        // å…ˆè§¸ç™¼åˆ†æ•¸çƒè¡¨æ¼”
        this.sendNotification(ViewMediatorEvent.BEFORE_COLLECT_BALL);
        // å»¶é²ç™¼é€PREPARE_COLLECT_BALL (è¡¨æ¼”æ™‚é–“ç´„1.2ç§’)
        setTimeout(() => {
            this.sendNotification(ViewMediatorEvent.PREPARE_COLLECT_BALL);
            this.endGame1FeatureSelection();
        }, 1200);
    } else {
        // åŸæœ‰é‚è¼¯ï¼šç›´æ¥ç™¼é€PREPARE_COLLECT_BALL
        this.sendNotification(ViewMediatorEvent.PREPARE_COLLECT_BALL);
        this.endGame1FeatureSelection();
    }
}
```

**é—œéµæŠ€è¡“é»**ï¼š
- æ¢ä»¶åˆ¤æ–·ï¼šåªåœ¨`ballCount >= 6`æ™‚åŸ·è¡Œè¡¨æ¼”
- äº‹ä»¶é †åºï¼šå…ˆç™¼é€`BEFORE_COLLECT_BALL`ï¼Œå¾Œç™¼é€`PREPARE_COLLECT_BALL`
- æ™‚é–“æ§åˆ¶ï¼šä½¿ç”¨`setTimeout`å»¶é²1200æ¯«ç§’ï¼ˆé…åˆè¡¨æ¼”æ™‚é•·ï¼‰
- æµç¨‹åˆ†æ”¯ï¼šä¿æŒåŸæœ‰é‚è¼¯ä¸è®Šï¼Œåªåœ¨ç‰¹å®šæ¢ä»¶ä¸‹æ’å…¥æ–°é‚è¼¯

### 4.5 ç¬¬äº”æ­¥ï¼šReelViewMediatoräº‹ä»¶è™•ç†

**æª”æ¡ˆä½ç½®**ï¼š`assets/src/game/mediator/ReelViewMediator.ts`

#### A. æ·»åŠ äº‹ä»¶ç›£è½ï¼ˆç¬¬87è¡Œï¼‰
```typescript
public listNotificationInterests(): Array<string> {
    return Array.from(new Set([
        // ...ç¾æœ‰äº‹ä»¶
        AfterReconnectionCommand.NAME,
        ViewMediatorEvent.BEFORE_COLLECT_BALL  // æ–°å¢
    ].concat(super.baseListNotificationInterests())));
}
```

#### B. æ·»åŠ äº‹ä»¶è™•ç†ï¼ˆç¬¬168-170è¡Œï¼‰
```typescript
public handleNotification(notification: puremvc.INotification): void {
    super.baseHandleNotification(notification);
    let name = notification.getName();
    switch (name) {
        // ...ç¾æœ‰case
        case ViewMediatorEvent.BEFORE_COLLECT_BALL:
            this.playBeforeCollectBallAnimation();
            break;
    }
}
```

#### C. å¯¦ä½œè¡¨æ¼”é‚è¼¯ï¼ˆç¬¬707-727è¡Œï¼‰
```typescript
protected playBeforeCollectBallAnimation() {
    // ç²å–BaseGameçµæœå’Œåˆ†æ•¸çƒä½ç½®ä¿¡æ¯
    let ballHitInfo = this.gameDataProxy.spinEventData.baseGameResult.extendInfoForbaseGameResult;
    
    // æ‰¾å‡ºæ‰€æœ‰æœ‰åˆ†æ•¸çƒçš„ä½ç½®
    for (let x = 0; x < ballHitInfo.ballScreenLabel.length; x++) {
        for (let y = 0; y < ballHitInfo.ballScreenLabel[x].length; y++) {
            if (ballHitInfo.ballScreenLabel[x][y] > 0) {
                // å‰µå»ºSymbolInfoä¾†æ¨™è­˜åˆ†æ•¸çƒä½ç½®
                let symbolInfo: SymbolInfo = new SymbolInfo();
                symbolInfo.sid = SymbolId.C1; // åˆ†æ•¸çƒçš„Symbol ID
                symbolInfo.x = x;
                symbolInfo.y = y;
                
                // å¾poolä¸­å–å‡ºSymbolFXä¸¦æ’­æ”¾BEFORE_COLLECTå‹•ç•«
                this.reelView.createAnimSymbol(symbolInfo);
                this.reelView.showBeforeCollectBallAnimation(symbolInfo, this.reelDataProxy.symbolFeature[x][y]);
            }
        }
    }
}
```

**æŠ€è¡“è§£æ**ï¼š
- éæ­·ç›¤é¢æ‰¾å‡ºæ‰€æœ‰åˆ†æ•¸çƒä½ç½®
- ç‚ºæ¯å€‹åˆ†æ•¸çƒå‰µå»ºSymbolInfoå°è±¡
- èª¿ç”¨ReelViewçš„æ–¹æ³•æ’­æ”¾è¡¨æ¼”å‹•ç•«
- åˆ©ç”¨ç¾æœ‰çš„`symbolFeature`æ•¸æ“šè¨­å®šè¡¨æ¼”åƒæ•¸

### 4.6 ç¬¬å…­æ­¥ï¼šReelViewæ”¯æ´æ–¹æ³•

**æª”æ¡ˆä½ç½®**ï¼š`assets/src/game/view/GAME_ReelView.ts:335-347`

```typescript
public showBeforeCollectBallAnimation(symbolInfo: SymbolInfo, featureInfo: SymbolPosData) {
    const self = this;
    let poolKey: number = symbolInfo.y * self.reelsList.length + symbolInfo.x;
    let anim: SymbolFX = self.animManager.pool.get(poolKey);

    if (anim) {
        anim.node.setWorldPosition(self.getSymbolPosition(symbolInfo.x, symbolInfo.y));
        anim.setInfo(symbolInfo.sid, featureInfo);
        anim.node.active = true;
        // æ’­æ”¾BEFORE_COLLECTè¡¨æ¼”å‹•ç•«
        anim.play(SymbolPerformType.BEFORE_COLLECT);
    }
}
```

**æŠ€è¡“è¦é»**ï¼š
- è¨ˆç®—å°è±¡æ± ç´¢å¼•ï¼š`poolKey = y * reelLength + x`
- å¾å°è±¡æ± ç²å–SymbolFXå°è±¡
- è¨­å®šä¸–ç•Œåº§æ¨™ä½ç½®å’Œç¬¦è™Ÿä¿¡æ¯
- èª¿ç”¨`play()`æ–¹æ³•æ’­æ”¾æŒ‡å®šé¡å‹çš„è¡¨æ¼”

## 5. å¡ä½æµç¨‹çš„å¯¦ä½œåŸç†

### 5.1 åŸå§‹æµç¨‹åˆ†æ
```
BaseGameæ»¾åœ â†’ GAME_Game1RollCompleteCommand
    â†“
GAME_Game1FeatureSelectionCommand.execute()
    â†“
sendNotification(PREPARE_COLLECT_BALL)  â† åŸæœ¬ç«‹å³åŸ·è¡Œ
    â†“
BallHitViewMediatoræ”¶åˆ°é€šçŸ¥é–‹å§‹æ”¶é›†
```

### 5.2 ä¿®æ”¹å¾Œçš„æµç¨‹
```
BaseGameæ»¾åœ â†’ GAME_Game1RollCompleteCommand
    â†“
GAME_Game1FeatureSelectionCommand.execute()
    â†“
ballCount >= 6 ?
    â”œâ”€ YES â†’ sendNotification(BEFORE_COLLECT_BALL)  â† æ’å…¥è¡¨æ¼”
    â”‚          â†“
    â”‚        setTimeout(1200ms)  â† å¡ä½æµç¨‹
    â”‚          â†“
    â”‚        sendNotification(PREPARE_COLLECT_BALL)  â† å»¶é²åŸ·è¡Œ
    â”‚
    â””â”€ NO â†’ sendNotification(PREPARE_COLLECT_BALL)  â† åŸæœ‰æµç¨‹
```

### 5.3 å¡ä½æ©Ÿåˆ¶çš„æŠ€è¡“å¯¦ä½œ

#### é—œéµç¨‹å¼ç¢¼è§£æï¼š
```typescript
if (ballCount >= 6) {
    // ç¬¬ä¸€æ­¥ï¼šè§¸ç™¼è¡¨æ¼”
    this.sendNotification(ViewMediatorEvent.BEFORE_COLLECT_BALL);
    
    // ç¬¬äºŒæ­¥ï¼šå»¶é²åŸæœ‰æµç¨‹
    setTimeout(() => {
        this.sendNotification(ViewMediatorEvent.PREPARE_COLLECT_BALL);
        this.endGame1FeatureSelection();
    }, 1200);  // å¡ä½1.2ç§’
} else {
    // åŸæœ‰æµç¨‹ï¼šä¸å¡ä½ï¼Œç›´æ¥åŸ·è¡Œ
    this.sendNotification(ViewMediatorEvent.PREPARE_COLLECT_BALL);
    this.endGame1FeatureSelection();
}
```

#### è¨­è¨ˆå„ªé»ï¼š
1. **éå…¥ä¾µæ€§**ï¼šä¸ä¿®æ”¹ç¾æœ‰æµç¨‹ï¼Œåªæ˜¯å»¶é²åŸ·è¡Œ
2. **æ¢ä»¶æ€§**ï¼šåªåœ¨éœ€è¦æ™‚æ‰å¡ä½æµç¨‹
3. **æ™‚é–“ç²¾ç¢º**ï¼šå»¶é²æ™‚é–“èˆ‡è¡¨æ¼”æ™‚é•·åŒ¹é…
4. **å‘ä¸‹ç›¸å®¹**ï¼šä¸å½±éŸ¿ballCount < 6çš„æƒ…æ³

## 6. åˆ†æ•¸çƒè¡¨æ¼”çš„å¯¦ä½œåŸç†

### 6.1 ç¬¦è™Ÿè¦†è“‹æ©Ÿåˆ¶

#### é‡è¦æ¦‚å¿µï¼š
å°ˆæ¡ˆä½¿ç”¨ã€Œç¬¦è™Ÿè¦†è“‹ã€è€Œéã€Œç¬¦è™Ÿæ›¿æ›ã€ï¼š
- åŸæœ‰ç›¤é¢çš„symbolä¿æŒä¸è®Š
- SymbolFXå¾å°è±¡æ± ä¸­å–å‡ºï¼Œè¦†è“‹åœ¨åŸsymbolä¸Šæ–¹
- è¡¨æ¼”å®Œæˆå¾ŒSymbolFXå›æ”¶ï¼ŒåŸsymbolé‡æ–°é¡¯ç¤º

#### æŠ€è¡“å¯¦ä½œï¼š
```typescript
// å¾å°è±¡æ± ç²å–SymbolFXå°è±¡
let anim: SymbolFX = self.animManager.pool.get(poolKey);

// è¨­å®šä½ç½®ï¼ˆè¦†è“‹åœ¨åŸsymbolä¸Šæ–¹ï¼‰
anim.node.setWorldPosition(self.getSymbolPosition(symbolInfo.x, symbolInfo.y));

// è¨­å®šç¬¦è™Ÿä¿¡æ¯ï¼ˆåŒ…å«åˆ†æ•¸ç­‰è³‡æ–™ï¼‰
anim.setInfo(symbolInfo.sid, featureInfo);

// å•Ÿå‹•ä¸¦æ’­æ”¾è¡¨æ¼”
anim.node.active = true;
anim.play(SymbolPerformType.BEFORE_COLLECT);
```

### 6.2 å‹•ç•«è¨­è¨ˆæ€è·¯

#### ç¸®æ”¾å‹•ç•«å¯¦ä½œï¼š
```typescript
// å„²å­˜åŸå§‹ç¸®æ”¾æ¯”ä¾‹
const originalScale = this.content.node.scale.clone();
const targetScale = new Vec3(originalScale.x * 1.2, originalScale.y * 1.2, originalScale.z);

// æ’­æ”¾ç¸®æ”¾å‹•ç•«åºåˆ—
this.tempTween = tween(this.content.node)
    .to(0.3, { scale: targetScale })    // 300msæ”¾å¤§åˆ°1.2å€
    .to(0.3, { scale: originalScale })  // 300msç¸®å°å›åŸç‹€
    .to(0.3, { scale: targetScale })    // 300mså†æ¬¡æ”¾å¤§
    .to(0.3, { scale: originalScale })  // 300msæœ€çµ‚æ¢å¾©
    .call(() => {
        this.onEffectFinished();        // ç¸½è¨ˆ1200msï¼Œé€šçŸ¥å®Œæˆ
    })
    .start();
```

#### è¨­è¨ˆè€ƒé‡ï¼š
- **è¦–è¦ºæ•ˆæœ**ï¼šé›™æ¬¡ç¸®æ”¾å¢å¼·æ³¨æ„åŠ›å¸å¼•
- **æ™‚é–“æ§åˆ¶**ï¼šç¸½æ™‚é•·1200msé…åˆæµç¨‹å»¶é²
- **è³‡æºç®¡ç†**ï¼šå®Œæˆå¾Œæ­£ç¢ºå›æ”¶Tweenå°è±¡
- **è·³éæ”¯æ´**ï¼šæä¾›onSkip()æ–¹æ³•æ”¯æ´åŠ é€Ÿ

### 6.3 åˆ†æ•¸é¡¯ç¤ºè™•ç†

```typescript
if (this.content.labelText) {
    // æ ¹æ“šæ¸ é“é¡å‹é¸æ“‡å­—é«”
    this.content.labelText.font = this.content.isSpecialFont
        ? this.content.specialFont
        : this.content.baseFont;
    
    // æ ¹æ“šæ¸ é“é¡å‹æ ¼å¼åŒ–æ•¸å­—é¡¯ç¤º
    this.content.labelText.string = this.content.isOmniChannel
        ? String(this.content.credit)  // å…¨æ¸ é“ï¼šç›´æ¥é¡¯ç¤ºæ•¸å­—
        : String(BalanceUtil.formatBalanceWithExpressingUnits(this.content.credit)); // ä¸€èˆ¬æ¸ é“ï¼šæ ¼å¼åŒ–é¡¯ç¤º
}
```

**å­¸ç¿’é‡é»**ï¼š
- å°ˆæ¡ˆæ”¯æ´å¤šæ¸ é“é¡¯ç¤ºæ¨¡å¼
- ä¸åŒæ¸ é“æœ‰ä¸åŒçš„æ•¸å­—æ ¼å¼åŒ–éœ€æ±‚
- å­—é«”é¸æ“‡ä¹Ÿæœƒæ ¹æ“šç‰¹æ®Šæƒ…æ³èª¿æ•´

## 7. é—œéµæŠ€è¡“é»æ·±åº¦è§£æ

### 7.1 å°è±¡æ± (Pool)æ¨¡å¼çš„æ‡‰ç”¨

#### ç‚ºä»€éº¼ä½¿ç”¨å°è±¡æ± ï¼Ÿ
1. **æ€§èƒ½è€ƒé‡**ï¼šé¿å…é »ç¹å‰µå»º/éŠ·æ¯€SymbolFXå°è±¡
2. **è¨˜æ†¶é«”ç®¡ç†**ï¼šå¾©ç”¨å°è±¡ï¼Œæ¸›å°‘GCå£“åŠ›
3. **ä½ç½®ç®¡ç†**ï¼špoolKeyç¢ºä¿æ¯å€‹ç›¤é¢ä½ç½®æœ‰å°æ‡‰çš„ç‰¹æ•ˆå°è±¡

#### å°è±¡æ± ç´¢å¼•è¨ˆç®—ï¼š
```typescript
// 5x3ç›¤é¢çš„ç´¢å¼•è¨ˆç®—
let poolKey: number = symbolInfo.y * 5 + symbolInfo.x;

// ç¯„ä¾‹ï¼š
// ä½ç½®(0,0) â†’ poolKey = 0*5 + 0 = 0
// ä½ç½®(1,2) â†’ poolKey = 2*5 + 1 = 11
// ä½ç½®(4,2) â†’ poolKey = 2*5 + 4 = 14
```

### 7.2 äº‹ä»¶é©…å‹•æ¶æ§‹çš„å„ªå‹¢

#### è§£è€¦åˆè¨­è¨ˆï¼š
- Commandè² è²¬æ¥­å‹™é‚è¼¯åˆ¤æ–·
- Mediatorè² è²¬è¦–åœ–å±¤è¡¨æ¼”
- å…©è€…é€šéäº‹ä»¶é€šä¿¡ï¼Œç›¸äº’ç¨ç«‹

#### æ“´å±•æ€§è€ƒé‡ï¼š
- æ–°å¢äº‹ä»¶é¡å‹ä¸å½±éŸ¿ç¾æœ‰çµ„ä»¶
- å¯ä»¥æœ‰å¤šå€‹Mediatorç›£è½åŒä¸€äº‹ä»¶
- ä¾¿æ–¼æ·»åŠ èª¿è©¦å’Œæ—¥èªŒåŠŸèƒ½

### 7.3 ç‹€æ…‹æ©Ÿæ¨¡å¼çš„é‹ç”¨

#### UIViewStateBaseåŸºé¡è¨­è¨ˆï¼š
```typescript
export abstract class UIViewStateBase {
    public abstract effectId: number;  // ç‹€æ…‹æ¨™è­˜
    
    abstract onPlay(): void;    // æ’­æ”¾é‚è¼¯
    abstract onSkip(): void;    // è·³éé‚è¼¯
    
    protected onEffectFinished(): void {
        // é€šçŸ¥ç‹€æ…‹æ©Ÿè¡¨æ¼”å®Œæˆ
    }
}
```

#### ç‹€æ…‹è¨»å†Šèˆ‡ç®¡ç†ï¼š
```typescript
// æ ¹æ“šç¬¦è™Ÿé¡å‹è¨»å†Šä¸åŒçš„ç‹€æ…‹
switch (this.content.symbolType) {
    case SymbolId.C1:
        this.registerState(new SymbolFXShowState(this.content));
        this.registerState(new SymbolFXBaseCreditUpdateState(this.content));
        this.registerState(new SymbolFXBeforeCollectState(this.content)); // æ–°å¢
        break;
}
```

## 8. å­¸ç¿’é‡é»èˆ‡æŠ€è¡“æ”¶ç©«

### 8.1 å°ˆæ¡ˆæ¶æ§‹æ·±åº¦ç†è§£

#### å¤šå±¤æ¶æ§‹è¨­è¨ˆï¼š
- **Command Layer**ï¼šæ¥­å‹™é‚è¼¯æ§åˆ¶
- **Mediator Layer**ï¼šè¦–åœ–äº‹ä»¶è™•ç†  
- **View Layer**ï¼šå…·é«”çš„è¦–è¦ºè¡¨ç¾
- **Data Layer**ï¼šéŠæˆ²æ•¸æ“šç®¡ç†

#### çµ„ä»¶è·è²¬åˆ†å·¥ï¼š
- **SymbolPerformType**ï¼šç‹€æ…‹å®šç¾©
- **SymbolFXState**ï¼šè¡¨æ¼”å¯¦ä½œ
- **ReelViewMediator**ï¼šäº‹ä»¶å”èª¿
- **GAME_ReelView**ï¼šè¦–åœ–æ“ä½œ

### 8.2 è¨­è¨ˆæ¨¡å¼çš„å¯¦éš›æ‡‰ç”¨

#### ç‹€æ…‹æ¨¡å¼ (State Pattern)ï¼š
- æ¯å€‹SymbolFXç‹€æ…‹éƒ½æ˜¯ç¨ç«‹çš„é¡åˆ¥
- æ”¯æ´ç‹€æ…‹é–“çš„åˆ‡æ›å’Œç®¡ç†
- ä¾¿æ–¼æ·»åŠ æ–°çš„è¡¨æ¼”é¡å‹

#### å°è±¡æ± æ¨¡å¼ (Object Pool Pattern)ï¼š
- é å…ˆå‰µå»ºSymbolFXå°è±¡é¿å…é‹è¡Œæ™‚é–‹éŠ·
- é€šépoolKeyç´¢å¼•å¿«é€Ÿç²å–å°è±¡
- è‡ªå‹•ç®¡ç†å°è±¡çš„ç”Ÿå‘½é€±æœŸ

#### è§€å¯Ÿè€…æ¨¡å¼ (Observer Pattern)ï¼š
- äº‹ä»¶ç³»çµ±å¯¦ç¾çµ„ä»¶é–“çš„é¬†è€¦åˆé€šä¿¡
- Commandç™¼é€é€šçŸ¥ï¼ŒMediatoræ¥æ”¶è™•ç†
- æ”¯æ´ä¸€å°å¤šçš„äº‹ä»¶è¨‚é–±

### 8.3 Cocos Creatoré–‹ç™¼æŠ€å·§

#### Tweenå‹•ç•«ç³»çµ±ï¼š
```typescript
// éˆå¼èª¿ç”¨å‰µå»ºè¤‡é›œå‹•ç•«åºåˆ—
tween(node)
    .to(duration, properties)
    .delay(time)
    .call(callback)
    .start();
```

#### åº§æ¨™ç³»çµ±ç®¡ç†ï¼š
```typescript
// ä¸–ç•Œåº§æ¨™ vs æœ¬åœ°åº§æ¨™
anim.node.setWorldPosition(worldPos);  // è¨­å®šä¸–ç•Œåº§æ¨™
anim.node.setPosition(localPos);       // è¨­å®šæœ¬åœ°åº§æ¨™
```

#### ç¯€é»ç”Ÿå‘½é€±æœŸï¼š
```typescript
// æ­£ç¢ºçš„æ¿€æ´»/åœç”¨é †åº
anim.node.active = true;   // æ¿€æ´»ç¯€é»
anim.play(effectType);     // æ’­æ”¾å‹•ç•«
// ... å‹•ç•«å®Œæˆå¾Œè‡ªå‹•è™•ç†å›æ”¶
```

### 8.4 éŠæˆ²é–‹ç™¼æœ€ä½³å¯¦è¸

#### æ™‚é–“åŒæ­¥è¨­è¨ˆï¼š
- è¡¨æ¼”æ™‚é–“(1200ms) = å»¶é²æ™‚é–“(1200ms)
- ç¢ºä¿è¡¨æ¼”å®Œæˆèˆ‡æµç¨‹æ¢å¾©çš„ç²¾ç¢ºåŒæ­¥
- æä¾›è·³éåŠŸèƒ½æ‡‰å°å¿«é€Ÿæ“ä½œéœ€æ±‚

#### æ¢ä»¶åˆ¤æ–·ç­–ç•¥ï¼š
- åªåœ¨å¿…è¦æ™‚åŸ·è¡Œè¡¨æ¼”é‚è¼¯
- ä¿æŒåŸæœ‰æµç¨‹çš„ç©©å®šæ€§
- æ”¯æ´å¤šç¨®éŠæˆ²æ¨¡å¼çš„å…¼å®¹

#### è³‡æºç®¡ç†åŸå‰‡ï¼š
- åŠæ™‚æ¸…ç†Tweenå°è±¡é¿å…è¨˜æ†¶é«”æ´©æ¼
- åˆç†ä½¿ç”¨å°è±¡æ± æå‡æ€§èƒ½
- æ­£ç¢ºè™•ç†ç•°å¸¸æƒ…æ³å’Œé‚Šç•Œæ¢ä»¶

## 9. å¯èƒ½çš„æ“´å±•èˆ‡å„ªåŒ–æ–¹å‘

### 9.1 è¡¨æ¼”æ•ˆæœå¢å¼·

#### å¤šæ¨£åŒ–å‹•ç•«æ•ˆæœï¼š
- æ—‹è½‰å‹•ç•«ï¼š`tween().by(duration, { angle: 360 })`
- å½ˆè·³æ•ˆæœï¼šä½¿ç”¨ç·©å‹•å‡½æ•¸`easing.bounceOut()`
- ç²’å­ç‰¹æ•ˆï¼šæ•´åˆParticle System

#### éŸ³æ•ˆåŒæ­¥ï¼š
```typescript
onPlay() {
    // æ’­æ”¾éŸ³æ•ˆ
    AudioManager.Instance.play(AudioClipsEnum.Ball_Highlight);
    
    // å‹•ç•«èˆ‡éŸ³æ•ˆåŒæ­¥
    this.tempTween = tween(this.content.node)
        .to(0.3, { scale: targetScale })
        .call(() => {
            AudioManager.Instance.play(AudioClipsEnum.Ball_Scale);
        })
        .to(0.3, { scale: originalScale })
        .start();
}
```

### 9.2 æ€§èƒ½å„ªåŒ–ç­–ç•¥

#### æ‰¹é‡è™•ç†å„ªåŒ–ï¼š
```typescript
// å°‡æ‰€æœ‰åˆ†æ•¸çƒçš„è¡¨æ¼”åˆä½µç‚ºä¸€å€‹Timeline
protected playBeforeCollectBallAnimation() {
    let animPromises = [];
    
    for (let x = 0; x < ballHitInfo.ballScreenLabel.length; x++) {
        for (let y = 0; y < ballHitInfo.ballScreenLabel[x].length; y++) {
            if (ballHitInfo.ballScreenLabel[x][y] > 0) {
                animPromises.push(this.playBallAnimation(x, y));
            }
        }
    }
    
    // æ‰€æœ‰å‹•ç•«å®Œæˆå¾Œçµ±ä¸€é€šçŸ¥
    Promise.all(animPromises).then(() => {
        this.onAllAnimationsComplete();
    });
}
```

#### æ™‚é–“æ§åˆ¶ç²¾ç¢ºåŒ–ï¼š
```typescript
// ä½¿ç”¨GlobalTimeræ›¿ä»£setTimeoutç²å¾—æ›´ç²¾ç¢ºçš„æ§åˆ¶
GlobalTimer.getInstance().registerTimer('beforeCollectDelay', 1.2, () => {
    this.sendNotification(ViewMediatorEvent.PREPARE_COLLECT_BALL);
    this.endGame1FeatureSelection();
}, this).start();
```

### 9.3 ç”¨æˆ¶é«”é©—æ”¹å–„

#### åŠ é€Ÿè·³éåŠŸèƒ½ï¼š
```typescript
// ç›£è½ç”¨æˆ¶æ“ä½œè·³éè¡¨æ¼”
public onUserSkipRequested() {
    // ç«‹å³åœæ­¢æ‰€æœ‰è¡¨æ¼”
    this.skipAllBallAnimations();
    
    // ç«‹å³åŸ·è¡Œå¾ŒçºŒæµç¨‹
    this.sendNotification(ViewMediatorEvent.PREPARE_COLLECT_BALL);
    this.endGame1FeatureSelection();
}
```

#### è¦–è¦ºå›é¥‹å¢å¼·ï¼š
```typescript
// æ·»åŠ è¡¨æ¼”é€²åº¦æç¤º
onPlay() {
    // é¡¯ç¤ºé€²åº¦æ¢æˆ–è¨ˆæ•¸å™¨
    this.showProgressIndicator(1200); // é¡¯ç¤º1.2ç§’çš„é€²åº¦
    
    // åŸæœ‰å‹•ç•«é‚è¼¯...
}
```

## 10. æ¸¬è©¦èˆ‡é©—è­‰æ–¹æ¡ˆ

### 10.1 åŠŸèƒ½æ¸¬è©¦checklist

- [ ] ballCount < 6æ™‚æµç¨‹æ­£å¸¸ï¼ˆç„¡è¡¨æ¼”ï¼‰
- [ ] ballCount >= 6æ™‚æ­£ç¢ºè§¸ç™¼è¡¨æ¼”
- [ ] è¡¨æ¼”å‹•ç•«æ•ˆæœç¬¦åˆé æœŸ
- [ ] è¡¨æ¼”å®Œæˆå¾Œæ”¶é›†æµç¨‹æ­£å¸¸ç¹¼çºŒ
- [ ] è·³éåŠŸèƒ½æ­£å¸¸å·¥ä½œ
- [ ] ä¸åŒåˆ†æ•¸å€¼çš„é¡¯ç¤ºæ­£ç¢º

### 10.2 é‚Šç•Œæ¢ä»¶æ¸¬è©¦

- [ ] ballCount = 6çš„é‚Šç•Œæƒ…æ³
- [ ] æ¥µå¤§ballCountå€¼çš„è™•ç†
- [ ] å¿«é€Ÿé€£çºŒæ“ä½œçš„ç©©å®šæ€§
- [ ] è¨˜æ†¶é«”ä½¿ç”¨æƒ…æ³ç›£æ§

### 10.3 å…¼å®¹æ€§æ¸¬è©¦

- [ ] ä¸åŒè£ç½®å‹è™Ÿçš„è¡¨ç¾
- [ ] ä¸åŒè§£æåº¦ä¸‹çš„é¡¯ç¤ºæ•ˆæœ
- [ ] èˆ‡ç¾æœ‰åŠŸèƒ½çš„äº¤äº’æ­£å¸¸

## ç¸½çµ

é¡Œç›®äºŒçš„å¯¦ä½œé«”ç¾äº†ç¾ä»£éŠæˆ²é–‹ç™¼ä¸­çš„å¹¾å€‹é‡è¦æ¦‚å¿µï¼š

1. **æ¨¡çµ„åŒ–è¨­è¨ˆ**ï¼šæ¯å€‹çµ„ä»¶è·è²¬æ˜ç¢ºï¼Œç›¸äº’ç¨ç«‹
2. **äº‹ä»¶é©…å‹•**ï¼šé€šéäº‹ä»¶å¯¦ç¾é¬†è€¦åˆçš„çµ„ä»¶é€šä¿¡  
3. **ç‹€æ…‹ç®¡ç†**ï¼šä½¿ç”¨ç‹€æ…‹æ¨¡å¼ç®¡ç†è¤‡é›œçš„è¡¨æ¼”é‚è¼¯
4. **æ€§èƒ½å„ªåŒ–**ï¼šå°è±¡æ± ã€è³‡æºå¾©ç”¨ç­‰æŠ€è¡“çš„æ‡‰ç”¨
5. **ç”¨æˆ¶é«”é©—**ï¼šå¹³æ»‘çš„å‹•ç•«éæ¸¡å’Œè·³éåŠŸèƒ½

é€šéé€™å€‹ç·´ç¿’ï¼Œæ‚¨å¯ä»¥æ·±å…¥äº†è§£ä¸€å€‹æˆç†Ÿçš„éŠæˆ²å°ˆæ¡ˆæ˜¯å¦‚ä½•çµ„ç¹”ä»£ç¢¼ã€ç®¡ç†ç‹€æ…‹ã€è™•ç†ç”¨æˆ¶äº¤äº’çš„ã€‚é€™äº›çŸ¥è­˜ä¸åƒ…é©ç”¨æ–¼Cocos Creatoré–‹ç™¼ï¼Œä¹Ÿæ˜¯é€šç”¨çš„è»Ÿé«”å·¥ç¨‹æœ€ä½³å¯¦è¸ã€‚

---

# ç·´ç¿’2 ç¬¬ä¸‰é¡Œå¯¦ä½œæŒ‡å—

## é¡Œç›®æè¿°
ç·´ç¿’ä½¿ç”¨TimeLineToolSceneå ´æ™¯ä¾†æ¸¬è©¦å‹•ç•«æ’­æ”¾ï¼Œè‡ªå·±è£½ä½œä¸€å€‹prefabï¼ŒprefabåŒ…å«å…©å€‹å­ç‰©ä»¶ï¼Œä¸€å€‹ç”¨ä¾†æ’­æ”¾åºåˆ—åœ–å‹•ç•«ï¼Œä¸€å€‹ç”¨ä¾†æ’­æ”¾Spineå‹•ç•«ï¼Œé€éTimeLineToolSceneä¾†æ’­æ”¾é€™å€‹ç‰©ä»¶ä¸Šçš„å…©çµ„å‹•ç•«ã€‚

## 1. å¯¦ä½œå‰çš„ç†è§£

### 1.1 é¡Œç›®æ ¸å¿ƒè¦æ±‚
- **è£½ä½œæ¸¬è©¦ç”¨ Prefab**ï¼šåŒ…å« TimelineTool çµ„ä»¶çš„é è£½ä»¶
- **å…©ç¨®å‹•ç•«é¡å‹**ï¼šSpineå‹•ç•«ï¼ˆéª¨éª¼å‹•ç•«ï¼‰+ åºåˆ—åœ–å‹•ç•«ï¼ˆå¹€å‹•ç•«ï¼‰
- **ä½¿ç”¨ TimelineToolScene**ï¼šå°ˆé–€ç”¨æ–¼å‹•ç•«æ¸¬è©¦çš„å ´æ™¯
- **å‹•ç•«æ’­æ”¾æ§åˆ¶**ï¼šé€éå·¥å…·é¢æ¿æ§åˆ¶å‹•ç•«æ’­æ”¾

### 1.2 å‹•ç•«é¡å‹ç†è§£

#### **Spineå‹•ç•« (éª¨éª¼å‹•ç•«)**
- **åŸç†**ï¼šç”¨éª¨éª¼ç³»çµ±æ§åˆ¶åœ–ç‰‡çš„è®Šå½¢ã€æ—‹è½‰ã€ç¸®æ”¾
- **æª”æ¡ˆçµæ§‹**ï¼š`.skel/.json` (éª¨éª¼è³‡æ–™) + `.atlas` (åœ–é›†) + `.png` (è²¼åœ–)
- **ç‰¹é»**ï¼šæª”æ¡ˆå°ï¼Œå‹•ç•«æµæš¢ï¼Œå¯ç¨‹å¼æ§åˆ¶
- **å°ˆæ¡ˆç¯„ä¾‹**ï¼šBigWinæ–‡å­—ç‰¹æ•ˆ (`assets/art/language/en/spine/big-win-show/`)

#### **åºåˆ—åœ–å‹•ç•« (å¹€å‹•ç•«)**
- **åŸç†**ï¼šåƒå¡é€šç‰‡ä¸€æ¨£ï¼Œç”¨å¤šå¼µé€£çºŒéœæ…‹åœ–ç‰‡å¿«é€Ÿæ’­æ”¾
- **æª”æ¡ˆçµæ§‹**ï¼šå¤šå€‹é€£çºŒç·¨è™Ÿçš„ `.png` æª”æ¡ˆ
- **ç‰¹é»**ï¼šæ•ˆæœç²¾ç´°ï¼Œä½†æª”æ¡ˆè¼ƒå¤§
- **å°ˆæ¡ˆç¯„ä¾‹**ï¼šé‡‘é¾é£›èˆ (`assets/art/graphic/sequence/glod-dragon/GoldDragon_00~28.png`)

## 2. TimelineToolScene ç³»çµ±æ¶æ§‹

### 2.1 TimelineTool æ ¸å¿ƒçµ„ä»¶

**æª”æ¡ˆä½ç½®**ï¼š`extensions/timeline-tool/assets/src/timeline-tool/TimelineTool.ts`

#### æ ¸å¿ƒåŠŸèƒ½ï¼š
- **é †åºæ’­æ”¾**ï¼šå¯è¨­å®šå¤šå€‹å‹•ç•«æŒ‰æ™‚é–“é †åºæ’­æ”¾
- **å»¶é²æ§åˆ¶**ï¼šæ¯å€‹å‹•ç•«å¯è¨­å®š `delayTime`
- **å›èª¿æ©Ÿåˆ¶**ï¼šå‹•ç•«çµæŸå¾Œè§¸ç™¼ `callback`
- **æ··åˆæ’­æ”¾**ï¼šå¯åŒæ™‚æ’­æ”¾ Spine + Animation + Particle

#### æ”¯æ´çš„å‹•ç•«é¡å‹ï¼š
```typescript
export enum TimelineType {
    Spine = 0,        // Spineéª¨éª¼å‹•ç•«
    Animation,        // Cocos Creatoråºåˆ—åœ–å‹•ç•«  
    Time             // ç´”æ™‚é–“å»¶é²
}
```

### 2.2 TimelineToolScene æ¸¬è©¦ç’°å¢ƒ

**æª”æ¡ˆä½ç½®**ï¼š`extensions/timeline-tool/assets/scenes/TimelineToolScene.scene`

#### ç‰¹æ€§ï¼š
- **å”¯è®€å ´æ™¯**ï¼šç„¡æ³•å„²å­˜ï¼Œåªèƒ½æ¸¬è©¦
- **è‡ªå‹•åµæ¸¬**ï¼šè‡ªå‹•æƒæ TimelineManager ä¸‹çš„ TimelineTool çµ„ä»¶
- **è¦–è¦ºåŒ–æ§åˆ¶**ï¼šæä¾› UI é¢æ¿é¸æ“‡å’Œæ’­æ”¾å‹•ç•«
- **å³æ™‚æ¸¬è©¦**ï¼šä¿®æ”¹ Prefab å¾Œç«‹å³åæ˜ åˆ°æ¸¬è©¦å ´æ™¯

### 2.3 æ•¸æ“šçµæ§‹è¨­è¨ˆ

#### Timeline è³‡æ–™çµæ§‹ï¼š
```typescript
Timeline {
    timelineName: "å‹•ç•«åç¨±",           // åœ¨UIä¸­é¡¯ç¤ºçš„åç¨±
    timelineData: [                   // å‹•ç•«æ­¥é©Ÿé™£åˆ—
        {
            timelineType: TimelineType.Spine,
            timelineSpine: {
                spine: SpineNode,         // Spineç¯€é»å¼•ç”¨
                spineNameString: "å‹•ç•«å", // è¦æ’­æ”¾çš„å‹•ç•«
                delayTime: 0,            // å»¶é²æ™‚é–“
                isLoop: false            // æ˜¯å¦å¾ªç’°
            }
        },
        {
            timelineType: TimelineType.Animation,
            timelineAnimation: {
                animation: AnimNode,      // Animationç¯€é»å¼•ç”¨
                animationNameString: "clipå", // AnimationClipåç¨±
                delayTime: 0.5           // 0.5ç§’å¾Œæ’­æ”¾
            }
        }
    ]
}
```

## 3. å¯¦ä½œæ­¥é©Ÿè©³è§£

### 3.1 æ­¥é©Ÿä¸€ï¼šå»ºç«‹ Prefab åŸºç¤çµæ§‹

#### å‰µå»º Prefabï¼š
1. åœ¨ `assets/prefabs` è³‡æ–™å¤¾ä¸­å»ºç«‹ Node Prefab
2. å‘½åç‚º `TimelineTestPrefab`
3. é›™æ“Šé€²å…¥ç·¨è¼¯æ¨¡å¼

#### ç¯€é»çµæ§‹è¨­è¨ˆï¼š
```
TimelineTestPrefab (æ ¹ç¯€é» - åŒ…å« TimelineTool çµ„ä»¶)
â”œâ”€â”€ BigWinNode (å­ç¯€é»1 - Spineå‹•ç•«)
â”‚   â””â”€â”€ sp.Skeleton çµ„ä»¶
â””â”€â”€ GoldDragonNode (å­ç¯€é»2 - åºåˆ—åœ–å‹•ç•«)  
    â”œâ”€â”€ Animation çµ„ä»¶
    â””â”€â”€ Sprite çµ„ä»¶
```

### 3.2 æ­¥é©ŸäºŒï¼šé…ç½® Spine å‹•ç•«ç¯€é»

#### å»ºç«‹ BigWinNodeï¼š
1. **å‰µå»ºå­ç¯€é»**ï¼šå³éµæ ¹ç¯€é» â†’ Create â†’ Empty Node â†’ é‡å‘½å `BigWinNode`
2. **æ·»åŠ çµ„ä»¶**ï¼šAdd Component â†’ æœå°‹ `Spine Skeleton`
3. **è¨­å®šè³‡æº**ï¼š
   ```
   Skeleton Data: assets/art/language/en/spine/big-win-show/BigWinShow.skel
   ```
4. **å‹•ç•«é¸é …**ï¼šç³»çµ±æœƒè‡ªå‹•è¼‰å…¥å¯ç”¨å‹•ç•«ï¼ˆBigWin, MegaWin, SuperWin, JumboWinï¼‰

#### Spine å‹•ç•«å„ªå‹¢ï¼š
- **å°ˆæ¥­è£½ä½œ**ï¼šç”±ç¾è¡“åœ˜éšŠä½¿ç”¨ Spine è»Ÿé«”è£½ä½œ
- **å¤šç¨®æ•ˆæœ**ï¼šä¸åŒç­‰ç´šçš„ä¸­çå‹•ç•«
- **å³ç”¨æ€§**ï¼šå°ˆæ¡ˆä¸­å·²æœ‰å®Œæ•´è³‡æº

### 3.3 æ­¥é©Ÿä¸‰ï¼šé…ç½®åºåˆ—åœ–å‹•ç•«ç¯€é»

#### å»ºç«‹ GoldDragonNodeï¼š
1. **å‰µå»ºå­ç¯€é»**ï¼šå³éµæ ¹ç¯€é» â†’ Create â†’ Empty Node â†’ é‡å‘½å `GoldDragonNode`
2. **æ·»åŠ  Animation çµ„ä»¶**ï¼šAdd Component â†’ `Animation`
3. **æ·»åŠ  Sprite çµ„ä»¶**ï¼šAdd Component â†’ `Sprite`

#### å‰µå»º AnimationClipï¼š
1. **åœ¨ Animation ç·¨è¼¯å™¨ä¸­**ï¼šWindow â†’ Animation
2. **å‰µå»ºæ–° Clip**ï¼šé»æ“Š "Create" â†’ å‘½å `GoldDragonSequence`
3. **è¨­å®šåˆå§‹ Sprite Frame**ï¼šæ‹–æ‹½ `GoldDragon_00.png` åˆ° Sprite çµ„ä»¶

#### è£½ä½œåºåˆ—åœ–å‹•ç•«ï¼š
```typescript
// åœ¨ Animation ç·¨è¼¯å™¨ä¸­çš„æ“ä½œæµç¨‹ï¼š
1. æ·»åŠ  Sprite.spriteFrame å±¬æ€§è»Œé“
2. åœ¨æ™‚é–“è»¸ä¸Šæ¯ 0.1 ç§’æ·»åŠ ä¸€å€‹é—œéµå¹€
3. ç‚ºæ¯å€‹é—œéµå¹€è¨­å®šå°æ‡‰çš„åœ–ç‰‡ï¼š
   - 0.0s â†’ GoldDragon_00.png
   - 0.1s â†’ GoldDragon_01.png  
   - 0.2s â†’ GoldDragon_02.png
   // ... ç¸½å…± 29 å¹€
   - 2.8s â†’ GoldDragon_28.png
```

#### åºåˆ—åœ–å‹•ç•«æŠ€è¡“è¦é»ï¼š
- **å¹€é–“éš”æ§åˆ¶**ï¼š0.1ç§’é–“éš”é©åˆæµæš¢æ’­æ”¾
- **å¾ªç’°è¨­å®š**ï¼šå¯è¨­å®šå‹•ç•«æ˜¯å¦å¾ªç’°æ’­æ”¾
- **æ’­æ”¾é€Ÿåº¦**ï¼šé€é Animation çµ„ä»¶çš„ Speed èª¿æ•´

### 3.4 æ­¥é©Ÿå››ï¼šé…ç½® TimelineTool çµ„ä»¶

#### åœ¨æ ¹ç¯€é»æ·»åŠ  TimelineToolï¼š
1. **é¸ä¸­æ ¹ç¯€é»** `TimelineTestPrefab`
2. **Add Component** â†’ æœå°‹ `TimelineTool`
3. **é…ç½® Array Timeline Data**

#### é…ç½®ç¯„ä¾‹1ï¼šé †åºæ’­æ”¾
```typescript
Array Timeline Data[0]:
{
    timelineName: "SequentialPlay",
    timelineData: [
        {
            timelineType: Spine,
            timelineSpine: {
                spine: BigWinNode,
                spineNameString: "BigWin",
                delayTime: 0,
                isLoop: false
            }
        },
        {
            timelineType: Animation,
            timelineAnimation: {
                animation: GoldDragonNode,
                animationNameString: "GoldDragonSequence", 
                delayTime: 0.5  // BigWinæ’­æ”¾0.5ç§’å¾Œé–‹å§‹
            }
        }
    ]
}
```

#### é…ç½®ç¯„ä¾‹2ï¼šåŒæ™‚æ’­æ”¾
```typescript
Array Timeline Data[1]:
{
    timelineName: "SimultaneousPlay",
    timelineData: [
        {
            timelineType: Spine,
            timelineSpine: {
                spine: BigWinNode,
                spineNameString: "MegaWin",
                delayTime: 0
            }
        },
        {
            timelineType: Animation,
            timelineAnimation: {
                animation: GoldDragonNode,
                animationNameString: "GoldDragonSequence",
                delayTime: 0  // åŒæ™‚é–‹å§‹
            }
        }
    ]
}
```

#### é…ç½®ç¯„ä¾‹3ï¼šåˆ†åˆ¥æ¸¬è©¦
```typescript
Array Timeline Data[2]:
{
    timelineName: "TestSpine", 
    timelineData: [
        {
            timelineType: Spine,
            timelineSpine: {
                spine: BigWinNode,
                spineNameString: "SuperWin",
                delayTime: 0
            }
        }
    ]
}

Array Timeline Data[3]:
{
    timelineName: "TestSequence",
    timelineData: [
        {
            timelineType: Animation,
            timelineAnimation: {
                animation: GoldDragonNode,
                animationNameString: "GoldDragonSequence",
                delayTime: 0
            }
        }
    ]
}
```

### 3.5 æ­¥é©Ÿäº”ï¼šTimelineToolScene æ¸¬è©¦

#### æ¸¬è©¦æµç¨‹ï¼š
1. **å„²å­˜ Prefab**ï¼šCtrl + S
2. **æ‰“é–‹æ¸¬è©¦å ´æ™¯**ï¼š`extensions/timeline-tool/assets/scenes/TimelineToolScene.scene`
3. **æ”¾ç½®æ¸¬è©¦ç‰©ä»¶**ï¼šå°‡ `TimelineTestPrefab` æ‹–æ‹½åˆ° `TimelineManager` ç¯€é»ä¸‹
4. **åŸ·è¡Œå ´æ™¯**ï¼šé»æ“Šæ’­æ”¾æŒ‰éˆ• â–¶ï¸
5. **æ¸¬è©¦å‹•ç•«**ï¼šä½¿ç”¨ UI é¢æ¿é¸æ“‡ä¸åŒ Timeline ä¸¦æ’­æ”¾

#### æ¸¬è©¦ç•Œé¢èªªæ˜ï¼š
- **Timeline ä¸‹æ‹‰é¸å–®**ï¼šé¸æ“‡è¦æ’­æ”¾çš„å‹•ç•«åºåˆ—
- **Play æŒ‰éˆ•**ï¼šé–‹å§‹æ’­æ”¾é¸ä¸­çš„ Timeline
- **Stop æŒ‰éˆ•**ï¼šåœæ­¢ç•¶å‰æ’­æ”¾
- **æ¨¡å¼åˆ‡æ›**ï¼šNormalï¼ˆå–®ä¸€æ’­æ”¾ï¼‰/ Tandemï¼ˆä¸²è¯æ’­æ”¾ï¼‰

## 4. é—œéµæŠ€è¡“é»æ·±å…¥è§£æ

### 4.1 Prefab ç³»çµ±çš„å„ªå‹¢

#### ä¸€æ¬¡å‰µå»ºï¼Œå¤šè™•ä½¿ç”¨ï¼š
- **è³‡æºå…±äº«**ï¼šPrefab ä¿®æ”¹æœƒåŒæ­¥åˆ°æ‰€æœ‰ä½¿ç”¨è™•
- **ç‰ˆæœ¬ç®¡ç†**ï¼šä¾¿æ–¼è¿½è¹¤å’Œç®¡ç†å‹•ç•«è³‡æºç‰ˆæœ¬
- **æ¸¬è©¦éš”é›¢**ï¼šåœ¨æ¸¬è©¦å ´æ™¯ä¸­ä¸æœƒå½±éŸ¿ä¸»éŠæˆ²å ´æ™¯

#### Prefab èˆ‡å ´æ™¯çš„é—œä¿‚ï¼š
```
TimelineTestPrefab.prefab (è³‡æºæª”æ¡ˆ)
    â†“
TimelineToolScene ä¸­çš„å¯¦ä¾‹ (æ¸¬è©¦ç”¨)
    â†“  
ä¸»éŠæˆ²å ´æ™¯ä¸­çš„å¯¦ä¾‹ (å¯¦éš›ä½¿ç”¨)
```

### 4.2 Animation ç·¨è¼¯å™¨æ·±åº¦ä½¿ç”¨

#### å±¬æ€§è»Œé“ç®¡ç†ï¼š
- **Add Property**ï¼šç‚ºçµ„ä»¶å±¬æ€§å‰µå»ºå‹•ç•«è»Œé“
- **é—œéµå¹€ç·¨è¼¯**ï¼šç²¾ç¢ºæ§åˆ¶æ¯å¹€çš„å±¬æ€§å€¼
- **æ’å€¼æ¨¡å¼**ï¼šLinearï¼ˆç·šæ€§ï¼‰/ Stepï¼ˆéšæ¢¯ï¼‰æ’å€¼

#### é€²éšæŠ€å·§ï¼š
```typescript
// åºåˆ—åœ–å„ªåŒ–æŠ€å·§
1. ä½¿ç”¨ TexturePacker å°‡å¤šå¼µåœ–ç‰‡æ‰“åŒ…æˆåœ–é›†
2. åˆ©ç”¨ SpriteAtlas æ¸›å°‘ Draw Call
3. è¨­å®šåˆé©çš„ WrapModeï¼ˆOnce/Loop/PingPongï¼‰
```

### 4.3 Timeline ç³»çµ±è¨­è¨ˆæ¨¡å¼

#### çµ„åˆæ¨¡å¼ï¼ˆComposite Patternï¼‰ï¼š
- Timeline å¯åŒ…å«å¤šå€‹ TimelineData
- æ¯å€‹ TimelineData å¯ä»¥æ˜¯ä¸åŒé¡å‹çš„å‹•ç•«
- æ”¯æ´å·¢ç‹€çµæ§‹å’Œè¤‡é›œçµ„åˆ

#### ç­–ç•¥æ¨¡å¼ï¼ˆStrategy Patternï¼‰ï¼š
```typescript
// ä¸åŒå‹•ç•«é¡å‹ä½¿ç”¨ä¸åŒç­–ç•¥
switch (timelineData.timelineType) {
    case TimelineType.Spine:
        this.executeSpineStrategy(timelineData.timelineSpine);
        break;
    case TimelineType.Animation:
        this.executeAnimationStrategy(timelineData.timelineAnimation);
        break;
}
```

## 5. å­¸ç¿’é‡é»èˆ‡æŠ€èƒ½æå‡

### 5.1 Cocos Creator å‹•ç•«ç³»çµ±ç²¾é€š

#### Spine å‹•ç•«æŒæ¡ï¼š
- **è³‡æºç®¡ç†**ï¼šç†è§£ .skel + .atlas + .png ä¸‰ä»¶å¥—
- **å‹•ç•«æ§åˆ¶**ï¼šå­¸æœƒç¨‹å¼åŒ–æ§åˆ¶ Spine å‹•ç•«æ’­æ”¾
- **æ€§èƒ½å„ªåŒ–**ï¼šäº†è§£ Spine å‹•ç•«çš„æ€§èƒ½å„ªå‹¢

#### Animation ç³»çµ±é‹ç”¨ï¼š
- **ç·¨è¼¯å™¨ä½¿ç”¨**ï¼šç†Ÿç·´æ“ä½œ Animation é¢æ¿
- **é—œéµå¹€å‹•ç•«**ï¼šç†è§£è£œé–“å‹•ç•«åŸç†
- **å±¬æ€§å‹•ç•«**ï¼šå­¸æœƒç‚ºä»»æ„å±¬æ€§å‰µå»ºå‹•ç•«

### 5.2 å·¥å…·åŒ–é–‹ç™¼æ€ç¶­

#### æ¸¬è©¦å·¥å…·çš„åƒ¹å€¼ï¼š
- **å¿«é€Ÿé©—è­‰**ï¼šç„¡éœ€é€²å…¥éŠæˆ²ä¸»æµç¨‹å³å¯æ¸¬è©¦å‹•ç•«
- **è¦–è¦ºåŒ–èª¿è©¦**ï¼šç›´è§€çœ‹åˆ°å‹•ç•«æ•ˆæœå’Œæ™‚åº
- **åƒæ•¸èª¿å„ª**ï¼šå¯å¿«é€Ÿèª¿æ•´å»¶é²æ™‚é–“ã€æ’­æ”¾é †åºç­‰

#### å·¥å…·è¨­è¨ˆåŸå‰‡ï¼š
```typescript
// å¥½çš„å·¥å…·æ‡‰è©²å…·å‚™ï¼š
1. æ˜“ç”¨æ€§ï¼šç°¡å–®ç›´è§€çš„æ“ä½œç•Œé¢
2. æ“´å±•æ€§ï¼šå®¹æ˜“æ·»åŠ æ–°çš„å‹•ç•«é¡å‹
3. ç©©å®šæ€§ï¼šä¸æœƒå› ç‚ºæ¸¬è©¦è€Œå½±éŸ¿ä¸»å°ˆæ¡ˆ
4. é«˜æ•ˆæ€§ï¼šå¿«é€Ÿçš„è¼‰å…¥å’Œåˆ‡æ›èƒ½åŠ›
```

### 5.3 å°ˆæ¡ˆæ•´åˆèƒ½åŠ›

#### ç¾æœ‰è³‡æºåˆ©ç”¨ï¼š
- **è³‡æºæœå°‹**ï¼šå­¸æœƒåœ¨å¤§å‹å°ˆæ¡ˆä¸­å¿«é€Ÿæ‰¾åˆ°æ‰€éœ€è³‡æº
- **ç³»çµ±ç†è§£**ï¼šç†è§£å°ˆæ¡ˆæ—¢æœ‰çš„å·¥å…·å’Œæ¡†æ¶
- **æœ€ä½³å¯¦è¸**ï¼šéµå¾ªå°ˆæ¡ˆçš„å‘½åå’Œçµ„ç¹”è¦ç¯„

#### éä¾µå…¥æ€§é–‹ç™¼ï¼š
- **æ¸¬è©¦éš”é›¢**ï¼šæ¸¬è©¦ä»£ç¢¼ä¸å½±éŸ¿ç”Ÿç”¢ä»£ç¢¼
- **è³‡æºå¾©ç”¨**ï¼šå……åˆ†åˆ©ç”¨ç¾æœ‰ç¾è¡“è³‡æº
- **æ¶æ§‹èåˆ**ï¼šæ–°åŠŸèƒ½èˆ‡æ—¢æœ‰ç³»çµ±å’Œè«§å…±å­˜

## 6. é€²éšæ“´å±•èˆ‡å„ªåŒ–

### 6.1 å‹•ç•«æ•ˆæœå¢å¼·

#### è¤‡åˆå‹•ç•«è¨­è¨ˆï¼š
```typescript
// åŒæ™‚æ’­æ”¾å¤šç¨®æ•ˆæœ
{
    timelineType: TimelineType.Spine,
    timelineSpine: {
        spine: BigWinNode,
        spineNameString: "BigWin",
        useAnim: true,           // é™„åŠ  Animation
        animSetupData: {
            animation: backgroundNode,
            animationNameString: "backgroundGlow"
        },
        useParticle: true,       // é™„åŠ ç²’å­æ•ˆæœ
        particleData: [...]
    }
}
```

#### è‡ªå®šç¾©ç·©å‹•å‡½æ•¸ï¼š
```typescript
// ç‚ºå‹•ç•«æ·»åŠ ç·©å‹•æ•ˆæœ
import { easing } from 'cc';

tween(node)
    .to(1.0, { scale: new Vec3(1.2, 1.2, 1.0) }, { 
        easing: easing.elasticOut 
    })
    .start();
```

### 6.2 æ€§èƒ½å„ªåŒ–ç­–ç•¥

#### å°è±¡æ± æ‡‰ç”¨ï¼š
```typescript
// ç‚ºé »ç¹ä½¿ç”¨çš„å‹•ç•«å»ºç«‹å°è±¡æ± 
class AnimationPool {
    private pool: Node[] = [];
    
    public getNode(): Node {
        return this.pool.pop() || this.createNode();
    }
    
    public putNode(node: Node): void {
        node.active = false;
        this.pool.push(node);
    }
}
```

#### è³‡æºé è¼‰å…¥ï¼š
```typescript
// é å…ˆè¼‰å…¥å¸¸ç”¨çš„å‹•ç•«è³‡æº
preloadAnimationAssets() {
    const spineAssets = [
        'BigWinShow',
        'MegaWinShow', 
        'SuperWinShow'
    ];
    
    spineAssets.forEach(asset => {
        resources.preload(asset, sp.SkeletonData);
    });
}
```

### 6.3 èª¿è©¦èˆ‡ç›£æ§å·¥å…·

#### å‹•ç•«ç‹€æ…‹ç›£æ§ï¼š
```typescript
// æ·»åŠ å‹•ç•«æ’­æ”¾ç‹€æ…‹çš„å¯è¦–åŒ–
class AnimationDebugger {
    public showTimelineStatus(timeline: Timeline) {
        console.log(`Timeline: ${timeline.timelineName}`);
        console.log(`Current Step: ${timeline.timelineDataIndex}`);
        console.log(`Is Playing: ${this.isPlaying}`);
    }
}
```

#### æ€§èƒ½åˆ†æï¼š
```typescript
// ç›£æ§å‹•ç•«æ€§èƒ½
class PerformanceMonitor {
    public trackAnimationPerformance(animName: string) {
        const startTime = performance.now();
        
        // å‹•ç•«æ’­æ”¾...
        
        const endTime = performance.now();
        console.log(`Animation ${animName} took ${endTime - startTime}ms`);
    }
}
```

## 7. å¯¦ä½œæª¢æŸ¥æ¸…å–®

### 7.1 åŠŸèƒ½å®Œæ•´æ€§æª¢æŸ¥

- [ ] **Prefab çµæ§‹æ­£ç¢º**ï¼šåŒ…å« TimelineTool + å…©å€‹å­ç¯€é»
- [ ] **Spine å‹•ç•«é…ç½®**ï¼šBigWinNode æ­£ç¢ºè¼‰å…¥ Spine è³‡æº
- [ ] **åºåˆ—åœ–å‹•ç•«é…ç½®**ï¼šGoldDragonNode åŒ…å«å®Œæ•´çš„ 29 å¹€å‹•ç•«
- [ ] **TimelineTool è¨­å®š**ï¼šArray Timeline Data æ­£ç¢ºé…ç½®
- [ ] **æ¸¬è©¦å ´æ™¯é‹è¡Œ**ï¼šåœ¨ TimelineToolScene ä¸­æˆåŠŸæ’­æ”¾

### 7.2 å‹•ç•«æ•ˆæœæª¢æŸ¥

- [ ] **Spine å‹•ç•«æ’­æ”¾**ï¼šBigWin æ–‡å­—ç‰¹æ•ˆæ­£å¸¸é¡¯ç¤º
- [ ] **åºåˆ—åœ–å‹•ç•«æ’­æ”¾**ï¼šé‡‘é¾é£›èˆå‹•ç•«æµæš¢æ’­æ”¾
- [ ] **æ™‚åºæ§åˆ¶**ï¼šå»¶é²æ™‚é–“è¨­å®šæ­£ç¢ºç”Ÿæ•ˆ
- [ ] **å¤šç¨®æ¨¡å¼**ï¼šé †åºæ’­æ”¾ã€åŒæ™‚æ’­æ”¾ã€åˆ†åˆ¥æ¸¬è©¦éƒ½æ­£å¸¸

### 7.3 æŠ€è¡“å¯¦ç¾æª¢æŸ¥

- [ ] **è³‡æºå¼•ç”¨æ­£ç¢º**ï¼šæ‰€æœ‰ç¯€é»å¼•ç”¨å’Œè³‡æºè·¯å¾‘ç„¡èª¤
- [ ] **çµ„ä»¶é…ç½®å®Œæ•´**ï¼šæ‰€æœ‰å¿…è¦çµ„ä»¶éƒ½å·²æ­£ç¢ºæ·»åŠ 
- [ ] **å‹•ç•«åƒæ•¸åˆç†**ï¼šæ’­æ”¾æ™‚é–“ã€å¾ªç’°è¨­å®šç­‰ç¬¦åˆé æœŸ
- [ ] **éŒ¯èª¤è™•ç†**ï¼šç„¡ Console éŒ¯èª¤å’Œè­¦å‘Šè¨Šæ¯

## 8. æ•…éšœæ’é™¤æŒ‡å—

### 8.1 å¸¸è¦‹å•é¡Œè§£æ±º

#### Spine å‹•ç•«ä¸é¡¯ç¤ºï¼š
```typescript
// æª¢æŸ¥é …ç›®ï¼š
1. ç¢ºèª .skelã€.atlasã€.png ä¸‰å€‹æª”æ¡ˆéƒ½æ­£ç¢ºå°å…¥
2. æª¢æŸ¥ Skeleton Data æ¬„ä½æ˜¯å¦æ­£ç¢ºè¨­å®š
3. é©—è­‰å‹•ç•«åç¨±æ˜¯å¦å­˜åœ¨æ–¼ä¸‹æ‹‰é¸å–®ä¸­
4. ç¢ºä¿ç¯€é»çš„ active ç‹€æ…‹ç‚º true
```

#### åºåˆ—åœ–å‹•ç•«ä¸æ’­æ”¾ï¼š
```typescript
// æª¢æŸ¥é …ç›®ï¼š
1. Animation çµ„ä»¶æ˜¯å¦æ­£ç¢ºæ·»åŠ  AnimationClip
2. Sprite çµ„ä»¶æ˜¯å¦å·²æ·»åŠ ä¸¦è¨­å®šåˆå§‹ SpriteFrame
3. Animation è»Œé“æ˜¯å¦æ­£ç¢ºæ·»åŠ  cc.Sprite.spriteFrame å±¬æ€§
4. æ‰€æœ‰ GoldDragon_XX.png åœ–ç‰‡æ˜¯å¦éƒ½å·²è¨­å®š
```

#### TimelineToolScene ç„¡æ³•æ’­æ”¾ï¼š
```typescript
// æª¢æŸ¥é …ç›®ï¼š
1. Prefab æ˜¯å¦æ­£ç¢ºæ‹–æ‹½åˆ° TimelineManager ä¸‹
2. TimelineTool çµ„ä»¶æ˜¯å¦æ­£ç¢ºé…ç½®
3. Array Timeline Data æ˜¯å¦åŒ…å«æœ‰æ•ˆæ•¸æ“š
4. ç¯€é»å¼•ç”¨æ˜¯å¦æ­£ç¢ºï¼ˆä¸æ˜¯ç©ºå¼•ç”¨ï¼‰
```

### 8.2 æ€§èƒ½å•é¡Œè§£æ±º

#### å‹•ç•«å¡é “ï¼š
- **æ¸›å°‘åºåˆ—åœ–è§£æåº¦**ï¼šä½¿ç”¨é©ç•¶å¤§å°çš„åœ–ç‰‡
- **å„ªåŒ–åœ–ç‰‡æ ¼å¼**ï¼šä½¿ç”¨å£“ç¸®æ ¼å¼æ¸›å°‘è¨˜æ†¶é«”ä½¿ç”¨
- **æ§åˆ¶åŒæ™‚æ’­æ”¾æ•¸é‡**ï¼šé¿å…åŒæ™‚æ’­æ”¾éå¤šå‹•ç•«

#### è¼‰å…¥æ™‚é–“éé•·ï¼š
- **è³‡æºé è¼‰å…¥**ï¼šæå‰è¼‰å…¥å¸¸ç”¨å‹•ç•«è³‡æº
- **åœ–é›†å„ªåŒ–**ï¼šä½¿ç”¨ TexturePacker åˆä½µå°åœ–
- **åˆ†æ‰¹è¼‰å…¥**ï¼šå¤§å‹å‹•ç•«è³‡æºåˆ†æ‰¹è¼‰å…¥

## 9. å­¸ç¿’æˆæœèˆ‡æŠ€èƒ½æå‡

### 9.1 æ ¸å¿ƒæŠ€èƒ½ç¿’å¾—

#### Cocos Creator å‹•ç•«é–‹ç™¼ï¼š
- âœ… **Spine å‹•ç•«ç³»çµ±**ï¼šå¾è³‡æºç®¡ç†åˆ°ç¨‹å¼æ§åˆ¶çš„å®Œæ•´æŒæ¡
- âœ… **Animation ç³»çµ±**ï¼šåºåˆ—åœ–å‹•ç•«çš„è£½ä½œå’Œå„ªåŒ–æŠ€å·§
- âœ… **Timeline å·¥å…·**ï¼šè¤‡é›œå‹•ç•«åºåˆ—çš„è¨­è¨ˆå’Œç®¡ç†

#### å·¥å…·åŒ–é–‹ç™¼èƒ½åŠ›ï¼š
- âœ… **æ¸¬è©¦å·¥å…·ä½¿ç”¨**ï¼šå­¸æœƒä½¿ç”¨å°ˆæ¥­çš„å‹•ç•«æ¸¬è©¦å·¥å…·
- âœ… **è³‡æºç®¡ç†**ï¼šå¤§å‹å°ˆæ¡ˆä¸­çš„è³‡æºæœå°‹å’Œçµ„ç¹”èƒ½åŠ›
- âœ… **èª¿è©¦æŠ€å·§**ï¼šå‹•ç•«å•é¡Œçš„è¨ºæ–·å’Œè§£æ±ºæ–¹æ³•

### 9.2 è»Ÿé«”å·¥ç¨‹æ€ç¶­

#### æ¶æ§‹è¨­è¨ˆç†è§£ï¼š
- **çµ„ä»¶åŒ–è¨­è¨ˆ**ï¼šç†è§£ Prefab ç³»çµ±çš„æ¨¡çµ„åŒ–å„ªå‹¢
- **å·¥å…·é©…å‹•é–‹ç™¼**ï¼šé«”é©—å°ˆæ¥­éŠæˆ²é–‹ç™¼ä¸­çš„å·¥å…·éˆä½¿ç”¨
- **æ¸¬è©¦åˆ†é›¢**ï¼šå­¸æœƒå°‡æ¸¬è©¦é‚è¼¯èˆ‡ç”Ÿç”¢é‚è¼¯åˆ†é›¢

#### æœ€ä½³å¯¦è¸æ‡‰ç”¨ï¼š
- **ä»£ç¢¼å¾©ç”¨**ï¼šå……åˆ†åˆ©ç”¨ç¾æœ‰ç³»çµ±å’Œè³‡æº
- **éä¾µå…¥æ€§é–‹ç™¼**ï¼šåœ¨ä¸ç ´å£æ—¢æœ‰æ¶æ§‹ä¸‹æ·»åŠ æ–°åŠŸèƒ½
- **æ–‡æª”åŒ–æ€ç¶­**ï¼šç†è§£æŠ€è¡“æ–‡æª”å°å­¸ç¿’å’Œé–‹ç™¼çš„é‡è¦æ€§

### 9.3 éŠæˆ²é–‹ç™¼å°ˆæ¥­èƒ½åŠ›

#### å‹•ç•«è£½ä½œæµç¨‹ï¼š
```
ç¾è¡“è£½ä½œ â†’ è³‡æºå°å…¥ â†’ å‹•ç•«é…ç½® â†’ ç¨‹å¼æ•´åˆ â†’ æ¸¬è©¦é©—è­‰ â†’ æ•ˆæœå„ªåŒ–
    â†“         â†“         â†“         â†“         â†“         â†“
  Spineè»Ÿé«”   Cocos Creator  Animationç·¨è¼¯å™¨  TimelineTool  æ¸¬è©¦å ´æ™¯   æ€§èƒ½èª¿å„ª
```

#### è·¨é ˜åŸŸå”ä½œï¼š
- **èˆ‡ç¾è¡“åˆä½œ**ï¼šç†è§£ç¾è¡“è³‡æºçš„è£½ä½œæµç¨‹å’ŒæŠ€è¡“é™åˆ¶
- **å·¥å…·éˆä½¿ç”¨**ï¼šç†Ÿæ‚‰å°ˆæ¥­éŠæˆ²é–‹ç™¼ä¸­çš„å„ç¨®å·¥å…·
- **å“è³ªæ§åˆ¶**ï¼šæŒæ¡å‹•ç•«å“è³ªè©•ä¼°å’Œå„ªåŒ–æ–¹æ³•

## 10. å»¶ä¼¸å­¸ç¿’å»ºè­°

### 10.1 æ·±å…¥å­¸ç¿’æ–¹å‘

#### Spine é€²éšæ‡‰ç”¨ï¼š
- **éª¨éª¼å‹•ç•«è£½ä½œ**ï¼šå­¸ç¿’ä½¿ç”¨ Spine è»Ÿé«”è£½ä½œå‹•ç•«
- **æ··åˆæ¨¡å¼**ï¼šç ”ç©¶ä¸åŒå‹•ç•«é–“çš„éæ¸¡å’Œæ··åˆ
- **äº‹ä»¶è§¸ç™¼**ï¼šåˆ©ç”¨ Spine äº‹ä»¶ç³»çµ±å¯¦ç¾è¤‡é›œäº¤äº’

#### Animation ç³»çµ±æ“´å±•ï¼š
- **æ›²ç·šç·¨è¼¯**ï¼šæ·±å…¥äº†è§£å‹•ç•«æ›²ç·šå’Œç·©å‹•å‡½æ•¸
- **ç‰©ç†å‹•ç•«**ï¼šçµåˆç‰©ç†ç³»çµ±è£½ä½œæ›´çœŸå¯¦çš„å‹•ç•«
- **ç¨‹åºå‹•ç•«**ï¼šä½¿ç”¨ä»£ç¢¼å‹•æ…‹ç”Ÿæˆå‹•ç•«æ•ˆæœ

### 10.2 ç›¸é—œæŠ€è¡“å­¸ç¿’

#### å‹•ç•«æ•¸å­¸åŸºç¤ï¼š
- **æ’å€¼ç®—æ³•**ï¼šç·šæ€§æ’å€¼ã€è²å¡çˆ¾æ›²ç·šã€æ¨£æ¢æ’å€¼
- **è®Šæ›çŸ©é™£**ï¼š2D/3D è®Šæ›çš„æ•¸å­¸åŸç†
- **æ™‚é–“å‡½æ•¸**ï¼šç·©å‹•å‡½æ•¸çš„æ•¸å­¸å¯¦ç¾

#### éŠæˆ²å¼•æ“æ·±åº¦ä½¿ç”¨ï¼š
- **æ¸²æŸ“ç®¡ç·š**ï¼šç†è§£å‹•ç•«æ¸²æŸ“çš„åº•å±¤æ©Ÿåˆ¶
- **æ€§èƒ½åˆ†æ**ï¼šä½¿ç”¨ Profiler å·¥å…·åˆ†æå‹•ç•«æ€§èƒ½
- **è¨˜æ†¶é«”ç®¡ç†**ï¼šå‹•ç•«è³‡æºçš„è¼‰å…¥å’Œå¸è¼‰ç­–ç•¥

## ç¸½çµ

ç·´ç¿’2ç¬¬ä¸‰é¡Œé€šéå¯¦éš›æ“ä½œï¼Œè®“æ‚¨æ·±å…¥é«”é©—äº†å°ˆæ¥­éŠæˆ²é–‹ç™¼ä¸­çš„å‹•ç•«è£½ä½œæµç¨‹ã€‚é€™å€‹ç·´ç¿’ä¸åƒ…æ•™æœƒäº†å…·é«”çš„æŠ€è¡“æ“ä½œï¼Œæ›´é‡è¦çš„æ˜¯åŸ¹é¤Šäº†ï¼š

1. **å·¥å…·åŒ–æ€ç¶­**ï¼šç†è§£å°ˆæ¥­å·¥å…·åœ¨æé«˜é–‹ç™¼æ•ˆç‡ä¸­çš„é‡è¦ä½œç”¨
2. **ç³»çµ±æ•´åˆèƒ½åŠ›**ï¼šå­¸æœƒåœ¨ç¾æœ‰å°ˆæ¡ˆä¸­æ·»åŠ æ–°åŠŸèƒ½è€Œä¸ç ´å£æ—¢æœ‰æ¶æ§‹
3. **è³‡æºç®¡ç†æŠ€èƒ½**ï¼šæŒæ¡å¤§å‹å°ˆæ¡ˆä¸­çš„è³‡æºçµ„ç¹”å’Œä½¿ç”¨æ–¹æ³•
4. **å•é¡Œè§£æ±ºèƒ½åŠ›**ï¼šé¢å°æŠ€è¡“å•é¡Œæ™‚çš„åˆ†æå’Œè§£æ±ºæ€è·¯
5. **å“è³ªæ„è­˜**ï¼šé—œæ³¨å‹•ç•«æ•ˆæœã€æ€§èƒ½å’Œç”¨æˆ¶é«”é©—çš„å¹³è¡¡

é€™äº›æŠ€èƒ½ä¸åƒ…é©ç”¨æ–¼ Cocos Creator é–‹ç™¼ï¼Œæ›´æ˜¯é€šç”¨çš„è»Ÿé«”å·¥ç¨‹å’ŒéŠæˆ²é–‹ç™¼èƒ½åŠ›ï¼Œç‚ºæ‚¨ä»Šå¾Œçš„å°ˆæ¥­ç™¼å±•å¥ å®šäº†å …å¯¦çš„åŸºç¤ã€‚

é€šéå®Œæˆé€™ä¸‰å€‹ç·´ç¿’é¡Œç›®ï¼Œæ‚¨å·²ç¶“å…·å‚™äº†ï¼š
- **æ¥­å‹™é‚è¼¯æ§åˆ¶**ï¼šæ¢ä»¶åˆ¤æ–·å’Œæµç¨‹æ§åˆ¶ï¼ˆé¡Œç›®ä¸€ï¼‰
- **å‹•ç•«æ•ˆæœè£½ä½œ**ï¼šç‰¹æ•ˆè¡¨æ¼”å’Œæ™‚åºç®¡ç†ï¼ˆé¡Œç›®äºŒï¼‰  
- **å·¥å…·åŒ–é–‹ç™¼**ï¼šæ¸¬è©¦å·¥å…·ä½¿ç”¨å’Œå‹•ç•«æ•´åˆï¼ˆé¡Œç›®ä¸‰ï¼‰

é€™æ˜¯ä¸€å€‹å®Œæ•´çš„éŠæˆ²é–‹ç™¼æŠ€èƒ½é«”ç³»ï¼Œæ¶µè“‹äº†é‚è¼¯ã€è¦–è¦ºã€å·¥å…·ä¸‰å€‹é‡è¦å±¤é¢ã€‚